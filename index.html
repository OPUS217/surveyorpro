<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surveypro - Professional Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .hidden { display: none; }
        .tab-active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); transition: 0.3s; }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- Success Banner -->
    <div id="banner" class="hidden fixed top-0 left-0 right-0 z-50"></div>

    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold">üìç Surveypro</h1>
                    <p class="text-xs opacity-90">Professional Platform | Fully Functional</p>
                </div>
                <button onclick="toggleDark()" class="bg-white/20 px-3 py-2 rounded-lg">üåô</button>
            </div>
        </div>
    </header>

    <!-- Tabs -->
    <div class="max-w-6xl mx-auto px-4 py-4">
        <div class="bg-white rounded-xl shadow-lg p-2 flex overflow-x-auto space-x-2">
            <button onclick="showTab('survey')" id="tab-survey" class="tab-active px-4 py-2 rounded-lg font-semibold whitespace-nowrap">üìä Survey</button>
            <button onclick="showTab('tools')" id="tab-tools" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">üõ†Ô∏è Tools</button>
            <button onclick="showTab('equipment')" id="tab-equipment" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">üîß Equipment</button>
            <button onclick="showTab('training')" id="tab-training" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">üéì Training</button>
            <button onclick="showTab('services')" id="tab-services" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">üíº Services</button>
        </div>
    </div>

    <!-- Main -->
    <main class="max-w-6xl mx-auto px-4 pb-20">
        
        <!-- Survey Tab -->
        <div id="content-survey" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-xl font-bold mb-4">GPS Survey</h2>
                <div id="gpsInfo" class="mb-4"><p class="text-gray-600">Click Enable GPS to start</p></div>
                <button onclick="enableGPS()" class="w-full gradient-bg text-white px-6 py-3 rounded-lg font-bold">üì° Enable GPS</button>
            </div>
            
            <div id="controls" class="hidden bg-white rounded-xl shadow-lg p-6 mb-6">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <button onclick="addPoint()" class="bg-green-600 text-white px-6 py-3 rounded-lg font-bold">‚ûï Add Point</button>
                    <button onclick="undoPoint()" class="bg-yellow-600 text-white px-6 py-3 rounded-lg font-bold">‚Ü©Ô∏è Undo</button>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg mb-4">
                    <p class="text-2xl font-bold text-purple-600" id="pointCount">0</p>
                    <p class="text-sm text-gray-600">Points Captured</p>
                </div>
                <button onclick="completeSurvey()" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-bold">‚úÖ Complete Survey</button>
            </div>
            
            <div id="results" class="hidden bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold mb-4">Results</h2>
                <div id="resultsContent"></div>
                <button onclick="newSurvey()" class="w-full mt-4 gradient-bg text-white px-6 py-3 rounded-lg font-bold">üîÑ New Survey</button>
            </div>
        </div>

        <!-- Tools Tab -->
        <div id="content-tools" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold mb-4">üß≠ Coordinate Converter</h3>
                <input type="number" id="lat" placeholder="Latitude" class="w-full px-4 py-3 border rounded-lg mb-3">
                <input type="number" id="lon" placeholder="Longitude" class="w-full px-4 py-3 border rounded-lg mb-4">
                <button onclick="convertCoords()" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-bold">Convert</button>
                <div id="coordResult" class="hidden mt-4 p-4 bg-gray-50 rounded-lg"></div>
            </div>
        </div>

        <!-- Equipment Tab -->
        <div id="content-equipment" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="equipmentList"></div>
        </div>

        <!-- Training Tab -->
        <div id="content-training" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="trainingList"></div>
        </div>

        <!-- Services Tab -->
        <div id="content-services" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-2">üìê Topographic Survey</h3>
                    <p class="text-2xl font-bold text-green-600 mb-4">From ‚Ç¶150,000</p>
                    <button onclick="requestQuote('Topographic Survey')" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-bold">Get Quote</button>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-2">üèòÔ∏è Cadastral Survey</h3>
                    <p class="text-2xl font-bold text-green-600 mb-4">From ‚Ç¶100,000</p>
                    <button onclick="requestQuote('Cadastral Survey')" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-bold">Get Quote</button>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-2">üöÅ Drone Mapping</h3>
                    <p class="text-2xl font-bold text-green-600 mb-4">From ‚Ç¶250,000</p>
                    <button onclick="requestQuote('Drone Mapping')" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-bold">Get Quote</button>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold mb-2">üó∫Ô∏è GIS Mapping</h3>
                    <p class="text-2xl font-bold text-green-600 mb-4">From ‚Ç¶180,000</p>
                    <button onclick="requestQuote('GIS Mapping')" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-bold">Get Quote</button>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white text-center py-6 mt-12">
        <p class="font-bold mb-2">üìç Surveypro</p>
        <p class="text-sm">üìû +234-811-755-4948 | üìß opusarnold@gmail.com</p>
        <p class="text-xs text-gray-400 mt-2">¬© 2026 Surveypro. Professional Surveyors.</p>
    </footer>

    <script>
        // ========== CONFIG ==========
        const CFG = {
            phone: '2348117554948',
            email: 'opusarnold@gmail.com',
            paystack: 'pk_test_eccaa497055c149e45a6f21500a322cb584ec9eb'
        };

        // ========== STATE ==========
        let gps = null;
        let watchId = null;
        let points = [];

        // ========== UTILS ==========
        function showBanner(msg, type='success') {
            const b = document.getElementById('banner');
            b.className = `fixed top-0 left-0 right-0 z-50 ${type==='success'?'bg-green-500':'bg-red-500'} text-white px-6 py-4`;
            b.innerHTML = `<div class="max-w-6xl mx-auto text-center font-bold">${msg}</div>`;
            b.classList.remove('hidden');
            setTimeout(() => b.classList.add('hidden'), 3000);
        }

        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(el => el.classList.remove('tab-active'));
            document.getElementById('content-' + tab).classList.remove('hidden');
            document.getElementById('tab-' + tab).classList.add('tab-active');
        }

        function openWhatsApp(msg) {
            window.open(`https://wa.me/${CFG.phone}?text=${encodeURIComponent(msg)}`, '_blank');
        }

        // ========== GPS FUNCTIONS ==========
        function enableGPS() {
            if (!navigator.geolocation) {
                showBanner('GPS not supported', 'error');
                return;
            }

            document.getElementById('gpsInfo').innerHTML = '<p class="text-blue-600 font-semibold">üîÑ Acquiring GPS...</p>';

            watchId = navigator.geolocation.watchPosition(
                pos => {
                    gps = pos;
                    const acc = pos.coords.accuracy;
                    const lat = pos.coords.latitude.toFixed(6);
                    const lon = pos.coords.longitude.toFixed(6);
                    
                    document.getElementById('gpsInfo').innerHTML = `
                        <div class="bg-green-50 p-4 rounded-lg">
                            <p class="font-bold text-green-600 mb-2">‚úì GPS Active</p>
                            <p class="text-sm"><strong>Lat:</strong> ${lat}¬∞ | <strong>Lon:</strong> ${lon}¬∞</p>
                            <p class="text-sm"><strong>Accuracy:</strong> ¬±${acc.toFixed(1)}m</p>
                        </div>
                    `;
                    
                    document.getElementById('controls').classList.remove('hidden');
                    showBanner('GPS enabled successfully!');
                },
                err => {
                    document.getElementById('gpsInfo').innerHTML = `<p class="text-red-600">‚ùå ${err.message}</p>`;
                    showBanner('GPS error', 'error');
                },
                { enableHighAccuracy: true }
            );
        }

        function addPoint() {
            if (!gps) {
                showBanner('Waiting for GPS...', 'error');
                return;
            }

            points.push({
                lat: gps.coords.latitude,
                lon: gps.coords.longitude,
                acc: gps.coords.accuracy
            });

            document.getElementById('pointCount').textContent = points.length;
            showBanner(`Point ${points.length} added!`);
        }

        function undoPoint() {
            if (points.length === 0) {
                showBanner('No points to undo', 'error');
                return;
            }
            points.pop();
            document.getElementById('pointCount').textContent = points.length;
            showBanner('Point removed');
        }

        function completeSurvey() {
            if (points.length < 3) {
                showBanner('Need at least 3 points', 'error');
                return;
            }

            // Calculate area (simple formula)
            let area = 0;
            for (let i = 0; i < points.length; i++) {
                const j = (i + 1) % points.length;
                area += points[i].lat * points[j].lon;
                area -= points[j].lat * points[i].lon;
            }
            area = Math.abs(area / 2);
            
            const areaM2 = area * 111320 * 111320 * Math.cos(points[0].lat * Math.PI / 180);
            const hectares = areaM2 / 10000;
            const acres = hectares * 2.47105;

            // Calculate perimeter
            let perim = 0;
            for (let i = 0; i < points.length; i++) {
                const j = (i + 1) % points.length;
                const R = 6371000;
                const œÜ1 = points[i].lat * Math.PI / 180;
                const œÜ2 = points[j].lat * Math.PI / 180;
                const ŒîœÜ = (points[j].lat - points[i].lat) * Math.PI / 180;
                const ŒîŒª = (points[j].lon - points[i].lon) * Math.PI / 180;
                const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) + Math.cos(œÜ1) * Math.cos(œÜ2) * Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                perim += R * c;
            }

            const code = 'NGS-' + Date.now().toString(36).toUpperCase();

            document.getElementById('resultsContent').innerHTML = `
                <div class="bg-green-50 p-6 rounded-xl mb-4">
                    <p class="text-2xl font-bold text-green-800 text-center">‚úì Survey Complete!</p>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-xs text-gray-600">Hectares</p>
                        <p class="text-2xl font-bold text-blue-800">${hectares.toFixed(4)}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-xs text-gray-600">Acres</p>
                        <p class="text-2xl font-bold text-green-800">${acres.toFixed(4)}</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <p class="text-xs text-gray-600">Sq. Meters</p>
                        <p class="text-2xl font-bold text-purple-800">${areaM2.toFixed(2)}</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <p class="text-xs text-gray-600">Perimeter</p>
                        <p class="text-2xl font-bold text-yellow-800">${perim.toFixed(2)}m</p>
                    </div>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg text-center">
                    <p class="text-sm text-gray-600 mb-2">Verification Code</p>
                    <p class="text-2xl font-bold font-mono text-purple-800">${code}</p>
                </div>
            `;

            document.getElementById('results').classList.remove('hidden');
            document.getElementById('controls').classList.add('hidden');
            if (watchId) navigator.geolocation.clearWatch(watchId);
            
            showBanner('Survey completed successfully!');
        }

        function newSurvey() {
            if (!confirm('Start new survey?')) return;
            points = [];
            gps = null;
            document.getElementById('pointCount').textContent = '0';
            document.getElementById('results').classList.add('hidden');
            document.getElementById('controls').classList.add('hidden');
            document.getElementById('gpsInfo').innerHTML = '<p class="text-gray-600">Click Enable GPS to start</p>';
            if (watchId) navigator.geolocation.clearWatch(watchId);
            showBanner('Ready for new survey');
        }

        // ========== TOOLS ==========
        function convertCoords() {
            const lat = parseFloat(document.getElementById('lat').value);
            const lon = parseFloat(document.getElementById('lon').value);
            
            if (isNaN(lat) || isNaN(lon)) {
                showBanner('Enter valid coordinates', 'error');
                return;
            }
            
            const zone = Math.floor((lon + 180) / 6) + 1;
            const easting = 500000 + (lon + 180) * 100000;
            const northing = lat * 111000;
            
            document.getElementById('coordResult').classList.remove('hidden');
            document.getElementById('coordResult').innerHTML = `
                <p class="font-bold mb-2">UTM Coordinates:</p>
                <p><strong>Zone:</strong> ${zone}${lat >= 0 ? 'N' : 'S'}</p>
                <p><strong>Easting:</strong> ${easting.toFixed(2)} m</p>
                <p><strong>Northing:</strong> ${northing.toFixed(2)} m</p>
            `;
            showBanner('Converted successfully!');
        }

        // ========== EQUIPMENT ==========
        const equipment = [
            {name: 'Total Station', price: 15000, desc: 'High-precision theodolite'},
            {name: 'Survey Drone', price: 25000, desc: 'Professional mapping drone'},
            {name: 'GNSS Receiver', price: 20000, desc: 'RTK GPS receiver'},
            {name: 'Laser Scanner', price: 30000, desc: '3D laser scanner'}
        ];

        function initEquipment() {
            const html = equipment.map(item => `
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="font-bold text-lg mb-2">${item.name}</h3>
                    <p class="text-sm text-gray-600 mb-3">${item.desc}</p>
                    <p class="text-xl font-bold text-green-600 mb-3">‚Ç¶${item.price.toLocaleString()}/day</p>
                    <button onclick="bookEquipment('${item.name}', ${item.price})" class="w-full bg-purple-600 text-white px-4 py-3 rounded-lg font-bold">
                        üìÖ Book Now
                    </button>
                </div>
            `).join('');
            document.getElementById('equipmentList').innerHTML = html;
        }

        function bookEquipment(name, price) {
            const info = prompt(`Book ${name} (‚Ç¶${price.toLocaleString()}/day)\n\nEnter: Name | Phone | Date | Days\nExample: John Doe | 08012345678 | 2026-03-01 | 3`);
            if (!info) return;
            
            const [userName, phone, date, days] = info.split('|').map(s => s.trim());
            if (!userName || !phone || !date || !days) {
                showBanner('Please provide all info', 'error');
                return;
            }
            
            const total = price * parseInt(days);
            const msg = `Equipment Booking Request:

Equipment: ${name}
Price: ‚Ç¶${price.toLocaleString()}/day
Days: ${days}
Total: ‚Ç¶${total.toLocaleString()}

Customer: ${userName}
Phone: ${phone}
Date: ${date}

Please confirm availability.`;
            
            openWhatsApp(msg);
            showBanner('Booking request sent via WhatsApp!');
        }

        // ========== TRAINING ==========
        const courses = [
            {id: 'gis', name: 'Advanced GIS Mapping', price: 2500000, duration: '12 hours'},
            {id: 'drone', name: 'Drone Surveying', price: 4500000, duration: '16 hours'},
            {id: 'ai', name: 'AI in Surveying', price: 3500000, duration: '10 hours'},
            {id: 'gnss', name: 'RTK/GNSS Fundamentals', price: 2000000, duration: '8 hours'}
        ];

        function initTraining() {
            const html = courses.map(c => `
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="font-bold text-lg mb-2">${c.name}</h3>
                    <p class="text-sm text-gray-600 mb-3">${c.duration}</p>
                    <p class="text-xl font-bold text-green-600 mb-3">‚Ç¶${(c.price/100).toLocaleString()}</p>
                    <button onclick="enrollCourse('${c.name}', ${c.price})" class="w-full bg-green-600 text-white px-4 py-3 rounded-lg font-bold">
                        üí≥ Enroll Now
                    </button>
                </div>
            `).join('');
            document.getElementById('trainingList').innerHTML = html;
        }

        function enrollCourse(name, price) {
            const email = prompt(`Enroll in ${name}\n\nEnter your email for payment:`);
            if (!email || !email.includes('@')) {
                showBanner('Enter valid email', 'error');
                return;
            }
            
            const handler = PaystackPop.setup({
                key: CFG.paystack,
                email: email,
                amount: price,
                currency: 'NGN',
                ref: 'TRN-' + Date.now(),
                callback: function(response) {
                    showBanner(`Payment successful! Ref: ${response.reference}`);
                    const msg = `Course Enrollment Confirmed!

Course: ${name}
Email: ${email}
Reference: ${response.reference}
Amount: ‚Ç¶${(price/100).toLocaleString()}

Please send course access.`;
                    setTimeout(() => openWhatsApp(msg), 2000);
                },
                onClose: function() {
                    showBanner('Payment cancelled', 'error');
                }
            });
            handler.openIframe();
        }

        // ========== SERVICES ==========
        function requestQuote(service) {
            const msg = `Service Quote Request:

Service: ${service}

Please provide:
- Project location
- Area/scope
- Timeline
- Special requirements

I would like a detailed quote.`;
            openWhatsApp(msg);
            showBanner('Quote request sent!');
        }

        // ========== INIT ==========
        function toggleDark() {
            document.body.classList.toggle('bg-gray-900');
            document.body.classList.toggle('text-white');
        }

        window.addEventListener('DOMContentLoaded', () => {
            initEquipment();
            initTraining();
            console.log('‚úì Surveypro loaded - ALL features functional');
            console.log('Phone:', CFG.phone);
            console.log('Email:', CFG.email);
        });
    </script>
</body>
</html>
