<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="description" content="SurveyPro Elite â€” Nigeria's #1 Professional Land Surveying Platform. GPS, Coordinates, GIS, Equipment Rental, Training & C of O Verification.">
<meta name="keywords" content="land survey Nigeria, GPS surveying, coordinate conversion, GIS tools, survey equipment rental, C of O verification">
<title>SurveyPro Elite | Nigeria's #1 Professional Surveying Platform</title>
<meta name="theme-color" content="#16a34a">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="SurveyPro Elite">
<meta property="og:title" content="SurveyPro Elite | Nigeria's #1 Surveying Platform">
<meta property="og:description" content="Professional GPS survey, coordinate conversion, GIS tools, equipment rental and C of O verification.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://pus217.github.io">
<link rel="manifest" href="manifest.json">
<link rel="canonical" href="https://pus217.github.io">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
:root {
  --primary: #0f172a;
  --accent: #16a34a;
  --accent2: #1d4ed8;
  --gold: #ca8a04;
  --surface: #ffffff;
  --surface2: #f0fdf4;
  --surface3: #eff6ff;
  --border: #e2e8f0;
  --text: #0f172a;
  --text2: #475569;
  --text3: #94a3b8;
  --success: #16a34a;
  --warning: #d97706;
  --danger: #dc2626;
  --info: #0284c7;
  --radius: 14px;
  --shadow: 0 4px 24px rgba(15,23,42,0.08);
  --shadow-lg: 0 20px 60px rgba(15,23,42,0.14);
}
*{box-sizing:border-box;margin:0;padding:0;}
html{scroll-behavior:smooth;}
body{font-family:'Space Grotesk',sans-serif;background:#f8fafc;color:var(--text);min-height:100vh;line-height:1.6;}
.mono{font-family:'JetBrains Mono',monospace;}
.display{font-family:'Syne',sans-serif;}

/* â•â•â• SCROLLBAR â•â•â• */
::-webkit-scrollbar{width:6px;height:6px;}
::-webkit-scrollbar-track{background:#f1f5f9;}
::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px;}

/* â•â•â• HEADER â•â•â• */
header{
  background:linear-gradient(135deg,#0f172a 0%,#1e3a5f 60%,#064e3b 100%);
  color:#fff;
  position:sticky;top:0;z-index:100;
  box-shadow:0 2px 20px rgba(0,0,0,0.3);
}
.header-inner{max-width:1280px;margin:0 auto;padding:14px 20px;display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;}
.logo-block h1{font-family:'Syne',sans-serif;font-size:1.6rem;font-weight:800;letter-spacing:-0.02em;}
.logo-block h1 span{color:#4ade80;}
.logo-sub{font-size:0.7rem;opacity:0.7;margin-top:1px;letter-spacing:0.04em;}
.header-right{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
.eco-badge{display:flex;align-items:center;gap:5px;background:rgba(74,222,128,0.15);border:1px solid rgba(74,222,128,0.3);color:#4ade80;padding:4px 10px;border-radius:20px;font-size:0.72rem;font-weight:600;}
.gps-pill{display:flex;align-items:center;gap:6px;background:rgba(255,255,255,0.1);padding:6px 14px;border-radius:20px;font-size:0.8rem;cursor:pointer;transition:.2s;}
.gps-pill:hover{background:rgba(255,255,255,0.2);}
.gps-dot{width:9px;height:9px;border-radius:50%;background:#ef4444;flex-shrink:0;}
.gps-dot.active{background:#4ade80;box-shadow:0 0 8px #4ade80;animation:blink 1.5s infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.4;}}
.hdr-btn{background:rgba(255,255,255,0.12);border:none;color:#fff;padding:7px 13px;border-radius:10px;font-size:0.8rem;cursor:pointer;transition:.2s;font-family:inherit;}
.hdr-btn:hover{background:rgba(255,255,255,0.22);}
select.hdr-btn{appearance:none;cursor:pointer;}

/* â•â•â• NAVIGATION â•â•â• */
.nav-wrap{max-width:1280px;margin:0 auto;padding:10px 20px;}
.nav-bar{background:#fff;border-radius:16px;padding:6px;display:flex;gap:4px;overflow-x:auto;box-shadow:var(--shadow);}
.nav-bar::-webkit-scrollbar{height:0;}
.nav-btn{display:flex;align-items:center;gap:6px;padding:9px 16px;border:none;border-radius:11px;font-size:0.8rem;font-weight:600;white-space:nowrap;cursor:pointer;transition:.2s;background:transparent;color:var(--text2);font-family:inherit;}
.nav-btn:hover{background:#f1f5f9;color:var(--text);}
.nav-btn.active{background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;box-shadow:0 4px 14px rgba(15,23,42,0.25);}
.nav-btn .nb-icon{font-size:1.1rem;}

/* â•â•â• MAIN â•â•â• */
main{max-width:1280px;margin:0 auto;padding:20px 20px 100px;}
.tab-content{display:none;animation:fadeUp .35s ease;}
.tab-content.active{display:block;}
@keyframes fadeUp{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}

/* â•â•â• CARDS â•â•â• */
.card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:24px;margin-bottom:20px;border:1px solid var(--border);}
.card-header{display:flex;align-items:center;gap:10px;margin-bottom:20px;}
.card-header h2{font-family:'Syne',sans-serif;font-size:1.1rem;font-weight:700;}
.card-icon{font-size:1.4rem;}
.card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;}
.card-hover{transition:.25s;}
.card-hover:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg);}

/* â•â•â• FORMS â•â•â• */
.form-group{margin-bottom:14px;}
.form-group label{display:block;font-size:0.8rem;font-weight:600;color:var(--text2);margin-bottom:5px;}
.form-group label .req{color:var(--danger);}
input,select,textarea{
  width:100%;padding:11px 14px;border:2px solid var(--border);border-radius:10px;
  font-size:0.88rem;font-family:inherit;color:var(--text);
  background:#fff;transition:.2s;outline:none;
}
input:focus,select:focus,textarea:focus{border-color:var(--accent2);box-shadow:0 0 0 3px rgba(29,78,216,0.1);}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
.form-row.three{grid-template-columns:1fr 1fr 1fr;}
@media(max-width:640px){.form-row,.form-row.three{grid-template-columns:1fr;}}

/* â•â•â• BUTTONS â•â•â• */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:7px;padding:11px 20px;border:none;border-radius:10px;font-size:0.88rem;font-weight:700;cursor:pointer;transition:.2s;font-family:inherit;text-decoration:none;}
.btn:hover{transform:translateY(-1px);}
.btn:active{transform:translateY(0);}
.btn-primary{background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;box-shadow:0 4px 14px rgba(15,23,42,0.2);}
.btn-primary:hover{box-shadow:0 8px 24px rgba(15,23,42,0.3);}
.btn-green{background:linear-gradient(135deg,#16a34a,#15803d);color:#fff;box-shadow:0 4px 14px rgba(22,163,74,0.25);}
.btn-green:hover{box-shadow:0 8px 24px rgba(22,163,74,0.35);}
.btn-blue{background:linear-gradient(135deg,#1d4ed8,#1e40af);color:#fff;}
.btn-red{background:#dc2626;color:#fff;}
.btn-red:hover{background:#b91c1c;}
.btn-orange{background:linear-gradient(135deg,#d97706,#b45309);color:#fff;}
.btn-gray{background:#e2e8f0;color:var(--text2);}
.btn-gray:hover{background:#cbd5e1;}
.btn-outline{background:transparent;color:var(--accent);border:2px solid var(--accent);}
.btn-sm{padding:7px 14px;font-size:0.8rem;}
.btn-lg{padding:15px 28px;font-size:1rem;}
.btn-full{width:100%;}
.btn-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.btn-grid.four{grid-template-columns:1fr 1fr 1fr 1fr;}
@media(max-width:640px){.btn-grid.four{grid-template-columns:1fr 1fr;}}

/* â•â•â• GPS & STATS â•â•â• */
.gps-box{padding:16px;background:var(--surface2);border:2px solid #bbf7d0;border-radius:12px;font-size:0.85rem;}
.gps-info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:10px;margin-top:10px;}
.gps-info-item{background:#fff;border-radius:8px;padding:10px;border:1px solid var(--border);}
.gps-info-item .label{font-size:0.72rem;color:var(--text3);font-weight:600;}
.gps-info-item .val{font-family:'JetBrains Mono',monospace;font-weight:700;font-size:0.9rem;margin-top:2px;}
.stat-row{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin:16px 0;}
@media(max-width:640px){.stat-row{grid-template-columns:repeat(3,1fr);}}
.stat-chip{text-align:center;padding:14px 8px;border-radius:12px;border:2px solid transparent;}
.stat-chip .sv{font-family:'JetBrains Mono',monospace;font-size:1.2rem;font-weight:700;line-height:1;}
.stat-chip .sk{font-size:0.68rem;font-weight:600;margin-top:4px;opacity:0.85;}
.sc-dark{background:#0f172a;color:#fff;}
.sc-green{background:#f0fdf4;border-color:#bbf7d0;color:#15803d;}
.sc-blue{background:#eff6ff;border-color:#bfdbfe;color:#1d4ed8;}
.sc-orange{background:#fffbeb;border-color:#fde68a;color:#b45309;}
.sc-purple{background:#faf5ff;border-color:#e9d5ff;color:#7c3aed;}

/* â•â•â• TABLE â•â•â• */
.data-table{width:100%;border-collapse:collapse;font-size:0.8rem;}
.data-table th{background:#0f172a;color:#fff;padding:10px 12px;text-align:left;font-weight:600;letter-spacing:0.03em;}
.data-table th:first-child{border-radius:8px 0 0 8px;}
.data-table th:last-child{border-radius:0 8px 8px 0;}
.data-table td{padding:9px 12px;border-bottom:1px solid var(--border);}
.data-table tr:hover td{background:#f8fafc;}
.data-table tr:last-child td{border-bottom:none;}

/* â•â•â• CANVAS â•â•â• */
canvas#plotCanvas{width:100%;border:2px solid #e2e8f0;border-radius:12px;background:#fff;cursor:crosshair;display:block;}

/* â•â•â• COORD TABS â•â•â• */
.sub-tabs{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:20px;}
.sub-tab{padding:8px 16px;border-radius:8px;font-size:0.8rem;font-weight:600;cursor:pointer;border:2px solid var(--border);background:#fff;color:var(--text2);transition:.2s;font-family:inherit;}
.sub-tab.active{background:var(--accent2);color:#fff;border-color:var(--accent2);}
.coord-pane{display:none;}
.coord-pane.active{display:block;animation:fadeUp .3s ease;}
.result-box{background:#f8fafc;border:2px solid #e2e8f0;border-radius:10px;padding:14px;font-family:'JetBrains Mono',monospace;font-size:0.85rem;margin-top:12px;display:none;}
.result-box.show{display:block;}
.result-row{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid #f1f5f9;}
.result-row:last-child{border-bottom:none;}
.result-row .rk{color:var(--text2);font-family:'Space Grotesk',sans-serif;}

/* â•â•â• EQUIPMENT â•â•â• */
.equip-card{border:2px solid var(--border);border-radius:var(--radius);padding:22px;background:#fff;transition:.25s;}
.equip-card:hover{border-color:var(--accent);box-shadow:0 8px 30px rgba(22,163,74,0.12);transform:translateY(-3px);}
.equip-top{display:flex;gap:12px;align-items:flex-start;margin-bottom:12px;}
.equip-icon{font-size:2.5rem;}
.equip-price{font-family:'Syne',sans-serif;font-size:2rem;font-weight:800;color:var(--accent);line-height:1;}
.equip-earn{display:inline-block;background:#f0fdf4;border:2px solid #bbf7d0;color:#15803d;padding:5px 12px;border-radius:20px;font-size:0.78rem;font-weight:700;margin:6px 0;}
.equip-features{list-style:none;margin:10px 0;display:flex;flex-direction:column;gap:3px;}
.equip-features li{font-size:0.82rem;color:var(--text2);}

/* â•â•â• REVENUE SPLIT BANNER â•â•â• */
.rev-split{background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;border-radius:var(--radius);padding:24px;margin-bottom:20px;}
.rev-split h3{font-family:'Syne',sans-serif;font-size:1.1rem;margin-bottom:14px;text-align:center;}
.split-row{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.1);border-radius:10px;padding:14px 18px;margin-bottom:8px;border:1px solid rgba(255,255,255,0.15);}
.split-pct{font-family:'Syne',sans-serif;font-size:2rem;font-weight:800;color:#4ade80;}
.split-label{font-size:0.85rem;opacity:0.85;}
.split-detail{font-size:0.75rem;opacity:0.65;margin-top:2px;}

/* â•â•â• COURSE CARD â•â•â• */
.course-card{border:2px solid var(--border);border-radius:var(--radius);padding:20px;background:#fff;transition:.25s;}
.course-card:hover{border-color:var(--accent2);box-shadow:var(--shadow);}
.course-level{display:inline-block;padding:3px 10px;border-radius:20px;font-size:0.72rem;font-weight:700;}
.level-beg{background:#f0fdf4;color:#15803d;}
.level-int{background:#eff6ff;color:#1d4ed8;}
.level-adv{background:#faf5ff;color:#7c3aed;}
.course-price{font-family:'Syne',sans-serif;font-size:1.6rem;font-weight:800;color:var(--accent);}
.course-earn{background:#f0fdf4;border:1px solid #bbf7d0;color:#15803d;padding:4px 10px;border-radius:20px;font-size:0.75rem;font-weight:700;display:inline-block;}

/* â•â•â• HISTORY CARD â•â•â• */
.hist-card{border:2px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:14px;transition:.2s;}
.hist-card:hover{border-color:var(--accent);}
.hist-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;}
.hist-code{font-family:'JetBrains Mono',monospace;font-size:0.75rem;font-weight:700;background:#f0fdf4;color:#15803d;padding:4px 10px;border-radius:20px;}
.hist-stats{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:10px;}
.hist-stat{text-align:center;padding:8px;border-radius:8px;background:#f8fafc;}
.hist-stat .hk{font-size:0.68rem;color:var(--text3);}
.hist-stat .hv{font-weight:800;font-size:0.95rem;}

/* â•â•â• VERIFY â•â•â• */
.verify-success{background:#f0fdf4;border:2px solid #86efac;border-radius:var(--radius);padding:20px;}
.verify-fail{background:#fef2f2;border:2px solid #fca5a5;border-radius:var(--radius);padding:20px;text-align:center;}

/* â•â•â• GIS GRID â•â•â• */
.gis-card{border:2px solid var(--border);border-radius:var(--radius);padding:20px;background:#fff;transition:.25s;}
.gis-card:hover{transform:translateY(-3px);box-shadow:var(--shadow);}

/* â•â•â• ECO SECTION â•â•â• */
.eco-banner{background:linear-gradient(135deg,#064e3b,#065f46,#047857);color:#fff;border-radius:var(--radius);padding:20px;text-align:center;margin-bottom:20px;}
.eco-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px;}
.eco-stat{background:rgba(255,255,255,0.15);border-radius:10px;padding:12px;text-align:center;}
.eco-stat .ev{font-family:'Syne',sans-serif;font-size:1.4rem;font-weight:800;color:#4ade80;}
.eco-stat .ek{font-size:0.72rem;opacity:0.85;}

/* â•â•â• MODAL â•â•â• */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:500;padding:16px;backdrop-filter:blur(4px);}
.modal-bg.open{display:flex;}
.modal-box{background:#fff;border-radius:20px;padding:30px;max-width:580px;width:100%;max-height:90vh;overflow-y:auto;box-shadow:var(--shadow-lg);animation:fadeUp .3s ease;}
.modal-close{position:absolute;top:14px;right:14px;background:#f1f5f9;border:none;border-radius:8px;padding:7px 12px;cursor:pointer;font-size:1rem;font-family:inherit;}

/* â•â•â• TOAST â•â•â• */
.toast-wrap{position:fixed;top:20px;right:20px;z-index:1000;display:flex;flex-direction:column;gap:8px;pointer-events:none;}
.toast{background:#fff;border-radius:12px;padding:14px 18px;box-shadow:0 8px 30px rgba(0,0,0,0.15);border-left:4px solid #94a3b8;font-size:0.85rem;font-weight:600;max-width:340px;transform:translateX(400px);transition:.35s cubic-bezier(.34,1.56,.64,1);pointer-events:auto;}
.toast.show{transform:translateX(0);}
.toast.t-success{border-color:var(--success);}
.toast.t-warning{border-color:var(--warning);}
.toast.t-error{border-color:var(--danger);}
.toast.t-info{border-color:var(--info);}

/* â•â•â• BANNER â•â•â• */
.top-banner{position:fixed;top:0;left:0;right:0;z-index:200;transform:translateY(-100%);transition:.4s;background:linear-gradient(90deg,#16a34a,#15803d);}
.top-banner.show{transform:translateY(0);}
.banner-inner{max-width:1280px;margin:0 auto;padding:12px 20px;display:flex;justify-content:space-between;align-items:center;color:#fff;font-weight:600;font-size:0.88rem;}

/* â•â•â• MANUAL INPUT â•â•â• */
.manual-box{display:none;background:#f0fdf4;border:2px solid #bbf7d0;border-radius:12px;padding:16px;margin-bottom:14px;animation:fadeUp .25s ease;}
.manual-box.open{display:block;}

/* â•â•â• QR â•â•â• */
#qrContainer{display:flex;justify-content:center;margin:14px 0;}

/* â•â•â• FOOTER â•â•â• */
footer{background:#0f172a;color:#fff;margin-top:40px;padding:40px 20px;}
.footer-inner{max-width:1280px;margin:0 auto;}
.footer-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:30px;margin-bottom:30px;}
.footer-brand h3{font-family:'Syne',sans-serif;font-size:1.3rem;margin-bottom:8px;}
.footer-brand h3 span{color:#4ade80;}
.footer-brand p{font-size:0.82rem;opacity:0.6;line-height:1.7;}
.footer-links h4{font-weight:700;margin-bottom:12px;font-size:0.9rem;}
.footer-links ul{list-style:none;display:flex;flex-direction:column;gap:6px;}
.footer-links li{font-size:0.82rem;opacity:0.65;}
.footer-contact p{font-size:0.85rem;opacity:0.75;margin-bottom:5px;}
.footer-bottom{border-top:1px solid rgba(255,255,255,0.1);padding-top:20px;text-align:center;font-size:0.78rem;opacity:0.5;}

/* â•â•â• DARK MODE â•â•â• */
body.dark{background:#080e1a;color:#e2e8f0;}
body.dark .card{background:#0f172a;border-color:#1e293b;}
body.dark .nav-bar{background:#0f172a;}
body.dark .nav-btn{color:#94a3b8;}
body.dark .nav-btn:hover{background:#1e293b;}
body.dark input,body.dark select,body.dark textarea{background:#1e293b;border-color:#334155;color:#e2e8f0;}
body.dark .sub-tab{background:#1e293b;border-color:#334155;color:#94a3b8;}
body.dark .result-box,body.dark .gps-box{background:#1e293b;border-color:#334155;}
body.dark .equip-card,body.dark .course-card,body.dark .gis-card,body.dark .hist-card,body.dark .modal-box{background:#0f172a;border-color:#1e293b;}
body.dark .data-table td{border-color:#1e293b;}
body.dark .data-table tr:hover td{background:#1e293b;}
body.dark .hist-stat{background:#1e293b;}
body.dark .manual-box{background:#0a1f12;border-color:#1a4a2a;}

/* â•â•â• RESPONSIVE â•â•â• */
@media(max-width:768px){
  .logo-block h1{font-size:1.2rem;}
  .stat-row{grid-template-columns:repeat(3,1fr);}
  main{padding:14px 14px 100px;}
  .card{padding:16px;}
  .equip-price{font-size:1.5rem;}
  .hist-stats{grid-template-columns:repeat(2,1fr);}
  .footer-grid{gap:20px;}
}
@media(max-width:480px){
  .stat-row{grid-template-columns:repeat(2,1fr);}
  .stat-chip:nth-child(5){grid-column:span 2;}
}

/* â•â•â• LOADING SPINNER â•â•â• */
.spinner{width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;display:inline-block;}
@keyframes spin{to{transform:rotate(360deg);}}

/* â•â•â• BADGE â•â•â• */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:0.72rem;font-weight:700;}
.badge-green{background:#f0fdf4;color:#15803d;}
.badge-blue{background:#eff6ff;color:#1d4ed8;}
.badge-gold{background:#fffbeb;color:#92400e;}
</style>
<script>
// GitHub Pages SPA fix â€” restore path from redirect
(function(l){if(l.search[1]==='/'){ var decoded=l.search.slice(1).split('&').map(function(s){return s.replace(/~and~/g,'&')}).join('?'); window.history.replaceState(null,null,l.pathname.slice(0,-1)+decoded+l.hash);}if(l.hash){var t=l.hash.replace('#/','');var el=document.getElementById('nb-'+t);if(el){setTimeout(function(){el.click();},200);}}}(window.location));
// Register service worker
if('serviceWorker' in navigator){window.addEventListener('load',function(){navigator.serviceWorker.register('/sw.js').then(function(r){console.log('[SPE] SW registered:',r.scope);}).catch(function(e){console.log('[SPE] SW failed:',e);});});}
// Handle ?tab= param
window.addEventListener('DOMContentLoaded',function(){var p=new URLSearchParams(window.location.search);var t=p.get('tab');if(t&&document.getElementById('tab-'+t)){showTab(t);}});
</script>
</head>
<body>

<!-- TOP BANNER -->
<div class="top-banner" id="topBanner">
  <div class="banner-inner">
    <span id="bannerMsg">Welcome to SurveyPro Elite</span>
    <button onclick="closeBanner()" style="background:rgba(255,255,255,0.2);border:none;color:#fff;padding:5px 12px;border-radius:8px;cursor:pointer;font-family:inherit;font-weight:700;">âœ•</button>
  </div>
</div>

<!-- TOAST CONTAINER -->
<div class="toast-wrap" id="toastWrap"></div>

<!-- MODAL -->
<div class="modal-bg" id="modalBg">
  <div class="modal-box" id="modalBox">
    <div id="modalContent"></div>
  </div>
</div>

<!-- HEADER -->
<header>
  <div class="header-inner">
    <div class="logo-block">
      <h1 class="display">ğŸ¯ SurveyPro <span>Elite</span></h1>
      <div class="logo-sub">NIGERIA'S #1 PROFESSIONAL SURVEYING PLATFORM Â· WGS84 Â· UTM 31â€“33N Â· NNO</div>
    </div>
    <div class="header-right">
      <div class="eco-badge">ğŸŒ¿ Eco-Certified</div>
      <div class="gps-pill" onclick="showTab('survey')">
        <span class="gps-dot" id="gpsDot"></span>
        <span id="gpsLabel">GPS Off</span>
      </div>
      <select class="hdr-btn" id="langSelect" onchange="setLang(this.value)">
        <option value="en">ğŸ‡³ğŸ‡¬ English</option>
        <option value="ha">Hausa</option>
        <option value="yo">Yoruba</option>
        <option value="ig">Igbo</option>
        <option value="fr">French</option>
      </select>
      <button class="hdr-btn" onclick="toggleDark()" id="darkBtn">ğŸŒ™ Dark</button>
      <button class="hdr-btn" onclick="showTab('pricing')">ğŸ’ Pricing</button>
    </div>
  </div>
</header>

<!-- NAVIGATION -->
<div class="nav-wrap">
  <div class="nav-bar">
    <button class="nav-btn active" id="nb-survey" onclick="showTab('survey')"><span class="nb-icon">ğŸ“Š</span>Survey</button>
    <button class="nav-btn" id="nb-coords" onclick="showTab('coords')"><span class="nb-icon">ğŸŒ</span>Coordinates</button>
    <button class="nav-btn" id="nb-plot" onclick="showTab('plot')"><span class="nb-icon">ğŸ“</span>Plot Layout</button>
    <button class="nav-btn" id="nb-gis" onclick="showTab('gis')"><span class="nb-icon">ğŸ—ºï¸</span>GIS Tools</button>
    <button class="nav-btn" id="nb-verify" onclick="showTab('verify')"><span class="nb-icon">ğŸ”’</span>C of O</button>
    <button class="nav-btn" id="nb-equipment" onclick="showTab('equipment')"><span class="nb-icon">âš™ï¸</span>Equipment</button>
    <button class="nav-btn" id="nb-training" onclick="showTab('training')"><span class="nb-icon">ğŸ“</span>Training</button>
    <button class="nav-btn" id="nb-history" onclick="showTab('history')"><span class="nb-icon">ğŸ“</span>History</button>
    <button class="nav-btn" id="nb-reports" onclick="showTab('reports')"><span class="nb-icon">ğŸ“„</span>Reports</button>
    <button class="nav-btn" id="nb-pricing" onclick="showTab('pricing')"><span class="nb-icon">ğŸ’</span>Pricing</button>
  </div>
</div>

<main>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SURVEY TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content active" id="tab-survey">

  <!-- ECO BANNER -->
  <div class="eco-banner">
    <div style="font-size:1.4rem;margin-bottom:6px;">ğŸŒ¿ SurveyPro Elite â€” Green & Carbon-Neutral Platform</div>
    <div style="font-size:0.82rem;opacity:0.85;">Paperless reports Â· Digital submissions Â· Energy-efficient cloud processing Â· ISO 14001 aligned</div>
    <div class="eco-stats">
      <div class="eco-stat"><div class="ev">98%</div><div class="ek">Paperless Operations</div></div>
      <div class="eco-stat"><div class="ev">Zero</div><div class="ek">Carbon Emissions</div></div>
      <div class="eco-stat"><div class="ev">500+</div><div class="ek">Trees Saved / Year</div></div>
    </div>
  </div>

  <!-- GPS PANEL -->
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ“¡</span><h2>GPS & Live Location</h2></div>
    <div class="gps-box" id="gpsInfoBox">
      <p style="color:var(--text2);font-size:0.85rem;">Click <strong>Enable GPS</strong> to start real-time positioning for your survey. Works best outdoors with clear sky view.</p>
    </div>
    <div class="btn-grid four" style="margin-top:14px;">
      <button class="btn btn-green" onclick="enableGPS()">ğŸ“¡ Enable GPS</button>
      <button class="btn btn-red" onclick="stopGPS()">â›” Stop GPS</button>
      <button class="btn btn-blue" onclick="addGPSPoint()">â• Add GPS Point</button>
      <button class="btn btn-gray" onclick="getCurrentLocationInfo()">ğŸ“ My Location</button>
    </div>
    <div id="gpsInfoGrid" class="gps-info-grid" style="display:none;margin-top:12px;"></div>
  </div>

  <!-- CLIENT DETAILS -->
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ‘¤</span><h2>Client & Project Details</h2></div>
    <div class="form-row">
      <div class="form-group"><label>Client Name <span class="req">*</span></label><input id="clientName" type="text" placeholder="Full legal name"></div>
      <div class="form-group"><label>Phone <span class="req">*</span></label><input id="clientPhone" type="tel" placeholder="080XXXXXXXX"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Email</label><input id="clientEmail" type="email" placeholder="client@email.com"></div>
      <div class="form-group"><label>NIN / ID Number</label><input id="clientNIN" type="text" placeholder="National ID Number"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Project Name <span class="req">*</span></label><input id="projectName" type="text" placeholder="Project / Survey name"></div>
      <div class="form-group"><label>Location <span class="req">*</span></label><input id="location" type="text" placeholder="Survey site address"></div>
    </div>
    <div class="form-row three">
      <div class="form-group"><label>File Number</label><input id="fileNumber" type="text" placeholder="LD/123/2026"></div>
      <div class="form-group"><label>Survey Type</label>
        <select id="surveyType">
          <option>Boundary Survey</option><option>Topographic Survey</option>
          <option>Cadastral Survey</option><option>Engineering Survey</option>
          <option>Construction Survey</option><option>Hydrographic Survey</option>
          <option>Route Survey</option><option>Photogrammetric Survey</option>
          <option>Drone/Aerial Survey</option><option>Mining Survey</option>
        </select>
      </div>
      <div class="form-group"><label>Coordinate System</label>
        <select id="coordSys">
          <option>WGS 84 / UTM Zone 31N</option><option>WGS 84 / UTM Zone 32N</option>
          <option>WGS 84 / UTM Zone 33N</option><option>Minna / UTM Zone 31N (NNO)</option>
          <option>ETRS89 / UTM</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Horizontal Datum</label>
        <select id="hDatum"><option>WGS84</option><option>Minna (NNO)</option><option>Clarke 1880</option></select>
      </div>
      <div class="form-group"><label>Vertical Datum</label>
        <select id="vDatum"><option>Mean Sea Level (MSL)</option><option>Ellipsoidal Height</option><option>Geoid Height (EGM2008)</option></select>
      </div>
    </div>
    <div class="form-group"><label>Survey Notes / Remarks</label>
      <textarea id="surveyNotes" rows="2" placeholder="Additional notes, obstructions, access issues..."></textarea>
    </div>
  </div>

  <!-- SURVEY CONTROLS -->
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ“</span><h2>Survey Controls</h2></div>
    <div class="btn-grid four" style="margin-bottom:14px;">
      <button class="btn btn-green" onclick="addManualPointToggle()">âœï¸ Manual Point</button>
      <button class="btn btn-orange" onclick="undoPoint()">â†©ï¸ Undo Last</button>
      <button class="btn btn-blue" onclick="importCSVPoints()">ğŸ“‚ Import CSV</button>
      <button class="btn btn-red" onclick="clearSurvey()">ğŸ—‘ï¸ Clear All</button>
    </div>

    <!-- Manual Input -->
    <div class="manual-box" id="manualBox">
      <div class="form-row three">
        <div class="form-group"><label>Northing (m)</label><input id="manualN" type="number" step="0.001" placeholder="857881.968" class="mono"></div>
        <div class="form-group"><label>Easting (m)</label><input id="manualE" type="number" step="0.001" placeholder="707032.831" class="mono"></div>
        <div class="form-group"><label>Elevation (m)</label><input id="manualElev" type="number" step="0.001" placeholder="0.000" class="mono"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>Point Description</label><input id="manualDesc" type="text" placeholder="e.g. TP1, CP, Boundary Pillar"></div>
        <div class="form-group" style="display:flex;align-items:flex-end;">
          <button class="btn btn-green btn-full" onclick="confirmManualPoint()">âœ… Add Point</button>
        </div>
      </div>
    </div>

    <!-- Stats -->
    <div class="stat-row">
      <div class="stat-chip sc-dark"><div class="sv" id="ptCount">0</div><div class="sk">Points</div></div>
      <div class="stat-chip sc-green"><div class="sv" id="areaHa">0.0000</div><div class="sk">Hectares</div></div>
      <div class="stat-chip sc-blue"><div class="sv" id="areaAc">0.0000</div><div class="sk">Acres</div></div>
      <div class="stat-chip sc-orange"><div class="sv" id="areaSqm">0</div><div class="sk">Sq Metres</div></div>
      <div class="stat-chip sc-purple"><div class="sv" id="plotsCount">0.0</div><div class="sk">Plots(50Ã—100)</div></div>
    </div>
    <div class="stat-row" style="margin-top:0;">
      <div class="stat-chip sc-blue" style="grid-column:span 2"><div class="sv" id="perim">0.00</div><div class="sk">Perimeter (m)</div></div>
      <div class="stat-chip sc-green" style="grid-column:span 3"><div class="sv" id="bearingInfo" style="font-size:0.75rem;font-family:'Space Grotesk';letter-spacing:0">â€”</div><div class="sk">Last Bearing / Distance</div></div>
    </div>

    <!-- Points Table -->
    <div id="pointsTableWrap" style="overflow-x:auto;margin-bottom:16px;"></div>

    <!-- Actions -->
    <div class="btn-grid" style="gap:10px;">
      <button class="btn btn-green btn-lg" onclick="completeSurvey()">âœ… Complete & Save Survey</button>
      <button class="btn btn-blue" onclick="emailSurvey()">ğŸ“§ Email Report</button>
      <button class="btn" style="background:#25D366;color:#fff;" onclick="whatsappSurvey()">ğŸ“± WhatsApp</button>
      <button class="btn btn-gray" onclick="printSurvey()">ğŸ–¨ï¸ Print Report</button>
      <button class="btn btn-primary" onclick="exportSurveyJSON()">â¬‡ï¸ Export JSON</button>
      <button class="btn btn-orange" onclick="generateQR()">ğŸ“± QR Code</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• COORDINATES TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-coords">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸŒ</span><h2>Coordinate Conversion Tools</h2></div>
    <div class="sub-tabs">
      <button class="sub-tab active" id="ct-latutm" onclick="showCoord('latutm')">Lat/Lon â†” UTM</button>
      <button class="sub-tab" id="ct-bearing" onclick="showCoord('bearing')">Bearing & Distance</button>
      <button class="sub-tab" id="ct-multiformat" onclick="showCoord('multiformat')">Multi-Format</button>
      <button class="sub-tab" id="ct-traverse" onclick="showCoord('traverse')">Traverse Calc</button>
      <button class="sub-tab" id="ct-area" onclick="showCoord('area')">Area Calculator</button>
      <button class="sub-tab" id="ct-inverse" onclick="showCoord('inverse')">Inverse Calc</button>
    </div>

    <!-- Lat/UTM -->
    <div class="coord-pane active" id="cp-latutm">
      <div class="card-grid">
        <div style="background:#f0f9ff;border-radius:12px;padding:20px;">
          <h4 style="font-weight:700;margin-bottom:14px;">ğŸ“ Lat/Lon â†’ UTM</h4>
          <div class="form-group"><label>Latitude (Â°N or Â°S)</label><input id="ll-lat" type="number" step="0.0000001" placeholder="7.75771146" class="mono"></div>
          <div class="form-group"><label>Longitude (Â°E)</label><input id="ll-lon" type="number" step="0.0000001" placeholder="4.53887695" class="mono"></div>
          <div class="form-group"><label>UTM Zone (auto-detect or override)</label><input id="ll-zone" type="number" min="1" max="60" placeholder="31 (auto)" class="mono"></div>
          <button class="btn btn-blue btn-full" onclick="convLatToUTM()">Convert â†’</button>
          <div class="result-box" id="res-lltoutm"></div>
        </div>
        <div style="background:#f0fdf4;border-radius:12px;padding:20px;">
          <h4 style="font-weight:700;margin-bottom:14px;">ğŸ“ UTM â†’ Lat/Lon</h4>
          <div class="form-group"><label>UTM Zone</label><input id="utm-zone" type="number" min="1" max="60" placeholder="31" class="mono"></div>
          <div class="form-group"><label>Easting (m)</label><input id="utm-e" type="number" step="0.001" placeholder="707032.831" class="mono"></div>
          <div class="form-group"><label>Northing (m)</label><input id="utm-n" type="number" step="0.001" placeholder="857881.968" class="mono"></div>
          <div class="form-group"><label>Hemisphere</label><select id="utm-hemi"><option value="N">Northern</option><option value="S">Southern</option></select></div>
          <button class="btn btn-green btn-full" onclick="convUTMToLat()">Convert â†’</button>
          <div class="result-box" id="res-utmtoll"></div>
        </div>
      </div>
    </div>

    <!-- Bearing & Distance -->
    <div class="coord-pane" id="cp-bearing">
      <div style="background:#faf5ff;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ§­ Calculate Point from Bearing & Distance</h4>
        <div class="form-row">
          <div class="form-group"><label>Start Northing (m)</label><input id="bd-n" type="number" step="0.001" placeholder="857881.968" class="mono"></div>
          <div class="form-group"><label>Start Easting (m)</label><input id="bd-e" type="number" step="0.001" placeholder="707032.831" class="mono"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Bearing (0â€“360Â°)</label><input id="bd-bearing" type="number" step="0.0001" min="0" max="360" placeholder="45.0000" class="mono"></div>
          <div class="form-group"><label>Distance (m)</label><input id="bd-dist" type="number" step="0.001" placeholder="100.000" class="mono"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>Vertical Angle (optional Â°)</label><input id="bd-va" type="number" step="0.001" placeholder="0 = horizontal" class="mono"></div>
          <div class="form-group"><label>Instrument HI (m)</label><input id="bd-hi" type="number" step="0.001" placeholder="1.500" class="mono"></div>
        </div>
        <button class="btn btn-primary btn-full" onclick="calcBearingDist()">Calculate Point</button>
        <div class="result-box" id="bd-result"></div>
      </div>
    </div>

    <!-- Multi Format -->
    <div class="coord-pane" id="cp-multiformat">
      <div class="card-grid">
        <div style="background:#fffbeb;border-radius:12px;padding:20px;">
          <h4 style="font-weight:700;margin-bottom:14px;">Input Coordinates</h4>
          <div class="form-group"><label>Input Format</label>
            <select id="mf-format">
              <option value="dd">Decimal Degrees (e.g. 7.757)</option>
              <option value="dms">DMS (e.g. 7 45 25.5 N)</option>
              <option value="ddm">DDM (e.g. 7 45.425)</option>
            </select>
          </div>
          <div class="form-group"><label>Latitude</label><input id="mf-lat" placeholder="7.75771146" class="mono"></div>
          <div class="form-group"><label>Longitude</label><input id="mf-lon" placeholder="4.53887695" class="mono"></div>
          <button class="btn btn-orange btn-full" onclick="convertMultiFormat()">Convert All Formats â†’</button>
        </div>
        <div style="background:#f8fafc;border-radius:12px;padding:20px;">
          <h4 style="font-weight:700;margin-bottom:14px;">All Output Formats</h4>
          <div id="mf-results" style="font-size:0.82rem;"></div>
        </div>
      </div>
    </div>

    <!-- Traverse -->
    <div class="coord-pane" id="cp-traverse">
      <div style="background:#f0fdfa;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:8px;">ğŸ“ Closed Traverse Computation</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:14px;">Bowditch/Compass rule adjustment applied. Enter traverse legs and start coordinates.</p>
        <div class="form-row">
          <div class="form-group"><label>Start Northing (m)</label><input id="trav-n0" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
          <div class="form-group"><label>Start Easting (m)</label><input id="trav-e0" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
        </div>
        <button class="btn btn-green btn-sm" onclick="addTravLeg()" style="margin-bottom:10px;">+ Add Leg</button>
        <div id="trav-legs" style="margin-bottom:12px;display:flex;flex-direction:column;gap:8px;"></div>
        <div class="btn-grid">
          <button class="btn btn-primary" onclick="computeTraverse()">Compute Traverse</button>
          <button class="btn btn-gray" onclick="clearTraverse()">Clear Legs</button>
        </div>
        <div class="result-box" id="trav-result" style="margin-top:12px;overflow-x:auto;"></div>
      </div>
    </div>

    <!-- Area Calculator -->
    <div class="coord-pane" id="cp-area">
      <div style="background:#faf5ff;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ“ Area from Coordinates (Shoelace Formula)</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Enter N, E coordinate pairs (one per line or paste from spreadsheet)</p>
        <div class="form-group"><label>Northing values (one per line)</label><textarea id="area-n" rows="6" placeholder="857881.968&#10;857882.000&#10;857800.000&#10;857799.000" class="mono"></textarea></div>
        <div class="form-group"><label>Easting values (one per line)</label><textarea id="area-e" rows="6" placeholder="707032.831&#10;707200.000&#10;707200.000&#10;707032.000" class="mono"></textarea></div>
        <button class="btn btn-primary btn-full" onclick="calcAreaFromCoords()">Calculate Area</button>
        <div class="result-box" id="area-result"></div>
      </div>
    </div>

    <!-- Inverse Calc -->
    <div class="coord-pane" id="cp-inverse">
      <div style="background:#fef9f0;border-radius:12px;padding:20px;">
        <h4 style="font-weight:700;margin-bottom:14px;">ğŸ”„ Inverse Calculation (Distance & Bearing)</h4>
        <div class="card-grid">
          <div>
            <h5 style="font-size:0.85rem;font-weight:700;margin-bottom:10px;">Point A</h5>
            <div class="form-group"><label>Northing A (m)</label><input id="inv-n1" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
            <div class="form-group"><label>Easting A (m)</label><input id="inv-e1" type="number" step="0.001" placeholder="1000.000" class="mono"></div>
          </div>
          <div>
            <h5 style="font-size:0.85rem;font-weight:700;margin-bottom:10px;">Point B</h5>
            <div class="form-group"><label>Northing B (m)</label><input id="inv-n2" type="number" step="0.001" placeholder="1100.000" class="mono"></div>
            <div class="form-group"><label>Easting B (m)</label><input id="inv-e2" type="number" step="0.001" placeholder="1100.000" class="mono"></div>
          </div>
        </div>
        <button class="btn btn-orange btn-full" onclick="calcInverse()">Calculate Inverse</button>
        <div class="result-box" id="inv-result"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PLOT LAYOUT TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-plot">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ“</span><h2>Professional Survey Plot Layout</h2></div>
    <div class="form-row">
      <div class="form-group"><label>Plot Owner / Title Holder</label><input id="plotOwner" type="text" placeholder="Full legal name"></div>
      <div class="form-group"><label>Plot Address / Survey Number</label><input id="plotAddress" type="text" placeholder="Plot address or survey description"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Start Latitude (Â°)</label><input id="plotLat" type="number" step="0.0000001" placeholder="7.75771146" class="mono"></div>
      <div class="form-group"><label>Start Longitude (Â°)</label><input id="plotLon" type="number" step="0.0000001" placeholder="4.53887695" class="mono"></div>
    </div>
    <div class="form-row three">
      <div class="form-group"><label>Plot Width (m)</label><input id="plotWidth" type="number" value="15" step="0.1"></div>
      <div class="form-group"><label>Plot Depth (m)</label><input id="plotDepth" type="number" value="30" step="0.1"></div>
      <div class="form-group"><label>Orientation (Â°)</label><input id="plotOrient" type="number" value="0" step="0.1" placeholder="0 = North"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Scale</label><select id="plotScale"><option value="500">1:500</option><option value="1000">1:1000</option><option value="2500">1:2500</option><option value="5000">1:5000</option></select></div>
      <div class="form-group"><label>Plot Title</label><input id="plotTitle" type="text" placeholder="e.g. Survey Plan Showing..."></div>
    </div>
    <div class="btn-grid" style="margin-bottom:14px;">
      <button class="btn btn-primary" onclick="generatePlot()">ğŸ“ Generate Layout</button>
      <button class="btn btn-blue" onclick="exportPlot()">ğŸ’¾ Export PNG</button>
      <button class="btn btn-green" onclick="calcCanvasArea()">ğŸ“Š Calculate Area</button>
      <button class="btn btn-gray" onclick="clearPlotCanvas()">ğŸ—‘ï¸ Clear</button>
    </div>
    <canvas id="plotCanvas" width="900" height="600"></canvas>
    <div class="result-box" id="plotAreaResult" style="margin-top:12px;"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GIS TOOLS TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-gis">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ—ºï¸</span><h2>GIS & Remote Sensing Services</h2></div>
    <p style="color:var(--text2);font-size:0.88rem;margin-bottom:20px;">Professional geoinformatics services powered by SurveyPro Elite â€” 45% commission on every referral.</p>

    <div class="card-grid">
      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸ›°ï¸</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Satellite Data Access</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Multispectral imagery, NDVI analysis, land cover classification, change detection (2mâ€“30m resolution).</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦15,000 Â· Your cut: â‚¦6,750</div>
        <button class="btn btn-blue btn-full btn-sm" onclick="requestGIS('Satellite Data Access','15000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸŒ¾</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Agricultural Monitoring</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Crop health (NDVI/NDWI), yield prediction, irrigation optimization, precision farming reports.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦20,000 Â· Your cut: â‚¦9,000</div>
        <button class="btn btn-green btn-full btn-sm" onclick="requestGIS('Agricultural Monitoring','20000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸ™ï¸</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Urban Planning GIS</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Land use mapping, infrastructure planning, zoning analysis, urban growth modelling & visualizations.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦35,000 Â· Your cut: â‚¦15,750</div>
        <button class="btn btn-primary btn-full btn-sm" onclick="requestGIS('Urban Planning GIS','35000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸŒŠ</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Flood Risk Assessment</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Hydrological modelling, DEM extraction, drainage analysis, flood susceptibility mapping (FEMA-aligned).</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦40,000 Â· Your cut: â‚¦18,000</div>
        <button class="btn btn-blue btn-full btn-sm" onclick="requestGIS('Flood Risk Assessment','40000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸ—‚ï¸</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Cadastral Mapping</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Property boundary delineation, title surveys, land registry GIS database, parcel indexing.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦25,000 Â· Your cut: â‚¦11,250</div>
        <button class="btn btn-orange btn-full btn-sm" onclick="requestGIS('Cadastral Mapping','25000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸŒ¿</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Environmental Impact (EIA)</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Deforestation monitoring, biodiversity mapping, habitat analysis, NESREA-compliant EIA reports.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦50,000 Â· Your cut: â‚¦22,500</div>
        <button class="btn btn-green btn-full btn-sm" onclick="requestGIS('Environmental Impact Assessment','50000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸš</div>
        <h4 style="font-weight:700;margin-bottom:6px;">Drone Photogrammetry</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Aerial mapping, orthophoto, DSM/DTM generation, volumetric analysis, 3D point cloud.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦80,000 Â· Your cut: â‚¦36,000</div>
        <button class="btn btn-primary btn-full btn-sm" onclick="requestGIS('Drone Photogrammetry','80000')">Request Service</button></div>

      <div class="gis-card"><div style="font-size:2rem;margin-bottom:8px;">ğŸ—ï¸</div>
        <h4 style="font-weight:700;margin-bottom:6px;">BIM & 3D Modelling</h4>
        <p style="font-size:0.82rem;color:var(--text2);margin-bottom:12px;">Building Information Modelling, 3D laser scan to BIM, as-built documentation, clash detection.</p>
        <div style="font-size:0.75rem;color:var(--text3);margin-bottom:10px;">ğŸ’° From â‚¦60,000 Â· Your cut: â‚¦27,000</div>
        <button class="btn btn-blue btn-full btn-sm" onclick="requestGIS('BIM 3D Modelling','60000')">Request Service</button></div>
    </div>

    <div style="margin-top:20px;background:#0f172a;color:#fff;border-radius:var(--radius);padding:20px;text-align:center;">
      <p style="font-weight:700;font-size:1.05rem;">ğŸ“ Direct Contact: Arnold Opusunju</p>
      <p style="opacity:0.7;font-size:0.85rem;margin-top:6px;">+234-811-755-4948 Â· <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="cfa0bfbabcaebda1a0a3ab8fa8a2aea6a3e1aca0a2">[email&#160;protected]</a> Â· Opay: 8117554948</p>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• C of O VERIFY TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-verify">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ”’</span><h2>C of O Verification System</h2></div>
    <div style="background:#fffbeb;border-left:4px solid #d97706;border-radius:8px;padding:14px;margin-bottom:20px;font-size:0.85rem;">
      <strong>âš ï¸ Notice:</strong> This system verifies SurveyPro Elite-generated survey codes. For official government Certificate of Occupancy, contact your state land registry (Lagos, Abuja, etc.).
    </div>

    <div style="max-width:500px;">
      <div class="form-group">
        <label style="font-size:1rem;font-weight:700;">Enter Verification Code</label>
        <input id="verifyInput" type="text" placeholder="e.g. NGS-MLP6LZZD" class="mono" style="font-size:1.1rem;letter-spacing:0.08em;text-transform:uppercase;" oninput="this.value=this.value.toUpperCase()">
      </div>
      <button class="btn btn-primary btn-full btn-lg" onclick="verifySurveyCode()">ğŸ” Verify Code</button>
    </div>

    <div id="verifyResult" style="margin-top:20px;"></div>

    <div style="margin-top:24px;background:var(--surface3);border:2px solid #bfdbfe;border-radius:12px;padding:20px;">
      <h4 style="font-weight:700;margin-bottom:8px;">ğŸ“‹ Professional C of O Assistance</h4>
      <p style="font-size:0.85rem;color:var(--text2);margin-bottom:14px;">Need full C of O documentation, land title processing, or government registry coordination? Our team handles it end-to-end.</p>
      <div class="btn-grid">
        <button class="btn" style="background:#25D366;color:#fff;" onclick="requestCofO()">ğŸ“± WhatsApp Inquiry</button>
        <button class="btn btn-blue" onclick="emailCofO()">ğŸ“§ Email Inquiry</button>
      </div>
    </div>

    <!-- QR verification output -->
    <div id="qrSection" style="display:none;margin-top:20px;text-align:center;">
      <h4 style="font-weight:700;margin-bottom:10px;">ğŸ“± Scan to Verify</h4>
      <div id="qrContainer"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EQUIPMENT TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-equipment">
  <div class="card">
    <div class="card-header"><span class="card-icon">âš™ï¸</span><h2>Professional Equipment Rental Marketplace</h2></div>

    <div class="rev-split">
      <h3>ğŸ’° Revenue Split â€” Scale 1:10</h3>
      <div class="split-row">
        <div><div class="split-label">Your Platform Commission (Arnold)</div><div class="split-detail">Instant transfer Â· Opay: 8117554948</div></div>
        <div style="text-align:center;"><div class="split-pct">4.5</div><div style="font-size:0.75rem;opacity:0.75;">per 10 units</div></div>
      </div>
      <div class="split-row">
        <div><div class="split-label">Equipment Rental Partner</div><div class="split-detail">Licensed & insured equipment providers</div></div>
        <div style="text-align:center;"><div class="split-pct" style="color:#60a5fa;">5.5</div><div style="font-size:0.75rem;opacity:0.75;">per 10 units</div></div>
      </div>
      <div style="font-size:0.75rem;text-align:center;margin-top:12px;opacity:0.65;border-top:1px solid rgba(255,255,255,0.15);padding-top:10px;">Customer pays â†’ 45% auto-credited to Opay 8117554948 â†’ 55% routed to equipment partner</div>
    </div>

    <div class="card-grid" id="equipGrid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TRAINING TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-training">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ“</span><h2>Professional Training Hub</h2></div>
    <p style="color:var(--text2);font-size:0.88rem;margin-bottom:18px;">Industry-certified courses. 45% commission on every enrollment. Delivered by global leaders.</p>

    <div class="rev-split" style="margin-bottom:20px;">
      <h3>ğŸ’¡ Training Revenue Share</h3>
      <div class="split-row"><div><div class="split-label">Platform Owner (Arnold) Â· Opay: 8117554948</div></div><div class="split-pct">4.5</div></div>
      <div class="split-row"><div><div class="split-label">Course / Education Provider</div></div><div class="split-pct" style="color:#60a5fa;">5.5</div></div>
    </div>

    <div class="card-grid" id="coursesGrid"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HISTORY TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-history">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px;">
      <div class="card-header" style="margin-bottom:0;"><span class="card-icon">ğŸ“</span><h2>Survey History</h2></div>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-blue btn-sm" onclick="exportAllSurveysJSON()">â¬‡ï¸ Export All</button>
        <button class="btn btn-red btn-sm" onclick="clearAllHistory()">ğŸ—‘ï¸ Clear All</button>
      </div>
    </div>
    <div id="historyContent">
      <div style="text-align:center;padding:60px 20px;color:var(--text3);">
        <div style="font-size:3rem;margin-bottom:12px;">ğŸ“‚</div>
        <p style="font-size:1.1rem;font-weight:600;">No saved surveys yet</p>
        <p style="font-size:0.85rem;margin-top:6px;">Complete and save surveys to see them here</p>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REPORTS TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-reports">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ“„</span><h2>Professional Reports Generator</h2></div>
    <p style="color:var(--text2);font-size:0.88rem;margin-bottom:20px;">Generate professional, printable survey reports with official formatting.</p>
    <div class="form-row">
      <div class="form-group"><label>Select Survey</label>
        <select id="reportSurveySelect"><option value="">â€” Select a saved survey â€”</option></select>
      </div>
      <div class="form-group"><label>Report Type</label>
        <select id="reportType">
          <option>Full Survey Report</option>
          <option>Summary Certificate</option>
          <option>Client Invoice</option>
          <option>Field Data Sheet</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Surveyor's Name</label><input id="rptSurveyor" type="text" placeholder="Licensed Surveyor Name" value="Arnold Opusunju"></div>
      <div class="form-group"><label>License / SURCON Number</label><input id="rptLicense" type="text" placeholder="SURCON/2026/XXXXX"></div>
    </div>
    <div class="form-group"><label>Report Footer / Seal Statement</label><textarea id="rptFooter" rows="2" placeholder="This survey was conducted in accordance with..."></textarea></div>
    <div class="btn-grid">
      <button class="btn btn-primary" onclick="generateReport()">ğŸ“„ Generate Report</button>
      <button class="btn btn-blue" onclick="printReport()">ğŸ–¨ï¸ Print</button>
      <button class="btn btn-green" onclick="emailReport()">ğŸ“§ Email Report</button>
      <button class="btn btn-gray" onclick="previewReport()">ğŸ‘ï¸ Preview</button>
    </div>
    <div id="reportPreview" style="margin-top:20px;"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PRICING TAB â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-pricing">
  <div class="card">
    <div class="card-header"><span class="card-icon">ğŸ’</span><h2>Pricing & Service Packages</h2></div>
    <p style="color:var(--text2);font-size:0.88rem;margin-bottom:24px;text-align:center;">Professional surveying services at transparent, competitive rates. All prices in Nigerian Naira.</p>

    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px;margin-bottom:30px;">
      <!-- Basic -->
      <div style="border:2px solid var(--border);border-radius:var(--radius);padding:24px;text-align:center;">
        <div style="font-size:0.8rem;font-weight:700;color:var(--text2);letter-spacing:0.08em;margin-bottom:8px;">BASIC</div>
        <div style="font-family:'Syne',sans-serif;font-size:2.5rem;font-weight:800;color:var(--text);">Free</div>
        <div style="font-size:0.8rem;color:var(--text3);margin-bottom:16px;">GPS + Coordinates + Plot Layout</div>
        <ul style="text-align:left;font-size:0.82rem;list-style:none;display:flex;flex-direction:column;gap:7px;margin-bottom:20px;">
          <li>âœ… Unlimited GPS points</li>
          <li>âœ… All coordinate conversions</li>
          <li>âœ… Plot layout tool</li>
          <li>âœ… Survey history</li>
          <li>âŒ Advanced reports</li>
          <li>âŒ API access</li>
        </ul>
        <button class="btn btn-outline btn-full">Get Started Free</button>
      </div>
      <!-- Pro -->
      <div style="border:3px solid var(--accent);border-radius:var(--radius);padding:24px;text-align:center;background:var(--surface2);position:relative;">
        <div style="position:absolute;top:-13px;left:50%;transform:translateX(-50%);background:var(--accent);color:#fff;padding:4px 16px;border-radius:20px;font-size:0.75rem;font-weight:700;white-space:nowrap;">MOST POPULAR</div>
        <div style="font-size:0.8rem;font-weight:700;color:var(--accent);letter-spacing:0.08em;margin-bottom:8px;">PROFESSIONAL</div>
        <div style="font-family:'Syne',sans-serif;font-size:2.5rem;font-weight:800;color:var(--accent);">â‚¦5,000<span style="font-size:1rem;color:var(--text2)">/mo</span></div>
        <div style="font-size:0.8rem;color:var(--text3);margin-bottom:16px;">Full platform access</div>
        <ul style="text-align:left;font-size:0.82rem;list-style:none;display:flex;flex-direction:column;gap:7px;margin-bottom:20px;">
          <li>âœ… Everything in Basic</li>
          <li>âœ… Professional PDF reports</li>
          <li>âœ… Traverse computation</li>
          <li>âœ… GIS service referrals</li>
          <li>âœ… WhatsApp integration</li>
          <li>âœ… Priority support</li>
        </ul>
        <button class="btn btn-green btn-full" onclick="subscribePro()">Subscribe â€” â‚¦5,000/mo</button>
      </div>
      <!-- Enterprise -->
      <div style="border:2px solid var(--accent2);border-radius:var(--radius);padding:24px;text-align:center;background:var(--surface3);">
        <div style="font-size:0.8rem;font-weight:700;color:var(--accent2);letter-spacing:0.08em;margin-bottom:8px;">ENTERPRISE</div>
        <div style="font-family:'Syne',sans-serif;font-size:2.5rem;font-weight:800;color:var(--accent2);">â‚¦25,000<span style="font-size:1rem;color:var(--text2)">/mo</span></div>
        <div style="font-size:0.8rem;color:var(--text3);margin-bottom:16px;">For survey firms & agencies</div>
        <ul style="text-align:left;font-size:0.82rem;list-style:none;display:flex;flex-direction:column;gap:7px;margin-bottom:20px;">
          <li>âœ… Unlimited users</li>
          <li>âœ… White-label options</li>
          <li>âœ… API access & webhooks</li>
          <li>âœ… Custom branding</li>
          <li>âœ… Dedicated account manager</li>
          <li>âœ… SLA guarantee</li>
        </ul>
        <button class="btn btn-blue btn-full" onclick="contactEnterprise()">Contact for Enterprise</button>
      </div>
    </div>

    <!-- Survey Service Rates -->
    <h3 style="font-family:'Syne',sans-serif;font-weight:700;margin-bottom:14px;">ğŸ“‹ Professional Survey Service Rates</h3>
    <div style="overflow-x:auto;">
      <table class="data-table">
        <thead><tr><th>Service</th><th>Rate (From)</th><th>Unit</th><th>Notes</th></tr></thead>
        <tbody>
          <tr><td>Boundary Survey</td><td class="mono">â‚¦50,000</td><td>Per plot</td><td>Includes beaconing</td></tr>
          <tr><td>Topographic Survey</td><td class="mono">â‚¦15,000</td><td>Per hectare</td><td>Min 2ha</td></tr>
          <tr><td>Cadastral Survey</td><td class="mono">â‚¦80,000</td><td>Per parcel</td><td>Gov-certified</td></tr>
          <tr><td>Engineering Survey</td><td class="mono">â‚¦100,000</td><td>Per project</td><td>Depends on scope</td></tr>
          <tr><td>Drone Aerial Survey</td><td class="mono">â‚¦80,000</td><td>Per day</td><td>Incl. processing</td></tr>
          <tr><td>C of O Processing</td><td class="mono">â‚¦150,000</td><td>Per title</td><td>State-specific</td></tr>
          <tr><td>GIS Report</td><td class="mono">â‚¦25,000</td><td>Per report</td><td>Custom analysis</td></tr>
          <tr><td>Training (per person)</td><td class="mono">â‚¦18,000</td><td>Per course</td><td>6-16 hours</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

</main>

<!-- FOOTER -->
<footer>
  <div class="footer-inner">
    <div class="footer-grid">
      <div class="footer-brand">
        <h3 class="display">ğŸ¯ SurveyPro <span>Elite</span></h3>
        <p>Nigeria's premier professional land surveying platform. WGS84, UTM, NNO compliant. Trusted by surveyors across all 36 states.</p>
        <div style="margin-top:14px;display:flex;gap:8px;flex-wrap:wrap;">
          <span class="badge badge-green">ğŸŒ¿ Eco-Certified</span>
          <span class="badge badge-blue">WGS84</span>
          <span class="badge badge-gold">SURCON Aligned</span>
        </div>
      </div>
      <div class="footer-links">
        <h4>Platform</h4>
        <ul>
          <li>GPS Survey Tool</li><li>Coordinate Conversion</li>
          <li>Plot Layout Generator</li><li>GIS Services</li>
          <li>C of O Verification</li>
        </ul>
      </div>
      <div class="footer-links">
        <h4>Commercial</h4>
        <ul>
          <li>Equipment Rental (45% cut)</li><li>Training Courses (45% cut)</li>
          <li>GIS Referrals (45% cut)</li><li>Pro Subscription</li>
          <li>Enterprise Plans</li>
        </ul>
      </div>
      <div class="footer-contact">
        <h4 style="font-weight:700;margin-bottom:12px;font-size:0.9rem;">Contact</h4>
        <p>ğŸ“ +234-811-755-4948</p>
        <p>ğŸ“§ <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="137c63666072617d7c7f7753747e727a7f3d707c7e">[email&#160;protected]</a></p>
        <p>ğŸ’³ Opay: 8117554948</p>
        <p>ğŸ’¬ WhatsApp: 08117554948</p>
        <p style="margin-top:10px;font-size:0.78rem;opacity:0.5;">Monâ€“Sat: 8AMâ€“6PM WAT</p>
      </div>
    </div>
    <div class="footer-bottom">
      Â© 2026 SurveyPro Elite Â· All Rights Reserved Â· 45% Commission Model Â· WGS84 Â· UTM 31â€“33N Â· NNO<br>
      Built for Commercial Use Â· Ready for Market Â· Eco-Friendly Digital Platform
    </div>
  </div>
</footer>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIGURATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CFG = {
  phone: '2348117554948',
  opay: '8117554948',
  email: 'opusarnold@gmail.com',
  name: 'Arnold Opusunju',
  business: 'SurveyPro Elite',
  whatsapp: 'https://wa.me/2348117554948',
  commission: 0.45
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let gpsPos = null, watchId = null;
let surveyPts = [];
let surveys = [];
let plotPts = [];
let travLegData = [];
let darkMode = false;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COURSES DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COURSES = [
  {id:'gis',name:'Advanced GIS Mapping',price:25000,dur:'12 hrs',level:'Beginner',desc:'Master QGIS and ArcGIS for professional surveying workflows. Map projections, attribute tables, spatial analysis.',platform:'QGIS Academy'},
  {id:'drone',name:'Drone Surveying & Photogrammetry',price:45000,dur:'16 hrs',level:'Intermediate',desc:'Aerial mapping, LiDAR techniques, 3D point cloud processing, orthophoto generation with Pix4D.',platform:'Pix4D Academy'},
  {id:'ai',name:'AI in Land Surveying',price:35000,dur:'10 hrs',level:'Advanced',desc:'Machine learning for automated feature extraction, classification, predictive land analysis.',platform:'Coursera'},
  {id:'rtk',name:'RTK/GNSS Fundamentals',price:20000,dur:'8 hrs',level:'Beginner',desc:'High-precision GPS techniques for cadastral and engineering surveys. Network RTK, CORS stations.',platform:'Trimble Academy'},
  {id:'autocad',name:'AutoCAD Civil 3D for Surveyors',price:30000,dur:'14 hrs',level:'Intermediate',desc:'Drawing, annotation, surface modelling, corridors, alignments and professional survey deliverables.',platform:'Autodesk'},
  {id:'total',name:'Total Station Operations',price:18000,dur:'6 hrs',level:'Beginner',desc:'Field setup, traversing, stakeout, EDM ranging, and digital data management with Leica.',platform:'Leica Academy'},
  {id:'cofo',name:'C of O Processing & Land Law',price:40000,dur:'10 hrs',level:'Intermediate',desc:'Land Use Act, state land laws, C of O application process, due diligence, title verification.',platform:'NIESV'},
  {id:'remote',name:'Remote Sensing Fundamentals',price:22000,dur:'9 hrs',level:'Beginner',desc:'NDVI, SAR, multispectral analysis, Sentinel/Landsat data processing, land cover mapping.',platform:'ESA EO Campus'}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EQUIPMENT DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const EQUIPMENT = [
  {icon:'ğŸ¯',name:'Total Station',model:'Leica TS16 / TS06',price:20000,desc:'High-precision 2" electronic theodolite with integrated EDM, Bluetooth and onboard memory storage.',features:['2" angular accuracy','3km EDM range','Bluetooth data transfer','Includes tripod & prism set'],link:'https://leica-geosystems.com'},
  {icon:'ğŸ“¡',name:'RTK GNSS Receiver',model:'Trimble R10 / R12i',price:20000,desc:'Multi-constellation RTK GNSS with centimetre-level accuracy, integrated UHF modem and cloud sync.',features:['8mm RTK accuracy','All-constellation GNSS (GPS+GLONASS+BDS)','UHF radio integrated','Real-time cloud sync'],link:'https://trimble.com'},
  {icon:'ğŸš',name:'Survey Drone',model:'DJI Phantom 4 RTK',price:25000,desc:'Professional aerial mapping drone with RTK, 20MP Hasselblad camera, and Pix4D photogrammetry suite.',features:['RTK cm-level accuracy','20MP sensor','Includes Pix4D software licence','45-min flight time'],link:'https://dji.com'},
  {icon:'ğŸ“',name:'Digital Level',model:'Leica DNA03',price:8000,desc:'High-precision digital auto-level for precise elevation and height difference measurements.',features:['0.3mm/km accuracy','Auto bar-code reading','2000-point internal memory','With invar staff included'],link:'https://leica-geosystems.com'},
  {icon:'âš¡',name:'3D Laser Scanner',model:'Leica RTC360',price:30000,desc:'Ultra-fast 3D reality capture scanner for BIM, heritage documentation, and infrastructure surveys.',features:['2M points/sec scan speed','360Â° full-sphere capture','HDR panoramic imaging','Auto-register in field'],link:'https://leica-geosystems.com'},
  {icon:'ğŸ”­',name:'Electronic Theodolite',model:'Topcon DT-209L',price:6000,desc:'Professional 9" electronic theodolite with dual-axis compensation and digital display readout.',features:['9" angular accuracy','Dual-axis compensation','Backlit digital display','IP54 waterproof rating'],link:'https://topcon.com'},
  {icon:'ğŸŒ',name:'Handheld GPS',model:'Garmin GPSMAP 66st',price:3000,desc:'Rugged multi-constellation handheld GPS for field navigation, waypoint collection, and area estimation.',features:['3-5m accuracy','All-weather IPX7','100,000-point capacity','Topo maps pre-loaded'],link:'https://garmin.com'},
  {icon:'ğŸ“Œ',name:'Ground Penetrating Radar',model:'GSSI SIR 4000',price:50000,desc:'Professional GPR for subsurface utility mapping, void detection, rebar location, and buried pipe surveys.',features:['Multi-frequency antennas','Real-time 3D display','IQBS target identification','GPS integration'],link:'https://geophysical.com'}
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  loadSurveys();
  buildEquipment();
  buildCourses();
  updateHistory();
  updateReportDropdown();
  initPlotCanvas();
  // Fix duplicate ID in tab button switching
  document.getElementById('modalBg').addEventListener('click', e => {
    if (e.target === document.getElementById('modalBg')) closeModal();
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showTab(t) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
  const tc = document.getElementById('tab-' + t);
  if (tc) { tc.classList.add('active'); }
  const nb = document.getElementById('nb-' + t);
  if (nb) nb.classList.add('active');
  if (t === 'plot') setTimeout(initPlotCanvas, 100);
  if (t === 'history') updateHistory();
  if (t === 'reports') updateReportDropdown();
  window.scrollTo({top:0,behavior:'smooth'});
}

function showCoord(c) {
  document.querySelectorAll('.coord-pane').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.sub-tab').forEach(el => el.classList.remove('active'));
  const cp = document.getElementById('cp-' + c);
  if (cp) cp.classList.add('active');
  const ct = document.getElementById('ct-' + c);
  if (ct) ct.classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GPS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function enableGPS() {
  if (!navigator.geolocation) { toast('GPS not supported by this browser','error'); return; }
  const box = g('gpsInfoBox');
  box.innerHTML = '<p style="color:var(--accent2);">ğŸ”„ Acquiring GPS signal... Please wait and remain outdoors.</p>';
  watchId = navigator.geolocation.watchPosition(pos => {
    gpsPos = pos.coords;
    const acc = pos.coords.accuracy;
    const accClass = acc < 5 ? 'color:#16a34a' : acc < 15 ? 'color:#d97706' : 'color:#dc2626';
    const accTxt = acc < 5 ? 'ğŸŸ¢ High' : acc < 15 ? 'ğŸŸ¡ Medium' : 'ğŸ”´ Low';
    box.innerHTML = `<p style="font-weight:700;color:var(--accent);margin-bottom:8px;">âœ… GPS Active â€” ${accTxt} Accuracy</p>`;
    g('gpsInfoGrid').style.display = 'grid';
    g('gpsInfoGrid').innerHTML = `
      <div class="gps-info-item"><div class="label">LATITUDE</div><div class="val">${pos.coords.latitude.toFixed(7)}Â°</div></div>
      <div class="gps-info-item"><div class="label">LONGITUDE</div><div class="val">${pos.coords.longitude.toFixed(7)}Â°</div></div>
      <div class="gps-info-item"><div class="label">ACCURACY</div><div class="val" style="${accClass}">Â±${acc.toFixed(1)} m</div></div>
      <div class="gps-info-item"><div class="label">ALTITUDE</div><div class="val">${(pos.coords.altitude||0).toFixed(1)} m</div></div>
      <div class="gps-info-item"><div class="label">SPEED</div><div class="val">${(pos.coords.speed||0).toFixed(2)} m/s</div></div>
      <div class="gps-info-item"><div class="label">HEADING</div><div class="val">${pos.coords.heading ? pos.coords.heading.toFixed(1)+'Â°' : 'N/A'}</div></div>`;
    g('gpsDot').className = 'gps-dot active';
    g('gpsLabel').textContent = `GPS Â±${acc.toFixed(0)}m`;
  }, err => {
    toast('GPS error: ' + err.message, 'error');
    g('gpsDot').className = 'gps-dot';
    g('gpsLabel').textContent = 'GPS Error';
  }, { enableHighAccuracy: true, maximumAge: 500, timeout: 15000 });
}

function stopGPS() {
  if (watchId !== null) { navigator.geolocation.clearWatch(watchId); watchId = null; }
  g('gpsDot').className = 'gps-dot';
  g('gpsLabel').textContent = 'GPS Off';
  g('gpsInfoGrid').style.display = 'none';
  g('gpsInfoBox').innerHTML = '<p style="color:var(--text2);font-size:0.85rem;">GPS stopped. Click Enable GPS to restart.</p>';
  toast('GPS stopped','info');
}

function getCurrentLocationInfo() {
  if (!navigator.geolocation) { toast('GPS not supported','error'); return; }
  navigator.geolocation.getCurrentPosition(pos => {
    const utm = latLonToUTM(pos.coords.latitude, pos.coords.longitude);
    openModal(`<div>
      <h3 style="font-weight:700;font-size:1.1rem;margin-bottom:16px;">ğŸ“ Current Location</h3>
      <div style="display:grid;gap:8px;font-size:0.85rem;">
        <div style="background:#f8fafc;padding:10px;border-radius:8px;"><strong>Lat/Lon:</strong> <span class="mono">${pos.coords.latitude.toFixed(7)}Â°N, ${pos.coords.longitude.toFixed(7)}Â°E</span></div>
        <div style="background:#f8fafc;padding:10px;border-radius:8px;"><strong>UTM Zone ${utm.zone}N:</strong> <span class="mono">E: ${utm.easting.toFixed(3)} N: ${utm.northing.toFixed(3)}</span></div>
        <div style="background:#f8fafc;padding:10px;border-radius:8px;"><strong>Accuracy:</strong> Â±${pos.coords.accuracy.toFixed(1)}m | Alt: ${(pos.coords.altitude||0).toFixed(1)}m</div>
      </div>
      <button class="btn btn-primary btn-full" style="margin-top:14px;" onclick="closeModal()">Close</button>
    </div>`);
  }, err => toast('Location error: '+err.message,'error'), {enableHighAccuracy:true,timeout:10000});
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SURVEY POINTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addGPSPoint() {
  if (!gpsPos) { toast('Enable GPS first','warning'); return; }
  const utm = latLonToUTM(gpsPos.latitude, gpsPos.longitude);
  surveyPts.push({
    id: surveyPts.length + 1,
    lat: gpsPos.latitude, lon: gpsPos.longitude,
    n: utm.northing, e: utm.easting,
    elev: gpsPos.altitude || 0,
    acc: gpsPos.accuracy, src: 'GPS',
    desc: 'GPS Point ' + (surveyPts.length + 1),
    ts: new Date().toISOString()
  });
  updateSurveyDisplay();
  toast(`GPS Point ${surveyPts.length} added (Â±${gpsPos.accuracy.toFixed(1)}m)`,'success');
}

function addManualPointToggle() {
  const box = g('manualBox');
  box.classList.toggle('open');
}

function confirmManualPoint() {
  const n = parseFloat(g('manualN').value);
  const e = parseFloat(g('manualE').value);
  const elev = parseFloat(g('manualElev').value) || 0;
  const desc = g('manualDesc').value.trim() || ('Point ' + (surveyPts.length + 1));
  if (isNaN(n) || isNaN(e)) { toast('Enter valid N, E coordinates','warning'); return; }
  surveyPts.push({ id: surveyPts.length+1, n, e, elev, lat:0, lon:0, src:'Manual', desc, ts: new Date().toISOString() });
  g('manualN').value = ''; g('manualE').value = ''; g('manualElev').value = ''; g('manualDesc').value = '';
  g('manualBox').classList.remove('open');
  updateSurveyDisplay();
  toast(`Manual Point ${surveyPts.length} added`,'success');
}

function undoPoint() {
  if (surveyPts.length === 0) { toast('No points to undo','warning'); return; }
  const removed = surveyPts.pop();
  updateSurveyDisplay();
  toast(`Point ${removed.id} removed`,'info');
}

function clearSurvey() {
  if (surveyPts.length === 0) return;
  if (!confirm('Clear all survey points? This cannot be undone.')) return;
  surveyPts = [];
  updateSurveyDisplay();
  toast('Survey cleared','info');
}

function importCSVPoints() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.csv,.txt';
  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      const lines = ev.target.result.split('\n').filter(l => l.trim());
      let added = 0;
      lines.forEach(line => {
        const parts = line.split(/[,\t]/);
        if (parts.length >= 2) {
          const n = parseFloat(parts[0]), e = parseFloat(parts[1]), el = parseFloat(parts[2]) || 0;
          if (!isNaN(n) && !isNaN(e)) {
            surveyPts.push({id:surveyPts.length+1,n,e,elev:el,lat:0,lon:0,src:'CSV',desc:`CSV-${surveyPts.length+1}`,ts:new Date().toISOString()});
            added++;
          }
        }
      });
      updateSurveyDisplay();
      toast(`${added} points imported from CSV`,'success');
    };
    reader.readAsText(file);
  };
  input.click();
}

function updateSurveyDisplay() {
  const n = surveyPts.length;
  g('ptCount').textContent = n;
  let ha = 0, ac = 0, perim = 0, sqm = 0;
  if (n >= 3) {
    sqm = shoelace(surveyPts);
    ha = sqm / 10000;
    ac = ha * 2.47105;
    perim = calcPerimeter(surveyPts);
  }
  g('areaHa').textContent = ha.toFixed(4);
  g('areaAc').textContent = ac.toFixed(4);
  g('areaSqm').textContent = sqm.toFixed(0);
  g('plotsCount').textContent = (ha * 10000 / 1500).toFixed(1);
  g('perim').textContent = perim.toFixed(2);

  if (n >= 2) {
    const p1 = surveyPts[n-2], p2 = surveyPts[n-1];
    const dn = p2.n - p1.n, de = p2.e - p1.e;
    const dist = Math.sqrt(dn*dn + de*de);
    const bear = ((Math.atan2(de, dn) * 180 / Math.PI) + 360) % 360;
    g('bearingInfo').textContent = `Bearing: ${bear.toFixed(4)}Â° Â· Dist: ${dist.toFixed(3)}m`;
  }

  if (n === 0) { g('pointsTableWrap').innerHTML = ''; return; }
  let html = `<table class="data-table"><thead><tr><th>Pt</th><th>Description</th><th>Northing (m)</th><th>Easting (m)</th><th>Elevation (m)</th><th>Src</th><th>Acc</th></tr></thead><tbody>`;
  surveyPts.forEach(p => {
    html += `<tr><td style="text-align:center;font-weight:700;">${p.id}</td><td>${p.desc||''}</td><td class="mono">${p.n.toFixed(3)}</td><td class="mono">${p.e.toFixed(3)}</td><td class="mono">${p.elev.toFixed(3)}</td><td style="text-align:center;">${p.src}</td><td style="text-align:center;">${p.acc?'Â±'+p.acc.toFixed(1)+'m':'â€”'}</td></tr>`;
  });
  html += '</tbody></table>';
  g('pointsTableWrap').innerHTML = html;
}

function completeSurvey() {
  const cN = v('clientName'), cP = v('clientPhone'), pN = v('projectName'), loc = v('location');
  if (!cN || !cP || !pN || !loc) { toast('Fill all required client fields (*)','warning'); return; }
  if (surveyPts.length < 3) { toast('Need at least 3 survey points','warning'); return; }
  const sqm = shoelace(surveyPts), ha = sqm/10000, ac = ha*2.47105, perim = calcPerimeter(surveyPts);
  const code = 'NGS-' + Math.random().toString(36).substr(2,8).toUpperCase();
  const survey = {
    id: Date.now(), clientName:cN, clientPhone:cP, clientEmail:v('clientEmail'),
    clientNIN:v('clientNIN'), projectName:pN, location:loc, fileNumber:v('fileNumber'),
    surveyType:v('surveyType'), hectares:ha, acres:ac, sqm, perimeter:perim,
    plots:ha*10000/1500, points:surveyPts.length, verificationCode:code,
    savedAt:new Date().toISOString(), coordSystem:v('coordSys'),
    hDatum:v('hDatum'), vDatum:v('vDatum'), notes:v('surveyNotes'),
    pts: JSON.parse(JSON.stringify(surveyPts)),
    surveyor: CFG.name
  };
  surveys.push(survey);
  saveSurveys();
  updateHistory();
  updateReportDropdown();

  openModal(`<div style="text-align:center;">
    <div style="font-size:4rem;margin-bottom:10px;">âœ…</div>
    <h3 style="font-family:'Syne',sans-serif;font-size:1.4rem;font-weight:800;color:var(--accent);margin-bottom:16px;">Survey Complete!</h3>
    <div style="background:#f0fdf4;border:2px dashed var(--accent);border-radius:12px;padding:20px;margin-bottom:18px;">
      <div style="font-size:0.75rem;color:var(--text3);margin-bottom:4px;">VERIFICATION CODE</div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:1.6rem;font-weight:700;color:var(--accent);letter-spacing:0.1em;">${code}</div>
      <div style="font-size:0.72rem;color:var(--text3);margin-top:4px;">${v('coordSys')}</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;">
      <div style="background:#f0fdf4;border-radius:10px;padding:12px;"><div style="font-size:0.72rem;color:var(--text3);">Hectares</div><div style="font-size:1.4rem;font-weight:800;color:var(--accent);">${ha.toFixed(4)}</div></div>
      <div style="background:#eff6ff;border-radius:10px;padding:12px;"><div style="font-size:0.72rem;color:var(--text3);">Acres</div><div style="font-size:1.4rem;font-weight:800;color:var(--accent2);">${ac.toFixed(4)}</div></div>
      <div style="background:#f8fafc;border-radius:10px;padding:12px;"><div style="font-size:0.72rem;color:var(--text3);">Sq Metres</div><div style="font-size:1.2rem;font-weight:800;">${sqm.toFixed(2)}</div></div>
      <div style="background:#fffbeb;border-radius:10px;padding:12px;"><div style="font-size:0.72rem;color:var(--text3);">Perimeter (m)</div><div style="font-size:1.2rem;font-weight:800;">${perim.toFixed(2)}</div></div>
    </div>
    <div style="background:#f8fafc;border-radius:10px;padding:12px;text-align:left;font-size:0.82rem;margin-bottom:16px;">
      <div><strong>Client:</strong> ${cN} Â· ${cP}</div>
      <div><strong>Project:</strong> ${pN} Â· ${loc}</div>
      <div><strong>Points:</strong> ${surveyPts.length} Â· Type: ${v('surveyType')}</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
      <button class="btn btn-green" onclick="closeModal()">Done âœ“</button>
      <button class="btn btn-blue" onclick="closeModal();showTab('history')">View History</button>
    </div>
  </div>`);
  surveyPts = [];
  updateSurveyDisplay();
}

function emailSurvey() {
  const email = v('clientEmail');
  if (!email) { toast('Enter client email first','warning'); return; }
  const body = `SURVEY REPORT\n\nProject: ${v('projectName')}\nLocation: ${v('location')}\nClient: ${v('clientName')}\nPhone: ${v('clientPhone')}\n\nPoints: ${surveyPts.length}\nSurveyor: ${CFG.name}\nContact: ${CFG.email} Â· +234-811-755-4948\n\nâ€” SurveyPro Elite`;
  window.location.href = `mailto:${email}?subject=Survey Report - ${v('projectName')}&body=${encodeURIComponent(body)}`;
}

function whatsappSurvey() {
  const n = surveyPts.length;
  let ha = 0, ac = 0;
  if (n >= 3) { const sqm = shoelace(surveyPts); ha = sqm/10000; ac = ha*2.47105; }
  const msg = `ğŸ“Š *SURVEY REPORT â€” SurveyPro Elite*\n\n*Project:* ${v('projectName')||'N/A'}\n*Client:* ${v('clientName')||'N/A'}\n*Location:* ${v('location')||'N/A'}\n*Points:* ${n}\n*Area:* ${ha.toFixed(4)} ha / ${ac.toFixed(4)} acres\n\n*Surveyor:* ${CFG.name}\nğŸ“§ ${CFG.email}\nğŸ“ +234-811-755-4948`;
  window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank');
}

function printSurvey() {
  const pN = v('projectName') || 'Survey Project';
  const n = surveyPts.length;
  let ha = 0, ac = 0, sqm = 0, perim = 0;
  if (n >= 3) { sqm = shoelace(surveyPts); ha = sqm/10000; ac = ha*2.47105; perim = calcPerimeter(surveyPts); }
  let tableRows = surveyPts.map(p=>`<tr><td>${p.id}</td><td>${p.desc||''}</td><td class="mono">${p.n.toFixed(3)}</td><td class="mono">${p.e.toFixed(3)}</td><td class="mono">${p.elev.toFixed(3)}</td><td>${p.src}</td></tr>`).join('');
  const html=`<!DOCTYPE html><html><head><title>Survey Report â€” ${pN}</title><style>body{font-family:Arial,sans-serif;max-width:800px;margin:30px auto;padding:20px;color:#111;}h1{font-size:1.4rem;text-align:center;}table{width:100%;border-collapse:collapse;margin-top:14px;}th,td{border:1px solid #ccc;padding:6px 10px;font-size:0.82rem;}th{background:#0f172a;color:#fff;}.mono{font-family:monospace;}.header{text-align:center;border-bottom:2px solid #0f172a;padding-bottom:14px;margin-bottom:18px;}.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:14px 0;}.stat{background:#f8fafc;border:1px solid #e2e8f0;padding:10px;border-radius:6px;text-align:center;}.sl{font-size:0.72rem;color:#666;}.sv{font-weight:700;font-size:1.2rem;}</style></head><body>
  <div class="header"><h1>SURVEY REPORT</h1><p>SurveyPro Elite | ${CFG.name} | ${new Date().toLocaleDateString('en-NG')}</p></div>
  <p><strong>Project:</strong> ${pN} | <strong>Location:</strong> ${v('location')}</p>
  <p><strong>Client:</strong> ${v('clientName')} | <strong>Phone:</strong> ${v('clientPhone')} | <strong>Type:</strong> ${v('surveyType')}</p>
  <p><strong>System:</strong> ${v('coordSys')} | <strong>Datum:</strong> ${v('hDatum')}</p>
  <div class="grid">
  <div class="stat"><div class="sl">HECTARES</div><div class="sv">${ha.toFixed(4)}</div></div>
  <div class="stat"><div class="sl">ACRES</div><div class="sv">${ac.toFixed(4)}</div></div>
  <div class="stat"><div class="sl">SQ METRES</div><div class="sv">${sqm.toFixed(2)}</div></div>
  <div class="stat"><div class="sl">PERIMETER (m)</div><div class="sv">${perim.toFixed(2)}</div></div>
  </div>
  <table><thead><tr><th>Pt</th><th>Description</th><th>Northing (m)</th><th>Easting (m)</th><th>Elevation (m)</th><th>Source</th></tr></thead><tbody>${tableRows}</tbody></table>
  <p style="margin-top:20px;font-size:0.75rem;color:#888;">Generated by SurveyPro Elite Â· ${CFG.email} Â· +234-811-755-4948 Â· Eco-Certified Digital Platform</p>
  <script>window.print();<\/script>
<!-- PWA Install Banner -->
<div id="pwaInstallBanner" style="display:none;position:fixed;bottom:0;left:0;right:0;background:linear-gradient(135deg,#0f172a,#064e3b);color:#fff;padding:14px 20px;z-index:999;display:none;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;">
  <div style="display:flex;align-items:center;gap:10px;">
    <span style="font-size:1.5rem;">ğŸ¯</span>
    <div><div style="font-weight:700;font-size:0.9rem;">Install SurveyPro Elite</div><div style="font-size:0.75rem;opacity:0.75;">Add to home screen for offline access</div></div>
  </div>
  <div style="display:flex;gap:8px;">
    <button onclick="installPWA()" style="background:#16a34a;color:#fff;border:none;padding:8px 18px;border-radius:8px;font-weight:700;cursor:pointer;font-family:inherit;">ğŸ“² Install</button>
    <button onclick="document.getElementById('pwaInstallBanner').style.display='none'" style="background:rgba(255,255,255,0.15);color:#fff;border:none;padding:8px 14px;border-radius:8px;cursor:pointer;">âœ•</button>
  </div>
</div>

<!-- Offline Indicator -->
<div id="offlineBar" style="display:none;position:fixed;top:0;left:0;right:0;background:#dc2626;color:#fff;text-align:center;padding:8px;font-size:0.82rem;font-weight:600;z-index:9999;">
  ğŸ“µ You are offline â€” Surveys are saved locally and will sync when reconnected
</div>

<script>
// â•â•â•â• PWA Install Prompt â•â•â•â•
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  const banner = document.getElementById('pwaInstallBanner');
  if (banner) { banner.style.display = 'flex'; }
});
function installPWA() {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  deferredPrompt.userChoice.then(r => {
    if (r.outcome === 'accepted') { toast('App installed! ğŸ‰ Find SurveyPro Elite on your home screen','success'); }
    deferredPrompt = null;
    document.getElementById('pwaInstallBanner').style.display = 'none';
  });
}
window.addEventListener('appinstalled', () => { toast('SurveyPro Elite installed successfully!','success'); });

// â•â•â•â• Offline Detection â•â•â•â•
function updateOnlineStatus() {
  const bar = document.getElementById('offlineBar');
  if (bar) bar.style.display = navigator.onLine ? 'none' : 'block';
  if (!navigator.onLine) toast('You are offline â€” data saved locally','warning');
  else toast('Back online!','success');
}
window.addEventListener('online', updateOnlineStatus);
window.addEventListener('offline', updateOnlineStatus);

// â•â•â•â• Analytics-like usage tracking (local only) â•â•â•â•
(function(){
  const stats = JSON.parse(localStorage.getItem('spe_stats')||'{"visits":0,"surveysCompleted":0}');
  stats.visits = (stats.visits||0) + 1;
  stats.lastVisit = new Date().toISOString();
  localStorage.setItem('spe_stats', JSON.stringify(stats));
})();

// â•â•â•â• Keyboard Shortcuts â•â•â•â•
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey || e.metaKey) {
    switch(e.key) {
      case '1': e.preventDefault(); showTab('survey'); break;
      case '2': e.preventDefault(); showTab('coords'); break;
      case '3': e.preventDefault(); showTab('plot'); break;
      case '4': e.preventDefault(); showTab('history'); break;
      case 's': e.preventDefault(); completeSurvey(); break;
    }
  }
});

// â•â•â•â• Share API for modern browsers â•â•â•â•
function shareApp() {
  if (navigator.share) {
    navigator.share({
      title: 'SurveyPro Elite',
      text: "Nigeria's #1 Professional Surveying Platform â€” GPS, Coordinates, GIS, Equipment Rental!",
      url: 'https://pus217.github.io'
    });
  } else {
    navigator.clipboard.writeText('https://pus217.github.io').then(() => toast('Link copied!','success'));
  }
}

// â•â•â•â• Print styles â•â•â•â•
const printStyle = document.createElement('style');
printStyle.textContent = '@media print { header, .nav-wrap, footer, .btn, #topBanner, #toastWrap, #pwaInstallBanner { display: none !important; } .tab-content { display: block !important; } }';
document.head.appendChild(printStyle);

console.log('%cğŸ¯ SurveyPro Elite v2.0', 'color:#16a34a;font-size:1.2rem;font-weight:bold;');
console.log('%cNigeria's #1 Professional Surveying Platform', 'color:#0f172a;');
console.log('%cContact: opusarnold@gmail.com | +234-811-755-4948', 'color:#1d4ed8;');
</script>
</body></html>`;
  const w = window.open('','_blank'); w.document.write(html); w.document.close();
}

function exportSurveyJSON() {
  const data = { surveyPts, clientName:v('clientName'), projectName:v('projectName'), location:v('location'), exportedAt: new Date().toISOString(), platform:'SurveyPro Elite' };
  const blob = new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`survey-${Date.now()}.json`; a.click();
  toast('Survey exported as JSON','success');
}

function generateQR() {
  const n = surveyPts.length;
  if (n < 3) { toast('Complete survey first','warning'); return; }
  const ha = (shoelace(surveyPts)/10000).toFixed(4);
  const text = `SurveyPro Elite\nProject: ${v('projectName')}\nClient: ${v('clientName')}\nArea: ${ha} ha\nDate: ${new Date().toLocaleDateString('en-NG')}`;
  openModal(`<div style="text-align:center;">
    <h3 style="font-weight:700;margin-bottom:14px;">ğŸ“± Survey QR Code</h3>
    <div id="qrMod"></div>
    <p style="font-size:0.8rem;color:var(--text2);margin-top:12px;">Scan to view survey summary</p>
    <button class="btn btn-gray btn-full" style="margin-top:14px;" onclick="closeModal()">Close</button>
  </div>`);
  setTimeout(()=>{
    if(window.QRCode) new QRCode(document.getElementById('qrMod'),{text,width:200,height:200});
    else document.getElementById('qrMod').textContent = 'QR library not loaded';
  },200);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COORDINATE CONVERSIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function latLonToUTM(lat, lon, forceZone) {
  const zone = forceZone || (Math.floor((lon + 180) / 6) + 1);
  const k0=0.9996, a=6378137.0, e=0.081819191;
  const latR = lat*Math.PI/180;
  const lonO = (zone-1)*6-180+3;
  const lonR = (lon-lonO)*Math.PI/180;
  const N = a/Math.sqrt(1-e*e*Math.sin(latR)**2);
  const T = Math.tan(latR)**2;
  const C = (e*e/(1-e*e))*Math.cos(latR)**2;
  const A = lonR*Math.cos(latR);
  const M = a*((1-e*e/4-3*e**4/64)*latR-(3*e*e/8+3*e**4/32)*Math.sin(2*latR)+(15*e**4/256)*Math.sin(4*latR));
  const easting = k0*N*(A+(1-T+C)*A**3/6+(5-18*T+T*T+72*C)*A**5/120)+500000;
  const northing = k0*(M+N*Math.tan(latR)*(A*A/2+(5-T+9*C+4*C*C)*A**4/24+(61-58*T+T*T)*A**6/720));
  return { zone, easting, northing };
}

function convLatToUTM() {
  const lat=parseFloat(g('ll-lat').value), lon=parseFloat(g('ll-lon').value);
  const forceZone = parseInt(g('ll-zone').value) || null;
  if (isNaN(lat)||isNaN(lon)) { toast('Enter valid lat/lon values','warning'); return; }
  if (Math.abs(lat)>90||Math.abs(lon)>180) { toast('Coordinates out of range','error'); return; }
  const utm = latLonToUTM(lat,lon,forceZone);
  showResult('res-lltoutm',[
    ['Zone', utm.zone+'N'],
    ['Easting', utm.easting.toFixed(3)+' m'],
    ['Northing', utm.northing.toFixed(3)+' m'],
    ['Lat (input)', lat+'Â°'],
    ['Lon (input)', lon+'Â°']
  ],'+ Add to Survey', ()=>{ surveyPts.push({id:surveyPts.length+1,n:utm.northing,e:utm.easting,elev:0,lat,lon,src:'Converted',desc:'Converted Pt',ts:new Date().toISOString()}); updateSurveyDisplay(); showTab('survey'); toast('Point added to survey','success'); });
  toast('Converted!','success');
}

function convUTMToLat() {
  const zone=parseFloat(g('utm-zone').value), e=parseFloat(g('utm-e').value), n=parseFloat(g('utm-n').value);
  const south = g('utm-hemi').value === 'S';
  if (isNaN(zone)||isNaN(e)||isNaN(n)) { toast('Enter all UTM values','warning'); return; }
  const k0=0.9996, a=6378137.0, ec=0.081819191;
  let N = n; if (south) N -= 10000000;
  const x=e-500000;
  const M=N/k0;
  const mu=M/(a*(1-ec*ec/4-3*ec**4/64));
  const e1=(1-Math.sqrt(1-ec*ec))/(1+Math.sqrt(1-ec*ec));
  const phi1=mu+(3*e1/2-27*e1**3/32)*Math.sin(2*mu)+(21*e1*e1/16)*Math.sin(4*mu);
  const N1=a/Math.sqrt(1-ec*ec*Math.sin(phi1)**2);
  const T1=Math.tan(phi1)**2;
  const R1=a*(1-ec*ec)/Math.pow(1-ec*ec*Math.sin(phi1)**2,1.5);
  const D=x/(N1*k0);
  const lat=(phi1-(N1*Math.tan(phi1)/R1)*(D*D/2-(5+3*T1)*D**4/24))*180/Math.PI;
  const lonO=(zone-1)*6-180+3;
  const lon=lonO+(D-(1+2*T1)*D**3/6)/Math.cos(phi1)*180/Math.PI;
  showResult('res-utmtoll',[
    ['Latitude', lat.toFixed(7)+'Â°'],
    ['Longitude', lon.toFixed(7)+'Â°'],
    ['DMS Lat', decToDMS(lat,true)],
    ['DMS Lon', decToDMS(lon,false)]
  ]);
  toast('Converted!','success');
}

function decToDMS(v, isLat) {
  const d=Math.floor(Math.abs(v)), m=Math.floor((Math.abs(v)-d)*60), s=((Math.abs(v)-d-m/60)*3600).toFixed(3);
  return `${d}Â° ${m}' ${s}" ${isLat?(v>=0?'N':'S'):(v>=0?'E':'W')}`;
}

function calcBearingDist() {
  const sN=parseFloat(g('bd-n').value), sE=parseFloat(g('bd-e').value);
  const bear=parseFloat(g('bd-bearing').value), dist=parseFloat(g('bd-dist').value);
  if ([sN,sE,bear,dist].some(isNaN)) { toast('Enter all fields','warning'); return; }
  const bR=bear*Math.PI/180;
  const newN=sN+dist*Math.cos(bR), newE=sE+dist*Math.sin(bR);
  const va = parseFloat(g('bd-va').value)||0;
  const slopeDist = va !== 0 ? dist/Math.cos(va*Math.PI/180) : dist;
  showResult('bd-result',[
    ['New Northing', newN.toFixed(3)+' m'],
    ['New Easting', newE.toFixed(3)+' m'],
    ['Bearing', bear.toFixed(4)+'Â°'],
    ['Horizontal Dist', dist.toFixed(3)+' m'],
    ['Slope Dist', slopeDist.toFixed(3)+' m']
  ],'â• Add to Survey',()=>{
    surveyPts.push({id:surveyPts.length+1,n:newN,e:newE,elev:0,src:'Calc',desc:`Bearing-${bear.toFixed(0)}Â°`,ts:new Date().toISOString()});
    updateSurveyDisplay(); showTab('survey'); toast('Point added','success');
  });
  toast('Point calculated!','success');
}

function convertMultiFormat() {
  let lat=0, lon=0;
  const fmt = g('mf-format').value;
  const latIn = g('mf-lat').value.trim(), lonIn = g('mf-lon').value.trim();
  if (fmt==='dd') { lat=parseFloat(latIn); lon=parseFloat(lonIn); }
  else if (fmt==='dms') {
    const parseDMS = s => { const p=s.match(/(\d+)[Â°\s]+(\d+)['\s]+(\d+\.?\d*)["\s]*/); return p?(parseFloat(p[1])+parseFloat(p[2])/60+parseFloat(p[3])/3600):NaN; };
    lat=parseDMS(latIn); lon=parseDMS(lonIn);
  } else {
    const parseDDM = s => { const p=s.match(/(\d+)[Â°\s]+(\d+\.?\d*)['\s]*/); return p?(parseFloat(p[1])+parseFloat(p[2])/60):NaN; };
    lat=parseDDM(latIn); lon=parseDDM(lonIn);
  }
  if (isNaN(lat)||isNaN(lon)) { toast('Enter valid coordinates','warning'); return; }
  const utm=latLonToUTM(lat,lon);
  const ddm=(v,isLat)=>`${Math.floor(Math.abs(v))}Â° ${((Math.abs(v)-Math.floor(Math.abs(v)))*60).toFixed(5)}'${isLat?(v>=0?' N':' S'):(v>=0?' E':' W')}`;
  g('mf-results').innerHTML = [
    ['Decimal Degrees', `${lat.toFixed(7)}Â°N, ${lon.toFixed(7)}Â°E`],
    ['DMS', `${decToDMS(lat,true)}, ${decToDMS(lon,false)}`],
    ['DDM', `${ddm(lat,true)}, ${ddm(lon,false)}`],
    ['UTM WGS84', `Zone ${utm.zone}N | E: ${utm.easting.toFixed(3)} | N: ${utm.northing.toFixed(3)}`],
    ['MGRS-style', `${utm.zone}N ${utm.easting.toFixed(0)} ${utm.northing.toFixed(0)}`],
    ['GeoJSON', `[${lon.toFixed(7)}, ${lat.toFixed(7)}]`]
  ].map(([k,vl])=>`<div class="result-row"><span class="rk">${k}</span><span class="mono" style="font-size:0.8rem;">${vl}</span></div>`).join('');
  toast('All formats converted!','success');
}

// Traverse
function addTravLeg() {
  const idx = g('trav-legs').children.length;
  const div = document.createElement('div');
  div.style = 'display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:8px;align-items:end;';
  div.id = 'leg-' + idx;
  div.innerHTML = `
    <div><label style="font-size:0.75rem;font-weight:600;">Bearing (Â°)</label><input type="number" step="0.0001" id="lb${idx}" placeholder="90.0000" class="mono" style="margin-top:4px;"></div>
    <div><label style="font-size:0.75rem;font-weight:600;">Distance (m)</label><input type="number" step="0.001" id="ld${idx}" placeholder="100.000" class="mono" style="margin-top:4px;"></div>
    <div><label style="font-size:0.75rem;font-weight:600;">Description</label><input type="text" id="ldesc${idx}" placeholder="Leg ${idx+1}" style="margin-top:4px;"></div>
    <button onclick="g('leg-${idx}').remove()" class="btn btn-red btn-sm" style="align-self:flex-end;">âœ•</button>`;
  g('trav-legs').appendChild(div);
}

function clearTraverse() { g('trav-legs').innerHTML=''; g('trav-result').classList.remove('show'); }

function computeTraverse() {
  const n0=parseFloat(g('trav-n0').value)||1000, e0=parseFloat(g('trav-e0').value)||1000;
  const legs=[]; let n=n0, e=e0;
  const lbEls=document.querySelectorAll('[id^="lb"]');
  const ldEls=document.querySelectorAll('[id^="ld"]');
  lbEls.forEach((el,i)=>{
    const b=parseFloat(el.value), d=parseFloat(ldEls[i]?.value);
    if(!isNaN(b)&&!isNaN(d)) legs.push({b,d});
  });
  if(legs.length<1){toast('Add at least one leg','warning');return;}
  let rows='<tr><th>Leg</th><th>Bearing</th><th>Distance</th><th>Î”N</th><th>Î”E</th><th>Northing</th><th>Easting</th></tr>';
  const sns=[], ses=[];
  legs.forEach((l,i)=>{
    const bR=l.b*Math.PI/180, dn=l.d*Math.cos(bR), de=l.d*Math.sin(bR);
    n+=dn; e+=de; sns.push(n); ses.push(e);
    rows+=`<tr><td>${i+1}</td><td class="mono">${l.b.toFixed(4)}Â°</td><td class="mono">${l.d.toFixed(3)}m</td><td class="mono">${dn>0?'+':''}${dn.toFixed(3)}</td><td class="mono">${de>0?'+':''}${de.toFixed(3)}</td><td class="mono">${n.toFixed(3)}</td><td class="mono">${e.toFixed(3)}</td></tr>`;
  });
  const closeN=n0-n, closeE=e0-e, totalDist=legs.reduce((s,l)=>s+l.d,0);
  const err=Math.sqrt(closeN**2+closeE**2), ratio=err>0?Math.round(totalDist/err):0;
  const quality = ratio > 10000 ? 'ğŸŸ¢ Excellent' : ratio > 5000 ? 'ğŸŸ¡ Good' : ratio > 1000 ? 'ğŸŸ  Acceptable' : 'ğŸ”´ Poor';
  g('trav-result').innerHTML = `
    <div style="overflow-x:auto;"><table class="data-table">${rows}</table></div>
    <div style="margin-top:12px;background:#f0fdfa;border:1px solid #99f6e4;border-radius:8px;padding:12px;font-size:0.82rem;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
        <div><strong>Closure N:</strong> <span class="mono">${closeN.toFixed(4)} m</span></div>
        <div><strong>Closure E:</strong> <span class="mono">${closeE.toFixed(4)} m</span></div>
        <div><strong>Linear Error:</strong> <span class="mono">${err.toFixed(4)} m</span></div>
        <div><strong>Precision Ratio:</strong> <span class="mono">1:${ratio.toLocaleString()}</span></div>
        <div><strong>Total Distance:</strong> <span class="mono">${totalDist.toFixed(3)} m</span></div>
        <div><strong>Quality:</strong> ${quality}</div>
      </div>
    </div>`;
  g('trav-result').classList.add('show');
  toast('Traverse computed!','success');
}

function calcAreaFromCoords() {
  const ns = g('area-n').value.trim().split('\n').map(parseFloat).filter(v=>!isNaN(v));
  const es = g('area-e').value.trim().split('\n').map(parseFloat).filter(v=>!isNaN(v));
  if(ns.length < 3 || ns.length !== es.length){toast('Need matching N and E values (min 3)','warning');return;}
  const pts = ns.map((n,i)=>({n,e:es[i]}));
  const sqm=shoelace(pts), ha=sqm/10000, ac=ha*2.47105, perim=calcPerimeter(pts);
  showResult('area-result',[
    ['Points', ns.length],
    ['Sq Metres', sqm.toFixed(3)+' mÂ²'],
    ['Hectares', ha.toFixed(4)+' ha'],
    ['Acres', ac.toFixed(4)+' ac'],
    ['Perimeter', perim.toFixed(3)+' m'],
    ['Plots (50Ã—100)', (ha*10000/1500).toFixed(2)]
  ]);
  toast('Area calculated!','success');
}

function calcInverse() {
  const n1=parseFloat(g('inv-n1').value), e1=parseFloat(g('inv-e1').value);
  const n2=parseFloat(g('inv-n2').value), e2=parseFloat(g('inv-e2').value);
  if([n1,e1,n2,e2].some(isNaN)){toast('Enter all coordinates','warning');return;}
  const dn=n2-n1, de=e2-e1;
  const dist=Math.sqrt(dn*dn+de*de);
  const bear=((Math.atan2(de,dn)*180/Math.PI)+360)%360;
  const backBear=(bear+180)%360;
  showResult('inv-result',[
    ['Distance', dist.toFixed(3)+' m'],
    ['Forward Bearing', bear.toFixed(4)+'Â°'],
    ['Back Bearing', backBear.toFixed(4)+'Â°'],
    ['Î”N', (dn>0?'+':'')+dn.toFixed(3)+' m'],
    ['Î”E', (de>0?'+':'')+de.toFixed(3)+' m'],
    ['Gradient (%)','N/A (elevation required)']
  ]);
  toast('Inverse calculated!','success');
}

function showResult(id, rows, btnLabel, btnFn) {
  const el = g(id);
  if (!el) return;
  let html = rows.map(([k,v])=>`<div class="result-row"><span class="rk">${k}</span><span class="mono" style="font-size:0.82rem;">${v}</span></div>`).join('');
  if (btnLabel && btnFn) {
    const fnId = 'rfn_'+Math.random().toString(36).substr(2,6);
    window[fnId] = btnFn;
    html += `<button class="btn btn-green btn-full btn-sm" style="margin-top:10px;" onclick="window['${fnId}']()">${btnLabel}</button>`;
  }
  el.innerHTML = html;
  el.classList.add('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLOT CANVAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let plotCanvas, plotCtx;
function initPlotCanvas() {
  plotCanvas = g('plotCanvas');
  if (!plotCanvas) return;
  plotCtx = plotCanvas.getContext('2d');
  drawGrid();
}

function drawGrid() {
  if (!plotCtx || !plotCanvas) return;
  plotCtx.fillStyle = '#f9fafb'; plotCtx.fillRect(0,0,plotCanvas.width,plotCanvas.height);
  plotCtx.strokeStyle='#e5e7eb'; plotCtx.lineWidth=0.5;
  for(let i=0;i<=plotCanvas.width;i+=50){plotCtx.beginPath();plotCtx.moveTo(i,0);plotCtx.lineTo(i,plotCanvas.height);plotCtx.stroke();}
  for(let i=0;i<=plotCanvas.height;i+=50){plotCtx.beginPath();plotCtx.moveTo(0,i);plotCtx.lineTo(plotCanvas.width,i);plotCtx.stroke();}
  // North arrow
  plotCtx.font='bold 14px Arial'; plotCtx.fillStyle='#0f172a'; plotCtx.textAlign='center';
  plotCtx.fillText('N â†‘', plotCanvas.width-30, 25);
}

function generatePlot() {
  const owner=v('plotOwner'), addr=v('plotAddress'), lat=parseFloat(v('plotLat')), lon=parseFloat(v('plotLon'));
  const w=parseFloat(v('plotWidth'))||15, d=parseFloat(v('plotDepth'))||30;
  const orient=(parseFloat(v('plotOrient'))||0)*Math.PI/180;
  if (!owner || !addr || isNaN(lat) || isNaN(lon)) { toast('Fill all plot details','warning'); return; }
  const utm=latLonToUTM(lat,lon);
  const cos=Math.cos(orient), sin=Math.sin(orient);
  plotPts=[
    {id:1,n:utm.northing, e:utm.easting},
    {id:2,n:utm.northing+w*sin, e:utm.easting+w*cos},
    {id:3,n:utm.northing+w*sin-d*cos, e:utm.easting+w*cos+d*sin},
    {id:4,n:utm.northing-d*cos, e:utm.easting+d*sin}
  ];
  redrawPlot(owner,addr,w,d,utm);
  toast('Plot layout generated!','success');
}

function redrawPlot(owner,addr,w,d,utm) {
  drawGrid();
  if(plotPts.length<2)return;
  const margin=80,pw=plotCanvas.width-2*margin,ph=plotCanvas.height-2*margin;
  const ns=plotPts.map(p=>p.n),es=plotPts.map(p=>p.e);
  const minN=Math.min(...ns),maxN=Math.max(...ns),minE=Math.min(...es),maxE=Math.max(...es);
  const rangeN=maxN-minN||1,rangeE=maxE-minE||1;
  const sx=p=>margin+((p.e-minE)/rangeE)*pw;
  const sy=p=>plotCanvas.height-margin-((p.n-minN)/rangeN)*ph;

  // Fill
  plotCtx.beginPath();
  plotPts.forEach((p,i)=>i===0?plotCtx.moveTo(sx(p),sy(p)):plotCtx.lineTo(sx(p),sy(p)));
  plotCtx.closePath();
  plotCtx.fillStyle='rgba(22,163,74,0.08)'; plotCtx.fill();
  plotCtx.strokeStyle='#16a34a'; plotCtx.lineWidth=3; plotCtx.stroke();

  // Points
  plotPts.forEach(p=>{
    plotCtx.fillStyle='#0f172a'; plotCtx.beginPath(); plotCtx.arc(sx(p),sy(p),6,0,2*Math.PI); plotCtx.fill();
    plotCtx.fillStyle='#ffffff'; plotCtx.beginPath(); plotCtx.arc(sx(p),sy(p),3,0,2*Math.PI); plotCtx.fill();
    plotCtx.fillStyle='#0f172a'; plotCtx.font='bold 10px JetBrains Mono,monospace';
    plotCtx.textAlign='left';
    const label=`P${p.id} (N:${p.n.toFixed(0)} E:${p.e.toFixed(0)})`;
    plotCtx.fillText(label,sx(p)+9,sy(p)-6);
  });

  // Dimensions on sides
  plotCtx.font='11px Arial'; plotCtx.fillStyle='#1d4ed8'; plotCtx.textAlign='center';
  const midTop={x:(sx(plotPts[0])+sx(plotPts[1]))/2, y:(sy(plotPts[0])+sy(plotPts[1]))/2};
  const midRight={x:(sx(plotPts[1])+sx(plotPts[2]))/2, y:(sy(plotPts[1])+sy(plotPts[2]))/2};
  plotCtx.fillText(`${w}m`,midTop.x,midTop.y-8);
  plotCtx.fillText(`${d}m`,midRight.x+20,midRight.y);

  // Labels
  plotCtx.fillStyle='#0f172a'; plotCtx.font='bold 13px Arial'; plotCtx.textAlign='center';
  plotCtx.fillText(`ğŸ“ ${owner}`, plotCanvas.width/2, 24);
  plotCtx.font='11px Arial'; plotCtx.fillStyle='#64748b';
  plotCtx.fillText(addr, plotCanvas.width/2, 40);
  plotCtx.fillText(`Zone ${utm?.zone||31}N Â· Width:${w}m Â· Depth:${d}m Â· Area:${(w*d).toFixed(0)}mÂ²`, plotCanvas.width/2, plotCanvas.height-10);
  plotCtx.textAlign='left';
  // Watermark
  plotCtx.font='10px Arial'; plotCtx.fillStyle='rgba(0,0,0,0.12)'; plotCtx.textAlign='center';
  plotCtx.fillText('SurveyPro Elite Â· opusarnold@gmail.com', plotCanvas.width/2, plotCanvas.height/2+40);
}

function clearPlotCanvas(){plotPts=[];drawGrid();toast('Canvas cleared','info');}
function exportPlot(){const a=document.createElement('a');a.download=`plot-${Date.now()}.png`;a.href=plotCanvas.toDataURL('image/png',0.9);a.click();toast('Plot exported!','success');}
function calcCanvasArea(){
  if(plotPts.length<3){toast('Need at least 3 plot points','warning');return;}
  const sqm=shoelace(plotPts),ha=sqm/10000,ac=ha*2.47105,perim=calcPerimeter(plotPts);
  showResult('plotAreaResult',[
    ['Sq Metres',sqm.toFixed(2)+' mÂ²'],['Hectares',ha.toFixed(4)+' ha'],
    ['Acres',ac.toFixed(4)+' ac'],['Perimeter',perim.toFixed(2)+' m'],
    ['Plots (50Ã—100)',(ha*10000/1500).toFixed(2)]
  ]);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GIS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function requestGIS(service, price) {
  const you = Math.round(parseFloat(price)*CFG.commission);
  const msg = `ğŸ—ºï¸ *GIS Service Request*\n\nService: *${service}*\nEstimated price: â‚¦${parseFloat(price).toLocaleString()}\n\nPlease provide a quote and timeline.\n\nâ€” SurveyPro Elite Platform`;
  openModal(`<div>
    <h3 style="font-weight:700;margin-bottom:12px;">ğŸ—ºï¸ ${service}</h3>
    <div style="background:#f0fdf4;border:2px solid #86efac;border-radius:10px;padding:14px;margin-bottom:14px;font-size:0.85rem;">
      <div><strong>Service:</strong> ${service}</div>
      <div><strong>Starting from:</strong> â‚¦${parseFloat(price).toLocaleString()}</div>
      <div><strong>Your commission (45%):</strong> â‚¦${you.toLocaleString()}</div>
    </div>
    <div class="btn-grid">
      <button class="btn" style="background:#25D366;color:#fff;" onclick="window.open('${CFG.whatsapp}?text=${encodeURIComponent(msg)}','_blank');closeModal();">ğŸ“± WhatsApp</button>
      <button class="btn btn-blue" onclick="window.location.href='mailto:${CFG.email}?subject=GIS Service: ${service}';closeModal();">ğŸ“§ Email</button>
    </div>
    <button class="btn btn-gray btn-full" style="margin-top:8px;" onclick="closeModal()">Cancel</button>
  </div>`);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VERIFY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function verifySurveyCode() {
  const code=g('verifyInput').value.trim().toUpperCase();
  if(!code){toast('Enter a verification code','warning');return;}
  const s=surveys.find(x=>x.verificationCode===code);
  const out=g('verifyResult');
  if(s){
    out.innerHTML=`<div class="verify-success">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px;">
        <span style="font-size:2.5rem;">âœ…</span>
        <div><div style="font-weight:800;font-size:1.1rem;color:var(--accent);">Survey Verified</div><div style="font-size:0.78rem;color:var(--text2);">Authentic SurveyPro Elite Record</div></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;font-size:0.85rem;">
        <div><strong>Code:</strong> <span class="mono">${s.verificationCode}</span></div>
        <div><strong>Date:</strong> ${new Date(s.savedAt).toLocaleDateString('en-NG')}</div>
        <div><strong>Project:</strong> ${s.projectName}</div>
        <div><strong>Client:</strong> ${s.clientName}</div>
        <div><strong>Location:</strong> ${s.location}</div>
        <div><strong>Type:</strong> ${s.surveyType}</div>
        <div><strong>Area:</strong> <span style="color:var(--accent);font-weight:700;">${s.hectares.toFixed(4)} ha / ${s.acres.toFixed(4)} acres</span></div>
        <div><strong>Points:</strong> ${s.points}</div>
      </div>
    </div>`;
    // Show QR
    g('qrSection').style.display='block';
    g('qrContainer').innerHTML='';
    if(window.QRCode) new QRCode(g('qrContainer'),{text:`SurveyPro Elite\nVerified: ${code}\nProject: ${s.projectName}\nArea: ${s.hectares.toFixed(4)} ha`,width:160,height:160});
  } else {
    out.innerHTML=`<div class="verify-fail">
      <div style="font-size:3rem;margin-bottom:8px;">âŒ</div>
      <h3 style="font-weight:800;color:var(--danger);">Code Not Found</h3>
      <p style="font-size:0.85rem;color:var(--text2);margin-top:6px;">The code <strong>${code}</strong> was not found in the database. Check the code and try again.</p>
    </div>`;
    g('qrSection').style.display='none';
  }
}

function requestCofO(){window.open(`${CFG.whatsapp}?text=${encodeURIComponent('ğŸ”’ C of O Service Request\n\nI need professional Certificate of Occupancy assistance.\nPlease contact me with your process and pricing.')}`,'_blank');}
function emailCofO(){window.location.href=`mailto:${CFG.email}?subject=C of O Assistance Request&body=Hello,%0A%0AI need professional C of O assistance.%0APlease contact me with details.`;}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EQUIPMENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildEquipment() {
  const grid = g('equipGrid');
  if(!grid) return;
  grid.innerHTML = EQUIPMENT.map(eq=>{
    const you=Math.round(eq.price*CFG.commission);
    return `<div class="equip-card">
      <div class="equip-top"><span class="equip-icon">${eq.icon}</span>
        <div><h4 style="font-weight:800;font-size:1rem;color:var(--accent2);">${eq.name}</h4><p style="font-size:0.75rem;color:var(--text3);">${eq.model}</p></div>
      </div>
      <p style="font-size:0.82rem;color:var(--text2);margin-bottom:10px;">${eq.desc}</p>
      <div class="equip-price">â‚¦${eq.price.toLocaleString()} <span style="font-size:0.75rem;color:var(--text2);font-weight:400;">/day</span></div>
      <div class="equip-earn">âœ… You earn: â‚¦${you.toLocaleString()} (45%)</div>
      <ul class="equip-features">${eq.features.map(f=>`<li>âœ… ${f}</li>`).join('')}</ul>
      <button class="btn btn-green btn-full" style="margin-top:10px;" onclick="bookEquipment('${eq.name}',${eq.price},'${eq.link}')">ğŸ›’ Book â€” Earn â‚¦${you.toLocaleString()}</button>
    </div>`;
  }).join('');
}

function bookEquipment(name, price, link) {
  const you=Math.round(price*CFG.commission), partner=price-you;
  openModal(`<div>
    <h3 style="font-weight:800;font-size:1.1rem;margin-bottom:14px;">âš™ï¸ ${name}</h3>
    <div style="background:linear-gradient(135deg,#0f172a,#1e3a5f);color:#fff;border-radius:12px;padding:18px;margin-bottom:16px;">
      <h4 style="text-align:center;margin-bottom:12px;font-size:0.9rem;">ğŸ’° Payment Split</h4>
      <div style="display:flex;justify-content:space-between;background:rgba(255,255,255,0.1);border-radius:8px;padding:12px;margin-bottom:8px;">
        <div><div style="font-size:0.82rem;">Your Commission (Opay: ${CFG.opay})</div></div>
        <div style="text-align:right;"><div style="font-family:Syne,sans-serif;font-size:1.8rem;font-weight:800;color:#4ade80;">â‚¦${you.toLocaleString()}</div></div>
      </div>
      <div style="display:flex;justify-content:space-between;background:rgba(255,255,255,0.1);border-radius:8px;padding:12px;">
        <div><div style="font-size:0.82rem;">Equipment Partner</div></div>
        <div style="text-align:right;"><div style="font-family:Syne,sans-serif;font-size:1.8rem;font-weight:800;color:#60a5fa;">â‚¦${partner.toLocaleString()}</div></div>
      </div>
    </div>
    <div class="form-group"><label>Your Full Name</label><input id="bName" placeholder="Full name" type="text"></div>
    <div class="form-group"><label>Phone Number</label><input id="bPhone" placeholder="080XXXXXXXX" type="tel"></div>
    <div class="form-row">
      <div class="form-group"><label>Rental Date</label><input id="bDate" type="date"></div>
      <div class="form-group"><label>Days Required</label><input id="bDays" type="number" min="1" placeholder="1"></div>
    </div>
    <div class="btn-grid">
      <button class="btn btn-green" onclick="confirmEquipBooking('${name}',${price},${you},'${link}')">âœ… Confirm Booking</button>
      <button class="btn btn-gray" onclick="closeModal()">Cancel</button>
    </div>
  </div>`);
}

function confirmEquipBooking(name, price, you, link) {
  const bN=v('bName'), bP=v('bPhone'), bD=v('bDate'), bDays=v('bDays');
  if(!bN||!bP||!bD||!bDays){toast('Fill all booking fields','warning');return;}
  const totalPrice=price*parseInt(bDays), totalYou=you*parseInt(bDays);
  const msg=`âš™ï¸ *EQUIPMENT BOOKING â€” SurveyPro Elite*\n\nEquipment: *${name}*\nCustomer: ${bN}\nPhone: ${bP}\nDate: ${bD}\nDays: ${bDays}\nTotal: â‚¦${totalPrice.toLocaleString()}\n\nğŸ’° Your commission: â‚¦${totalYou.toLocaleString()} â†’ Opay ${CFG.opay}\n\nğŸ“§ ${CFG.email}`;
  closeModal();
  showBanner(`âœ… Booking confirmed! Your â‚¦${totalYou.toLocaleString()} â†’ Opay ${CFG.opay}`);
  setTimeout(()=>{ window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank'); }, 800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TRAINING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function buildCourses() {
  const grid = g('coursesGrid');
  if(!grid) return;
  const levelClass={Beginner:'level-beg',Intermediate:'level-int',Advanced:'level-adv'};
  grid.innerHTML = COURSES.map(c=>{
    const you=Math.round(c.price*CFG.commission);
    return `<div class="course-card">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px;">
        <h4 style="font-weight:700;color:var(--accent2);font-size:0.95rem;">${c.name}</h4>
        <span class="course-level ${levelClass[c.level]||'level-beg'}">${c.level}</span>
      </div>
      <p style="font-size:0.82rem;color:var(--text2);margin-bottom:10px;">${c.desc}</p>
      <div style="display:flex;gap:12px;font-size:0.75rem;color:var(--text3);margin-bottom:12px;">
        <span>â±ï¸ ${c.dur}</span><span>ğŸ›ï¸ ${c.platform}</span>
      </div>
      <div class="course-price">â‚¦${c.price.toLocaleString()}</div>
      <div class="course-earn" style="margin:6px 0 12px;">You earn: â‚¦${you.toLocaleString()} (45%)</div>
      <button class="btn btn-primary btn-full btn-sm" onclick="enrollCourse('${c.id}','${c.name}',${c.price},'${c.platform}')">ğŸ“ Enroll â€” Earn â‚¦${you.toLocaleString()}</button>
    </div>`;
  }).join('');
}

function enrollCourse(id, name, price, platform) {
  const you=Math.round(price*CFG.commission);
  openModal(`<div>
    <h3 style="font-weight:800;margin-bottom:14px;">ğŸ“ ${name}</h3>
    <div style="background:#f0fdf4;border:2px solid #86efac;border-radius:10px;padding:14px;margin-bottom:14px;font-size:0.85rem;">
      <div><strong>Platform:</strong> ${platform}</div>
      <div><strong>Price:</strong> â‚¦${price.toLocaleString()}</div>
      <div><strong>Your cut (45%):</strong> â‚¦${you.toLocaleString()} â†’ Opay ${CFG.opay}</div>
    </div>
    <div class="form-group"><label>Student Name</label><input id="sName" placeholder="Full name" type="text"></div>
    <div class="form-group"><label>Student Email</label><input id="sEmail" placeholder="email@example.com" type="email"></div>
    <div class="form-group"><label>Phone</label><input id="sPhone" placeholder="080XXXXXXXX" type="tel"></div>
    <div class="btn-grid">
      <button class="btn btn-green" onclick="confirmEnroll('${name}',${price},${you},'${platform}')">âœ… Enroll Now</button>
      <button class="btn btn-gray" onclick="closeModal()">Cancel</button>
    </div>
  </div>`);
}

function confirmEnroll(name, price, you, platform) {
  const sN=v('sName'), sE=v('sEmail'), sP=v('sPhone');
  if(!sN||!sE){toast('Enter name and email','warning');return;}
  const msg=`ğŸ“ *COURSE ENROLLMENT â€” SurveyPro Elite*\n\nCourse: *${name}*\nPlatform: ${platform}\nStudent: ${sN}\nEmail: ${sE}\nPhone: ${sP}\nPrice: â‚¦${price.toLocaleString()}\n\nğŸ’° Your cut: â‚¦${you.toLocaleString()} â†’ Opay ${CFG.opay}`;
  closeModal();
  showBanner(`âœ… Enrollment confirmed! â‚¦${you.toLocaleString()} â†’ Opay ${CFG.opay}`);
  setTimeout(()=>window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank'),800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HISTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateHistory() {
  const cont=g('historyContent');
  if(!cont)return;
  if(surveys.length===0){
    cont.innerHTML='<div style="text-align:center;padding:60px 20px;color:var(--text3);"><div style="font-size:3rem;margin-bottom:12px;">ğŸ“‚</div><p style="font-size:1.1rem;font-weight:600;">No saved surveys yet</p><p style="font-size:0.85rem;margin-top:6px;">Complete and save surveys to see them here</p></div>';
    return;
  }
  cont.innerHTML = surveys.slice().reverse().map((s,i)=>{
    const realIdx = surveys.length-1-i;
    return `<div class="hist-card">
      <div class="hist-header">
        <div><h3 style="font-weight:800;font-size:1rem;color:var(--accent2);">${s.projectName}</h3><p style="font-size:0.82rem;color:var(--text2);">${s.location} Â· ${s.surveyType}</p></div>
        <span class="hist-code">${s.verificationCode}</span>
      </div>
      <div class="hist-stats">
        <div class="hist-stat"><div class="hk">Hectares</div><div class="hv" style="color:var(--accent);">${s.hectares.toFixed(4)}</div></div>
        <div class="hist-stat"><div class="hk">Acres</div><div class="hv" style="color:var(--accent2);">${s.acres.toFixed(4)}</div></div>
        <div class="hist-stat"><div class="hk">Points</div><div class="hv">${s.points}</div></div>
        <div class="hist-stat"><div class="hk">Plots</div><div class="hv" style="color:var(--warning);">${s.plots.toFixed(1)}</div></div>
      </div>
      <div style="font-size:0.78rem;color:var(--text3);margin-bottom:10px;">${s.clientName} Â· ${s.clientPhone} Â· ${new Date(s.savedAt).toLocaleDateString('en-NG')}</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button class="btn btn-blue btn-sm" onclick="shareSurvey(${realIdx})">ğŸ“± Share</button>
        <button class="btn btn-gray btn-sm" onclick="viewSurveyDetail(${realIdx})">ğŸ‘ View</button>
        <button class="btn btn-green btn-sm" onclick="generateQRForSurvey(${realIdx})">ğŸ“± QR</button>
        <button class="btn btn-red btn-sm" onclick="deleteSurvey(${realIdx})">ğŸ—‘ï¸</button>
      </div>
    </div>`;
  }).join('');
}

function viewSurveyDetail(i) {
  const s=surveys[i];
  openModal(`<div>
    <h3 style="font-weight:800;margin-bottom:14px;">ğŸ“Š ${s.projectName}</h3>
    <div style="font-size:0.82rem;display:grid;gap:6px;margin-bottom:14px;">
      <div><strong>Code:</strong> <span class="mono">${s.verificationCode}</span></div>
      <div><strong>Client:</strong> ${s.clientName} Â· ${s.clientPhone}</div>
      <div><strong>Location:</strong> ${s.location}</div>
      <div><strong>File No:</strong> ${s.fileNumber||'N/A'}</div>
      <div><strong>Type:</strong> ${s.surveyType}</div>
      <div><strong>System:</strong> ${s.coordSystem}</div>
      <div><strong>Area:</strong> ${s.hectares.toFixed(4)} ha / ${s.acres.toFixed(4)} acres</div>
      <div><strong>Perimeter:</strong> ${s.perimeter?.toFixed(2)||'N/A'} m</div>
      <div><strong>Points:</strong> ${s.points}</div>
      <div><strong>Surveyor:</strong> ${s.surveyor||CFG.name}</div>
      <div><strong>Date:</strong> ${new Date(s.savedAt).toLocaleDateString('en-NG')}</div>
      ${s.notes?`<div><strong>Notes:</strong> ${s.notes}</div>`:''}
    </div>
    <button class="btn btn-gray btn-full" onclick="closeModal()">Close</button>
  </div>`);
}

function generateQRForSurvey(i) {
  const s=surveys[i];
  openModal(`<div style="text-align:center;">
    <h3 style="font-weight:700;margin-bottom:14px;">ğŸ“± Survey QR Code</h3>
    <div id="histQR"></div>
    <p class="mono" style="font-size:0.8rem;margin-top:10px;color:var(--text2);">${s.verificationCode}</p>
    <button class="btn btn-gray btn-full" style="margin-top:12px;" onclick="closeModal()">Close</button>
  </div>`);
  setTimeout(()=>{if(window.QRCode)new QRCode(document.getElementById('histQR'),{text:`SurveyPro Elite\nCode: ${s.verificationCode}\nProject: ${s.projectName}\nClient: ${s.clientName}\nArea: ${s.hectares.toFixed(4)} ha`,width:180,height:180});},200);
}

function shareSurvey(i) {
  const s=surveys[i];
  const txt=`ğŸ“Š SURVEY REPORT â€” SurveyPro Elite\n\nProject: ${s.projectName}\nLocation: ${s.location}\nClient: ${s.clientName}\nArea: ${s.hectares.toFixed(4)} ha / ${s.acres.toFixed(4)} acres\nPerimeter: ${s.perimeter?.toFixed(2)||'N/A'} m\nVerification: ${s.verificationCode}\nDate: ${new Date(s.savedAt).toLocaleDateString('en-NG')}\n\nSurveyPro Elite Â· ${CFG.email} Â· +234-811-755-4948`;
  if(navigator.share){navigator.share({title:`Survey â€” ${s.projectName}`,text:txt});}
  else if(navigator.clipboard){navigator.clipboard.writeText(txt);toast('Survey details copied!','success');}
  else{window.open(`${CFG.whatsapp}?text=${encodeURIComponent(txt)}`,'_blank');}
}

function deleteSurvey(i){if(!confirm('Delete this survey? Cannot be undone.'))return;surveys.splice(i,1);saveSurveys();updateHistory();updateReportDropdown();toast('Survey deleted','info');}
function clearAllHistory(){if(!confirm('Delete ALL surveys? Cannot be undone.'))return;surveys=[];saveSurveys();updateHistory();updateReportDropdown();toast('All history cleared','info');}

function exportAllSurveysJSON(){
  const blob=new Blob([JSON.stringify({surveys,exportedAt:new Date().toISOString(),platform:'SurveyPro Elite'},null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=`all-surveys-${Date.now()}.json`;a.click();
  toast('All surveys exported','success');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REPORTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateReportDropdown() {
  const sel=g('reportSurveySelect');
  if(!sel)return;
  sel.innerHTML='<option value="">â€” Select a saved survey â€”</option>'+surveys.map((s,i)=>`<option value="${i}">${s.projectName} (${s.verificationCode})</option>`).join('');
}

function generateReport() {
  const idx=g('reportSurveySelect').value;
  if(idx===''){toast('Select a survey first','warning');return;}
  const s=surveys[parseInt(idx)];
  const rType=v('reportType'), rSurv=v('rptSurveyor'), rLic=v('rptLicense'), rFoot=v('rptFooter');
  const html=`<div style="background:#fff;border:2px solid var(--border);border-radius:12px;padding:24px;font-size:0.85rem;">
    <div style="text-align:center;border-bottom:3px solid #0f172a;padding-bottom:16px;margin-bottom:16px;">
      <h2 style="font-size:1.3rem;font-weight:800;">SURVEY REPORT</h2>
      <p style="font-size:0.8rem;color:var(--text2);">SurveyPro Elite Â· WGS84 Â· ${rType}</p>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
      <div><strong>Project:</strong> ${s.projectName}</div>
      <div><strong>Date:</strong> ${new Date(s.savedAt).toLocaleDateString('en-NG')}</div>
      <div><strong>Client:</strong> ${s.clientName}</div>
      <div><strong>Phone:</strong> ${s.clientPhone}</div>
      <div><strong>Location:</strong> ${s.location}</div>
      <div><strong>File No:</strong> ${s.fileNumber||'N/A'}</div>
      <div><strong>Survey Type:</strong> ${s.surveyType}</div>
      <div><strong>Coord System:</strong> ${s.coordSystem}</div>
    </div>
    <div style="background:#f0fdf4;border-radius:10px;padding:14px;margin-bottom:14px;display:grid;grid-template-columns:repeat(4,1fr);gap:10px;text-align:center;">
      <div><div style="font-size:0.72rem;color:var(--text3);">HECTARES</div><div style="font-weight:800;color:var(--accent);">${s.hectares.toFixed(4)}</div></div>
      <div><div style="font-size:0.72rem;color:var(--text3);">ACRES</div><div style="font-weight:800;color:var(--accent2);">${s.acres.toFixed(4)}</div></div>
      <div><div style="font-size:0.72rem;color:var(--text3);">PERIMETER</div><div style="font-weight:800;">${s.perimeter?.toFixed(2)||'N/A'} m</div></div>
      <div><div style="font-size:0.72rem;color:var(--text3);">PLOTS (50Ã—100)</div><div style="font-weight:800;">${s.plots?.toFixed(1)||'N/A'}</div></div>
    </div>
    <div style="margin-bottom:14px;">
      <div style="font-weight:700;margin-bottom:6px;">Verification Code</div>
      <div class="mono" style="font-size:1.3rem;font-weight:700;color:var(--accent);letter-spacing:0.1em;">${s.verificationCode}</div>
    </div>
    <div style="border-top:1px solid var(--border);padding-top:14px;font-size:0.78rem;color:var(--text2);">
      <p><strong>Surveyor:</strong> ${rSurv||CFG.name} ${rLic?'Â· Lic: '+rLic:''}</p>
      ${rFoot?`<p style="margin-top:6px;">${rFoot}</p>`:''}
      <p style="margin-top:6px;">Generated by SurveyPro Elite Â· ${CFG.email} Â· +234-811-755-4948</p>
    </div>
  </div>`;
  g('reportPreview').innerHTML = html;
  toast('Report generated','success');
}

function printReport(){
  const prev=g('reportPreview').innerHTML;
  if(!prev){toast('Generate report first','warning');return;}
  const w=window.open('','_blank');
  w.document.write(`<!DOCTYPE html><html><head><title>Survey Report</title><style>body{font-family:Arial,sans-serif;margin:30px;}.mono{font-family:monospace;}</style></head><body>${prev}<script>window.print();<\/script></body></html>`);
  w.document.close();
}

function emailReport(){
  const idx=g('reportSurveySelect').value;
  if(idx===''){toast('Select a survey first','warning');return;}
  const s=surveys[parseInt(idx)];
  if(!s.clientEmail){toast('No client email for this survey','warning');return;}
  window.location.href=`mailto:${s.clientEmail}?subject=Survey Report â€” ${s.projectName}&body=Dear ${s.clientName},%0A%0APlease find your survey report details:%0A%0AProject: ${s.projectName}%0AVerification: ${s.verificationCode}%0AArea: ${s.hectares.toFixed(4)} ha%0A%0ASurveyPro Elite%0A${CFG.email}`;
}

function previewReport(){generateReport();document.getElementById('reportPreview').scrollIntoView({behavior:'smooth'});}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PRICING ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function subscribePro(){
  const msg='ğŸ’ Professional Subscription\n\nI would like to subscribe to SurveyPro Elite Professional plan (â‚¦5,000/month).\n\nPlease send payment details.';
  window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank');
}
function contactEnterprise(){
  const msg='ğŸ¢ Enterprise Plan Inquiry\n\nI am interested in the SurveyPro Elite Enterprise plan for my organization.\n\nPlease contact me with details.';
  window.open(`${CFG.whatsapp}?text=${encodeURIComponent(msg)}`,'_blank');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANGUAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setLang(l) {
  const langs={en:'English',ha:'Hausa',yo:'Yoruba',ig:'Igbo',fr:'French'};
  toast(`Language: ${langs[l]||l} â€” Multilingual interface coming in v2.0`,'info');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DARK MODE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleDark() {
  darkMode = !darkMode;
  document.body.classList.toggle('dark', darkMode);
  g('darkBtn').textContent = darkMode ? 'â˜€ï¸ Light' : 'ğŸŒ™ Dark';
  localStorage.setItem('sp_dark', darkMode ? '1' : '0');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL & TOAST & BANNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(html) {
  g('modalContent').innerHTML = html;
  g('modalBg').classList.add('open');
}
function closeModal() { g('modalBg').classList.remove('open'); }

function toast(msg, type='info') {
  const icons={success:'âœ…',warning:'âš ï¸',error:'âŒ',info:'ğŸ’¡'};
  const el=document.createElement('div');
  el.className=`toast t-${type}`;
  el.textContent=`${icons[type]||'ğŸ“‹'} ${msg}`;
  g('toastWrap').appendChild(el);
  requestAnimationFrame(()=>el.classList.add('show'));
  setTimeout(()=>{el.classList.remove('show');setTimeout(()=>el.remove(),400);},3500);
}

function showBanner(msg) {
  g('bannerMsg').textContent=msg;
  g('topBanner').classList.add('show');
  setTimeout(closeBanner,6000);
}
function closeBanner(){g('topBanner').classList.remove('show');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MATH UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shoelace(pts){
  let a=0;
  for(let i=0;i<pts.length;i++){const j=(i+1)%pts.length;a+=pts[i].e*pts[j].n-pts[j].e*pts[i].n;}
  return Math.abs(a/2);
}
function calcPerimeter(pts){
  let p=0;
  for(let i=0;i<pts.length;i++){const j=(i+1)%pts.length;p+=Math.sqrt((pts[j].n-pts[i].n)**2+(pts[j].e-pts[i].e)**2);}
  return p;
}
function v(id){const el=document.getElementById(id);return el?el.value.trim():'';}
function g(id){return document.getElementById(id);}
function saveSurveys(){try{localStorage.setItem('sp_elite_v2_surveys',JSON.stringify(surveys));}catch(e){console.warn('Storage error',e);}}
function loadSurv
