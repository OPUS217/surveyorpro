<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nigeria SurveyorPro Commercial v3.0 - Professional Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * { font-family: 'Inter', sans-serif; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        .hidden { display: none; }
        
        .tab-active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }
        
        .success-banner {
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Success Banner -->
    <div id="successBanner" class="hidden success-banner fixed top-0 left-0 right-0 bg-green-500 text-white px-4 py-3 z-50">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <span id="successMessage"></span>
            <button onclick="closeBanner()" class="text-white hover:text-gray-200">‚úï</button>
        </div>
    </div>

    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-40">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold">üìç Nigeria SurveyorPro Commercial</h1>
                    <p class="text-xs opacity-90">Professional Platform v3.0 | Fully Functional</p>
                </div>
                <div class="flex items-center space-x-3">
                    <select id="languageSelect" class="bg-white/20 text-white px-3 py-1 rounded-lg text-sm">
                        <option value="en">English</option>
                        <option value="ha">Hausa</option>
                        <option value="yo">Yoruba</option>
                        <option value="ig">Igbo</option>
                    </select>
                    <button onclick="toggleDarkMode()" class="bg-white/20 px-3 py-1 rounded-lg text-sm">
                        üåô
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <div class="max-w-6xl mx-auto px-4 py-4">
        <div class="bg-white rounded-xl shadow-lg p-2 flex overflow-x-auto space-x-2">
            <button onclick="showTab('survey')" id="tab-survey" class="tab-active px-4 py-2 rounded-lg font-semibold whitespace-nowrap">
                üìä Survey
            </button>
            <button onclick="showTab('advanced')" id="tab-advanced" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">
                üéØ Advanced Tools
            </button>
            <button onclick="showTab('geoinformatics')" id="tab-geoinformatics" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">
                üó∫Ô∏è GIS/Remote Sensing
            </button>
            <button onclick="showTab('history')" id="tab-history" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">
                üìö History
            </button>
            <button onclick="showTab('verify')" id="tab-verify" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">
                üîí Verify
            </button>
            <button onclick="showTab('equipment')" id="tab-equipment" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">
                üîß Equipment
            </button>
            <button onclick="showTab('training')" id="tab-training" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">
                üéì Training
            </button>
            <button onclick="showTab('services')" id="tab-services" class="px-4 py-2 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">
                üíº Services
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 pb-20">
        
        <!-- Survey Tab -->
        <div id="content-survey" class="tab-content">
            <!-- GPS Status -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6 card-hover">
                <h2 class="text-xl font-bold mb-4">GPS Status</h2>
                <div id="gpsInfo" class="mb-4">
                    <p class="text-gray-600">Click "Enable GPS" to start surveying</p>
                </div>
                <button onclick="enableGPS()" class="w-full gradient-bg text-white px-6 py-3 rounded-lg font-semibold hover:shadow-xl transition">
                    üì° Enable GPS
                </button>
            </div>

            <!-- Survey Controls -->
            <div id="surveyControls" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden card-hover">
                <h2 class="text-xl font-bold mb-4">Survey Controls</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <button onclick="addPoint()" class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition">
                        ‚ûï Add Point
                    </button>
                    <button onclick="undoLastPoint()" class="bg-yellow-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-yellow-700 transition">
                        ‚Ü©Ô∏è Undo Last
                    </button>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Point Notes:</label>
                    <input type="text" id="pointNotes" placeholder="Landmark, boundary marker, etc..." class="w-full px-4 py-2 border rounded-lg">
                </div>
                
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <div class="grid grid-cols-3 gap-4 text-sm">
                        <div>
                            <p class="text-gray-600">Points</p>
                            <p class="text-2xl font-bold text-purple-600" id="pointCount">0</p>
                        </div>
                        <div>
                            <p class="text-gray-600">Accuracy</p>
                            <p class="text-2xl font-bold" id="currentAccuracy">--</p>
                        </div>
                        <div>
                            <p class="text-gray-600">Status</p>
                            <p class="text-xl font-bold text-green-600" id="surveyStatus">Active</p>
                        </div>
                    </div>
                </div>
                
                <button onclick="completeSurvey()" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition">
                    ‚úÖ Complete Survey
                </button>
            </div>

            <!-- Points List -->
            <div id="pointsList" class="bg-white rounded-xl shadow-lg p-6 mb-6 hidden card-hover">
                <h2 class="text-xl font-bold mb-4">Captured Points</h2>
                <div id="pointsContent" class="space-y-2"></div>
            </div>

            <!-- Results -->
            <div id="results" class="bg-white rounded-xl shadow-lg p-6 hidden card-hover">
                <h2 class="text-xl font-bold mb-4">Survey Results</h2>
                <div id="resultsContent" class="space-y-4"></div>
                
                <!-- Client Information -->
                <div class="mt-6 border-t pt-6">
                    <h3 class="text-lg font-semibold mb-4">Client Information</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="text" id="clientName" placeholder="Client Name *" class="px-4 py-2 border rounded-lg" required>
                        <input type="tel" id="clientPhone" placeholder="Phone Number *" class="px-4 py-2 border rounded-lg" required>
                        <input type="email" id="clientEmail" placeholder="Email Address" class="px-4 py-2 border rounded-lg">
                        <input type="text" id="projectName" placeholder="Project Name *" class="px-4 py-2 border rounded-lg" required>
                        <input type="text" id="location" placeholder="Location/Address *" class="px-4 py-2 border rounded-lg" required>
                        <input type="text" id="plotNumber" placeholder="Plot Number" class="px-4 py-2 border rounded-lg">
                    </div>
                </div>
                
                <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3 mt-6">
                    <button onclick="saveSurvey()" class="flex-1 bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition">
                        üíæ Save Survey
                    </button>
                    <button onclick="emailSurvey()" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
                        üìß Email Report
                    </button>
                    <button onclick="newSurvey()" class="flex-1 gradient-bg text-white px-6 py-3 rounded-lg font-semibold hover:shadow-xl transition">
                        üîÑ New Survey
                    </button>
                </div>
            </div>
        </div>

        <!-- Advanced Tools Tab -->
        <div id="content-advanced" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                
                <!-- Coordinate Converter -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <h3 class="text-xl font-bold mb-4">üß≠ Coordinate Converter</h3>
                    <p class="text-sm text-gray-600 mb-4">Convert between Lat/Lon and UTM coordinates</p>
                    
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">Latitude</label>
                            <input type="number" id="inputLat" step="0.000001" placeholder="6.524379" class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Longitude</label>
                            <input type="number" id="inputLon" step="0.000001" placeholder="3.379206" class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <button onclick="convertCoordinates()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            Convert to UTM
                        </button>
                        <div id="conversionResult" class="bg-gray-50 p-3 rounded-lg text-sm hidden"></div>
                    </div>
                </div>

                <!-- Area Calculator -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <h3 class="text-xl font-bold mb-4">üìê Area Unit Converter</h3>
                    <p class="text-sm text-gray-600 mb-4">Convert between different area units</p>
                    
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">Value</label>
                            <input type="number" id="areaValue" step="0.0001" placeholder="1.5" class="w-full px-3 py-2 border rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">From Unit</label>
                            <select id="fromUnit" class="w-full px-3 py-2 border rounded-lg">
                                <option value="hectares">Hectares</option>
                                <option value="acres">Acres</option>
                                <option value="sqm">Square Meters</option>
                                <option value="sqft">Square Feet</option>
                                <option value="plots">Plots (Nigerian)</option>
                            </select>
                        </div>
                        <button onclick="convertArea()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            Convert All Units
                        </button>
                        <div id="areaResult" class="bg-gray-50 p-3 rounded-lg text-sm hidden"></div>
                    </div>
                </div>

                <!-- Distance Calculator -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <h3 class="text-xl font-bold mb-4">üìè Distance Calculator</h3>
                    <p class="text-sm text-gray-600 mb-4">Calculate distance between two GPS points</p>
                    
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="lat1" step="0.000001" placeholder="Lat 1" class="px-3 py-2 border rounded-lg text-sm">
                            <input type="number" id="lon1" step="0.000001" placeholder="Lon 1" class="px-3 py-2 border rounded-lg text-sm">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="lat2" step="0.000001" placeholder="Lat 2" class="px-3 py-2 border rounded-lg text-sm">
                            <input type="number" id="lon2" step="0.000001" placeholder="Lon 2" class="px-3 py-2 border rounded-lg text-sm">
                        </div>
                        <button onclick="calculateDistance()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                            Calculate Distance
                        </button>
                        <div id="distanceResult" class="bg-gray-50 p-3 rounded-lg text-sm hidden"></div>
                    </div>
                </div>

                <!-- Bearing Calculator -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <h3 class="text-xl font-bold mb-4">üß≠ Bearing & Azimuth</h3>
                    <p class="text-sm text-gray-600 mb-4">Calculate bearing between two points</p>
                    
                    <div class="space-y-3">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="bearLat1" step="0.000001" placeholder="From Lat" class="px-3 py-2 border rounded-lg text-sm">
                            <input type="number" id="bearLon1" step="0.000001" placeholder="From Lon" class="px-3 py-2 border rounded-lg text-sm">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="bearLat2" step="0.000001" placeholder="To Lat" class="px-3 py-2 border rounded-lg text-sm">
                            <input type="number" id="bearLon2" step="0.000001" placeholder="To Lon" class="px-3 py-2 border rounded-lg text-sm">
                        </div>
                        <button onclick="calculateBearing()" class="w-full bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                            Calculate Bearing
                        </button>
                        <div id="bearingResult" class="bg-gray-50 p-3 rounded-lg text-sm hidden"></div>
                    </div>
                </div>

            </div>
        </div>

        <!-- GIS/Geoinformatics Tab -->
        <div id="content-geoinformatics" class="tab-content hidden">
            <div class="grid grid-cols-1 gap-6">
                
                <!-- Remote Sensing Tools -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <h2 class="text-xl font-bold mb-4">üõ∞Ô∏è Remote Sensing & GIS Tools</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg border-2 border-blue-300">
                            <h4 class="font-bold text-blue-900 mb-2">NDVI Calculator</h4>
                            <p class="text-sm text-blue-800 mb-3">Normalized Difference Vegetation Index for crop health monitoring</p>
                            <button onclick="showNDVICalculator()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700">
                                Open Tool
                            </button>
                        </div>
                        
                        <div class="bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-lg border-2 border-green-300">
                            <h4 class="font-bold text-green-900 mb-2">DEM Analysis</h4>
                            <p class="text-sm text-green-800 mb-3">Digital Elevation Model terrain analysis and slope calculation</p>
                            <button onclick="showDEMAnalysis()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-green-700">
                                Open Tool
                            </button>
                        </div>
                        
                        <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-lg border-2 border-purple-300">
                            <h4 class="font-bold text-purple-900 mb-2">Change Detection</h4>
                            <p class="text-sm text-purple-800 mb-3">Land use/cover change analysis over time periods</p>
                            <button onclick="showChangeDetection()" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-purple-700">
                                Open Tool
                            </button>
                        </div>
                    </div>

                    <!-- NDVI Calculator -->
                    <div id="ndviTool" class="hidden bg-blue-50 rounded-lg p-6 border-2 border-blue-200">
                        <h3 class="font-bold text-lg mb-4">NDVI Calculator</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">NIR (Near-Infrared) Value</label>
                                <input type="number" id="nirValue" placeholder="0.0 - 1.0" step="0.01" class="w-full px-3 py-2 border rounded-lg">
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-2">RED (Visible Red) Value</label>
                                <input type="number" id="redValue" placeholder="0.0 - 1.0" step="0.01" class="w-full px-3 py-2 border rounded-lg">
                            </div>
                        </div>
                        <button onclick="calculateNDVI()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 mb-4">
                            Calculate NDVI
                        </button>
                        <div id="ndviResult" class="hidden"></div>
                    </div>

                    <!-- Problem Solvers -->
                    <div class="mt-6">
                        <h3 class="text-lg font-bold mb-4">üéØ Geoinformatics Problem Solvers</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            
                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h4 class="font-semibold mb-2">üåæ Agricultural Monitoring</h4>
                                <p class="text-sm text-gray-600 mb-3">Monitor crop health, predict yields, optimize irrigation</p>
                                <button onclick="requestAgriService()" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm w-full hover:bg-green-700">
                                    Request Service
                                </button>
                            </div>

                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h4 class="font-semibold mb-2">üèóÔ∏è Urban Planning</h4>
                                <p class="text-sm text-gray-600 mb-3">Land use mapping, infrastructure planning, zoning analysis</p>
                                <button onclick="requestUrbanService()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm w-full hover:bg-blue-700">
                                    Request Service
                                </button>
                            </div>

                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h4 class="font-semibold mb-2">üåä Flood Risk Assessment</h4>
                                <p class="text-sm text-gray-600 mb-3">Hydrological modeling, drainage analysis, risk mapping</p>
                                <button onclick="requestFloodService()" class="bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm w-full hover:bg-cyan-700">
                                    Request Service
                                </button>
                            </div>

                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h4 class="font-semibold mb-2">üó∫Ô∏è Cadastral Mapping</h4>
                                <p class="text-sm text-gray-600 mb-3">Property boundaries, title surveys, land registry integration</p>
                                <button onclick="requestCadastralService()" class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm w-full hover:bg-purple-700">
                                    Request Service
                                </button>
                            </div>

                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h4 class="font-semibold mb-2">üõ£Ô∏è Infrastructure Planning</h4>
                                <p class="text-sm text-gray-600 mb-3">Road alignment, pipeline routing, site selection</p>
                                <button onclick="requestInfraService()" class="bg-orange-600 text-white px-4 py-2 rounded-lg text-sm w-full hover:bg-orange-700">
                                    Request Service
                                </button>
                            </div>

                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <h4 class="font-semibold mb-2">üå≤ Environmental Impact</h4>
                                <p class="text-sm text-gray-600 mb-3">EIA studies, deforestation monitoring, conservation planning</p>
                                <button onclick="requestEnvironmentalService()" class="bg-emerald-600 text-white px-4 py-2 rounded-lg text-sm w-full hover:bg-emerald-700">
                                    Request Service
                                </button>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Satellite Data Access -->
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <h2 class="text-xl font-bold mb-4">üì° Free Satellite Data Sources</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        
                        <a href="https://earthexplorer.usgs.gov/" target="_blank" class="block bg-blue-50 p-4 rounded-lg border-2 border-blue-200 hover:border-blue-400 transition">
                            <h4 class="font-bold text-blue-900">USGS EarthExplorer</h4>
                            <p class="text-sm text-gray-600 mt-1">Landsat, ASTER, SRTM data</p>
                        </a>

                        <a href="https://scihub.copernicus.eu/" target="_blank" class="block bg-green-50 p-4 rounded-lg border-2 border-green-200 hover:border-green-400 transition">
                            <h4 class="font-bold text-green-900">Copernicus Open Hub</h4>
                            <p class="text-sm text-gray-600 mt-1">Sentinel-1, 2, 3 data</p>
                        </a>

                        <a href="https://search.earthdata.nasa.gov/" target="_blank" class="block bg-purple-50 p-4 rounded-lg border-2 border-purple-200 hover:border-purple-400 transition">
                            <h4 class="font-bold text-purple-900">NASA Earthdata</h4>
                            <p class="text-sm text-gray-600 mt-1">MODIS, VIIRS, GPM data</p>
                        </a>

                        <a href="https://code.earthengine.google.com/" target="_blank" class="block bg-red-50 p-4 rounded-lg border-2 border-red-200 hover:border-red-400 transition">
                            <h4 class="font-bold text-red-900">Google Earth Engine</h4>
                            <p class="text-sm text-gray-600 mt-1">Cloud-based analysis platform</p>
                        </a>

                    </div>
                </div>

            </div>
        </div>

        <!-- History Tab (same as before) -->
        <div id="content-history" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <h2 class="text-xl font-bold mb-4">Survey History</h2>
                <div id="historyContent" class="space-y-4"></div>
            </div>
        </div>

        <!-- Verify Tab (same as before but functional) -->
        <div id="content-verify" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <h2 class="text-xl font-bold mb-6 text-center">üîí Verify Survey Plan</h2>
                <p class="text-gray-600 text-center mb-6">Enter verification code to authenticate survey document</p>
                
                <input type="text" id="verifyCode" placeholder="Enter Code (e.g., NGS-XXXXX)" 
                       class="w-full px-4 py-3 border-2 rounded-lg text-center font-mono text-lg mb-4">
                
                <button onclick="verifySurvey()" class="w-full gradient-bg text-white px-6 py-3 rounded-lg font-semibold hover:shadow-xl transition">
                    Verify Survey Plan
                </button>
                
                <div id="verifyResult" class="mt-6"></div>
                
                <div class="mt-8 bg-blue-50 border-2 border-blue-200 rounded-xl p-6">
                    <h4 class="font-bold text-blue-900 mb-3">üõ°Ô∏è Anti-Fraud Protection</h4>
                    <p class="text-sm text-blue-800 leading-relaxed">
                        Every survey includes unique verification codes and QR codes for instant authentication.
                        All data is timestamped and GPS-verified to prevent fraudulent documentation.
                    </p>
                </div>
            </div>
        </div>

        <!-- Equipment Tab (With REAL Booking) -->
        <div id="content-equipment" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <h2 class="text-xl font-bold mb-4">üîß Equipment Marketplace</h2>
                <p class="text-gray-600 mb-6">Book professional surveying equipment - Get instant WhatsApp confirmation</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="equipmentList">
                    <!-- Equipment items will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Training Tab (With REAL Paystack Payment) -->
        <div id="content-training" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <h2 class="text-xl font-bold mb-4">üéì Professional Training Courses</h2>
                <p class="text-gray-600 mb-6">Enroll now with instant payment processing via Paystack</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="trainingList">
                    <!-- Training courses will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Services Tab (NEW - Professional Services) -->
        <div id="content-services" class="tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <h2 class="text-xl font-bold mb-4">üíº Professional Surveying Services</h2>
                <p class="text-gray-600 mb-6">Request quotes for professional surveying services</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    
                    <div class="border-2 border-gray-200 rounded-lg p-5 hover:border-purple-400 transition">
                        <div class="text-4xl mb-3">üìê</div>
                        <h3 class="font-bold text-lg mb-2">Topographic Survey</h3>
                        <p class="text-sm text-gray-600 mb-4">Detailed terrain mapping for construction and infrastructure projects</p>
                        <p class="text-green-600 font-bold mb-3">From ‚Ç¶150,000</p>
                        <button onclick="requestServiceQuote('topographic')" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            Request Quote
                        </button>
                    </div>

                    <div class="border-2 border-gray-200 rounded-lg p-5 hover:border-purple-400 transition">
                        <div class="text-4xl mb-3">üèòÔ∏è</div>
                        <h3 class="font-bold text-lg mb-2">Cadastral Survey</h3>
                        <p class="text-sm text-gray-600 mb-4">Property boundary demarcation and C of O documentation</p>
                        <p class="text-green-600 font-bold mb-3">From ‚Ç¶100,000</p>
                        <button onclick="requestServiceQuote('cadastral')" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            Request Quote
                        </button>
                    </div>

                    <div class="border-2 border-gray-200 rounded-lg p-5 hover:border-purple-400 transition">
                        <div class="text-4xl mb-3">üèóÔ∏è</div>
                        <h3 class="font-bold text-lg mb-2">Engineering Survey</h3>
                        <p class="text-sm text-gray-600 mb-4">Site layout, road alignment, structure positioning</p>
                        <p class="text-green-600 font-bold mb-3">From ‚Ç¶200,000</p>
                        <button onclick="requestServiceQuote('engineering')" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            Request Quote
                        </button>
                    </div>

                    <div class="border-2 border-gray-200 rounded-lg p-5 hover:border-purple-400 transition">
                        <div class="text-4xl mb-3">üöÅ</div>
                        <h3 class="font-bold text-lg mb-2">Drone Mapping</h3>
                        <p class="text-sm text-gray-600 mb-4">Aerial photogrammetry and orthophoto generation</p>
                        <p class="text-green-600 font-bold mb-3">From ‚Ç¶250,000</p>
                        <button onclick="requestServiceQuote('drone')" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            Request Quote
                        </button>
                    </div>

                    <div class="border-2 border-gray-200 rounded-lg p-5 hover:border-purple-400 transition">
                        <div class="text-4xl mb-3">üåä</div>
                        <h3 class="font-bold text-lg mb-2">Hydrographic Survey</h3>
                        <p class="text-sm text-gray-600 mb-4">Water body mapping, depth measurement, volume calculation</p>
                        <p class="text-green-600 font-bold mb-3">From ‚Ç¶300,000</p>
                        <button onclick="requestServiceQuote('hydrographic')" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            Request Quote
                        </button>
                    </div>

                    <div class="border-2 border-gray-200 rounded-lg p-5 hover:border-purple-400 transition">
                        <div class="text-4xl mb-3">üó∫Ô∏è</div>
                        <h3 class="font-bold text-lg mb-2">GIS Mapping</h3>
                        <p class="text-sm text-gray-600 mb-4">Spatial data collection, analysis, and map production</p>
                        <p class="text-green-600 font-bold mb-3">From ‚Ç¶180,000</p>
                        <button onclick="requestServiceQuote('gis')" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            Request Quote
                        </button>
                    </div>

                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white text-center py-6 mt-12">
        <p class="text-sm">¬© 2026 Nigeria SurveyorPro Commercial v3.0 | Fully Functional Platform</p>
        <p class="text-xs opacity-75 mt-2">
            üìû Contact: +234-811-755-4948 | üìß <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="21484f474e615254535744584e5351534e0f4f46">[email&#160;protected]</a> | üåê surveyorpro platform
        </p>
        <p class="text-xs opacity-75 mt-1">Powered by Advanced Geodetic Algorithms | PayStack Integrated</p>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // Configuration - UPDATE THESE WITH YOUR DETAILS
        const CONFIG = {
            paystackPublicKey: 'pk_test_eccaa497055c149e45a6f21500a322cb584ec9eb', // Get from paystack.com
            businessPhone: '2348117554948', // Your WhatsApp number (234...)
            businessEmail: 'opusarnold@gmail.com', // Your email
            businessName: 'Surveypro'
        };

        // Global state
        let currentPosition = null;
        let watchId = null;
        let points = [];
        let surveys = [];
        let currentLanguage = 'en';

        // Equipment data with real pricing
        const equipment = [
            {
                id: 'total-station',
                name: 'Total Station (Leica TS06)',
                price: 15000,
                description: 'High-precision electronic theodolite with 2" accuracy',
                image: 'üìê'
            },
            {
                id: 'drone',
                name: 'Survey Drone (DJI Phantom 4 RTK)',
                price: 25000,
                description: 'Professional mapping drone with RTK GPS',
                image: 'üöÅ'
            },
            {
                id: 'gnss',
                name: 'GNSS Receiver (Trimble R10)',
                price: 20000,
                description: 'RTK GPS with cm-level accuracy',
                image: 'üì°'
            },
            {
                id: 'laser-scanner',
                name: '3D Laser Scanner',
                price: 30000,
                description: 'Terrestrial laser scanner for detailed 3D mapping',
                image: 'üìè'
            }
        ];

        // Training courses with real prices
        const courses = [
            {
                id: 'gis-advanced',
                name: 'Advanced GIS Mapping',
                price: 2500000, // ‚Ç¶25,000 in kobo (Paystack uses kobo)
                duration: '12 hours',
                level: 'Beginner',
                description: 'Master QGIS and ArcGIS for professional surveying'
            },
            {
                id: 'drone-survey',
                name: 'Drone Surveying & Mapping',
                price: 4500000, // ‚Ç¶45,000
                duration: '16 hours',
                level: 'Intermediate',
                description: 'Aerial photogrammetry and LiDAR techniques'
            },
            {
                id: 'ai-surveying',
                name: 'AI in Land Surveying',
                price: 3500000, // ‚Ç¶35,000
                duration: '10 hours',
                level: 'Advanced',
                description: 'Machine learning for automated feature extraction'
            },
            {
                id: 'rtk-gnss',
                name: 'RTK/GNSS Fundamentals',
                price: 2000000, // ‚Ç¶20,000
                duration: '8 hours',
                level: 'Beginner',
                description: 'High-precision GPS surveying techniques'
            }
        ];

        // Initialize
        function init() {
            loadData();
            populateEquipment();
            populateTraining();
            updateHistory();
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('[id^="tab-"]').forEach(el => el.classList.remove('tab-active'));
            
            document.getElementById('content-' + tabName).classList.remove('hidden');
            document.getElementById('content-' + tabName).classList.add('fade-in');
            document.getElementById('tab-' + tabName).classList.add('tab-active');
        }

        // Success banner
        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successBanner').classList.remove('hidden');
            setTimeout(() => closeBanner(), 5000);
        }

        function closeBanner() {
            document.getElementById('successBanner').classList.add('hidden');
        }

        // GPS Functions (keeping existing code)
        function enableGPS() {
            if (!navigator.geolocation) {
                alert('GPS not supported by your browser');
                return;
            }

            document.getElementById('gpsInfo').innerHTML = '<p class="text-blue-600 pulse">üîÑ Acquiring GPS signal...</p>';

            watchId = navigator.geolocation.watchPosition(
                (position) => {
                    currentPosition = position;
                    const accuracy = position.coords.accuracy;
                    const lat = position.coords.latitude.toFixed(6);
                    const lon = position.coords.longitude.toFixed(6);
                    
                    let accuracyClass = accuracy < 5 ? 'text-green-600' : accuracy < 10 ? 'text-blue-600' : accuracy < 20 ? 'text-yellow-600' : 'text-red-600';
                    let accuracyText = accuracy < 5 ? 'Excellent' : accuracy < 10 ? 'Good' : accuracy < 20 ? 'Fair' : 'Poor';
                    
                    document.getElementById('gpsInfo').innerHTML = `
                        <div class="space-y-2">
                            <p class="font-semibold ${accuracyClass}">‚úì GPS Active - ${accuracyText} Signal</p>
                            <div class="grid grid-cols-2 gap-3 text-sm">
                                <div class="bg-gray-50 p-2 rounded">
                                    <p class="text-gray-500">Latitude</p>
                                    <p class="font-mono font-semibold">${lat}¬∞</p>
                                </div>
                                <div class="bg-gray-50 p-2 rounded">
                                    <p class="text-gray-500">Longitude</p>
                                    <p class="font-mono font-semibold">${lon}¬∞</p>
                                </div>
                                <div class="bg-gray-50 p-2 rounded">
                                    <p class="text-gray-500">Accuracy</p>
                                    <p class="font-semibold">¬±${accuracy.toFixed(1)}m</p>
                                </div>
                                <div class="bg-gray-50 p-2 rounded">
                                    <p class="text-gray-500">UTM Zone</p>
                                    <p class="font-semibold">${getUTMZone(lat, lon)}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('currentAccuracy').textContent = `¬±${accuracy.toFixed(1)}m`;
                    document.getElementById('currentAccuracy').className = accuracyClass.replace('text', 'text-2xl font-bold');
                    
                    document.getElementById('surveyControls').classList.remove('hidden');
                    document.getElementById('pointsList').classList.remove('hidden');
                },
                (error) => {
                    document.getElementById('gpsInfo').innerHTML = `<p class="text-red-600">‚ùå Error: ${error.message}</p>`;
                },
                { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
            );
        }

        function getUTMZone(lat, lon) {
            const zone = Math.floor((lon + 180) / 6) + 1;
            const letter = lat >= 0 ? 'N' : 'S';
            return `${zone}${letter}`;
        }

        function addPoint() {
            if (!currentPosition) {
                alert('Waiting for GPS signal...');
                return;
            }

            const notes = document.getElementById('pointNotes').value;

            const point = {
                lat: currentPosition.coords.latitude,
                lon: currentPosition.coords.longitude,
                accuracy: currentPosition.coords.accuracy,
                timestamp: new Date().toISOString(),
                notes: notes || '',
                utmZone: getUTMZone(currentPosition.coords.latitude, currentPosition.coords.longitude)
            };

            points.push(point);
            document.getElementById('pointCount').textContent = points.length;
            document.getElementById('pointNotes').value = '';

            updatePointsList();
            showSuccess(`Point ${points.length} added successfully!`);
        }

        function undoLastPoint() {
            if (points.length === 0) {
                alert('No points to undo');
                return;
            }
            points.pop();
            document.getElementById('pointCount').textContent = points.length;
            updatePointsList();
            showSuccess('Last point removed');
        }

        function updatePointsList() {
            const html = points.map((p, i) => `
                <div class="bg-gray-50 p-3 rounded-lg border-l-4 border-purple-500">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <p class="font-semibold text-purple-700">Point ${i + 1}</p>
                            <p class="text-xs text-gray-600 font-mono">
                                ${p.lat.toFixed(6)}¬∞, ${p.lon.toFixed(6)}¬∞ | UTM: ${p.utmZone}
                            </p>
                            ${p.notes ? `<p class="text-sm text-gray-700 mt-1">üìù ${p.notes}</p>` : ''}
                            <p class="text-xs text-gray-500 mt-1">¬±${p.accuracy.toFixed(1)}m | ${new Date(p.timestamp).toLocaleTimeString()}</p>
                        </div>
                        <button onclick="deletePoint(${i})" class="text-red-500 hover:text-red-700 text-sm">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('pointsContent').innerHTML = html || '<p class="text-gray-500 text-center py-4">No points captured yet</p>';
        }

        function deletePoint(index) {
            if (confirm('Delete this point?')) {
                points.splice(index, 1);
                document.getElementById('pointCount').textContent = points.length;
                updatePointsList();
            }
        }

        // Complete survey with Vincenty calculations
        function completeSurvey() {
            if (points.length < 3) {
                alert('Need at least 3 points to complete survey');
                return;
            }

            // Vincenty distance
            function vincentyDistance(lat1, lon1, lat2, lon2) {
                const a = 6378137;
                const b = 6356752.314245;
                const f = 1 / 298.257223563;
                
                const L = (lon2 - lon1) * Math.PI / 180;
                const U1 = Math.atan((1 - f) * Math.tan(lat1 * Math.PI / 180));
                const U2 = Math.atan((1 - f) * Math.tan(lat2 * Math.PI / 180));
                const sinU1 = Math.sin(U1), cosU1 = Math.cos(U1);
                const sinU2 = Math.sin(U2), cosU2 = Math.cos(U2);
                
                let lambda = L, lambdaP, iterLimit = 100;
                let cosSqAlpha, sinSigma, cos2SigmaM, cosSigma, sigma;
                
                do {
                    const sinLambda = Math.sin(lambda), cosLambda = Math.cos(lambda);
                    sinSigma = Math.sqrt((cosU2 * sinLambda) * (cosU2 * sinLambda) +
                        (cosU1 * sinU2 - sinU1 * cosU2 * cosLambda) * (cosU1 * sinU2 - sinU1 * cosU2 * cosLambda));
                    
                    if (sinSigma === 0) return 0;
                    
                    cosSigma = sinU1 * sinU2 + cosU1 * cosU2 * cosLambda;
                    sigma = Math.atan2(sinSigma, cosSigma);
                    const sinAlpha = cosU1 * cosU2 * sinLambda / sinSigma;
                    cosSqAlpha = 1 - sinAlpha * sinAlpha;
                    cos2SigmaM = cosSigma - 2 * sinU1 * sinU2 / cosSqAlpha;
                    
                    if (isNaN(cos2SigmaM)) cos2SigmaM = 0;
                    
                    const C = f / 16 * cosSqAlpha * (4 + f * (4 - 3 * cosSqAlpha));
                    lambdaP = lambda;
                    lambda = L + (1 - C) * f * sinAlpha *
                        (sigma + C * sinSigma * (cos2SigmaM + C * cosSigma * (-1 + 2 * cos2SigmaM * cos2SigmaM)));
                } while (Math.abs(lambda - lambdaP) > 1e-12 && --iterLimit > 0);
                
                const uSq = cosSqAlpha * (a * a - b * b) / (b * b);
                const A = 1 + uSq / 16384 * (4096 + uSq * (-768 + uSq * (320 - 175 * uSq)));
                const B = uSq / 1024 * (256 + uSq * (-128 + uSq * (74 - 47 * uSq)));
                const deltaSigma = B * sinSigma * (cos2SigmaM + B / 4 * (cosSigma * (-1 + 2 * cos2SigmaM * cos2SigmaM) -
                    B / 6 * cos2SigmaM * (-3 + 4 * sinSigma * sinSigma) * (-3 + 4 * cos2SigmaM * cos2SigmaM)));
                
                return b * A * (sigma - deltaSigma);
            }

            // Calculate area
            let area = 0;
            for (let i = 0; i < points.length; i++) {
                const j = (i + 1) % points.length;
                area += points[i].lat * points[j].lon;
                area -= points[j].lat * points[i].lon;
            }
            area = Math.abs(area / 2);
            
            const areaM2 = area * 111320 * 111320 * Math.cos(points[0].lat * Math.PI / 180);
            const hectares = areaM2 / 10000;
            const acres = hectares * 2.47105;
            const plots = areaM2 / 500; // Nigerian plot ‚âà 500sqm

            // Calculate perimeter
            let perimeter = 0;
            for (let i = 0; i < points.length; i++) {
                const j = (i + 1) % points.length;
                perimeter += vincentyDistance(points[i].lat, points[i].lon, points[j].lat, points[j].lon);
            }

            const verificationCode = 'NGS-' + Date.now().toString(36).toUpperCase();

            document.getElementById('resultsContent').innerHTML = `
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-500 rounded-lg p-6">
                    <p class="text-2xl font-bold text-green-800 text-center">‚úì Survey Complete!</p>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-200">
                        <p class="text-xs text-gray-600">Hectares</p>
                        <p class="text-xl font-bold text-blue-800">${hectares.toFixed(4)}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border-2 border-green-200">
                        <p class="text-xs text-gray-600">Acres</p>
                        <p class="text-xl font-bold text-green-800">${acres.toFixed(4)}</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg border-2 border-purple-200">
                        <p class="text-xs text-gray-600">Sq. Meters</p>
                        <p class="text-xl font-bold text-purple-800">${areaM2.toFixed(2)}</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg border-2 border-yellow-200">
                        <p class="text-xs text-gray-600">Plots (NG)</p>
                        <p class="text-xl font-bold text-yellow-800">${plots.toFixed(2)}</p>
                    </div>
                </div>
                
                <div class="bg-indigo-50 p-4 rounded-lg border-2 border-indigo-200">
                    <p class="text-sm text-gray-600">Perimeter</p>
                    <p class="text-2xl font-bold text-indigo-800">${perimeter.toFixed(2)} meters (${(perimeter/1000).toFixed(3)} km)</p>
                </div>
                
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg border-2 border-purple-200">
                    <p class="text-sm text-gray-600 mb-2 text-center">Verification Code</p>
                    <p class="text-2xl font-bold font-mono text-purple-800 text-center">${verificationCode}</p>
                    <div id="qrcode-${verificationCode}" class="flex justify-center mt-3"></div>
                </div>
            `;

            window.currentSurveyResults = {
                verificationCode,
                area: areaM2,
                hectares,
                acres,
                plots,
                perimeter,
                points: points.length,
                utmZone: points[0].utmZone,
                date: new Date().toISOString(),
                pointsData: JSON.parse(JSON.stringify(points))
            };

            document.getElementById('results').classList.remove('hidden');
            document.getElementById('surveyControls').classList.add('hidden');

            setTimeout(() => {
                new QRCode(document.getElementById('qrcode-' + verificationCode), {
                    text: verificationCode,
                    width: 128,
                    height: 128
                });
            }, 100);

            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
            }

            showSuccess('Survey completed successfully!');
        }

        // Save survey
        function saveSurvey() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientPhone = document.getElementById('clientPhone').value.trim();
            const projectName = document.getElementById('projectName').value.trim();
            const location = document.getElementById('location').value.trim();

            if (!clientName || !clientPhone || !projectName || !location) {
                alert('Please fill in all required fields (marked with *)');
                return;
            }

            const survey = {
                ...window.currentSurveyResults,
                clientName,
                clientPhone,
                clientEmail: document.getElementById('clientEmail').value.trim(),
                projectName,
                location,
                plotNumber: document.getElementById('plotNumber').value.trim(),
                savedAt: new Date().toISOString()
            };

            surveys.push(survey);
            saveData();
            updateHistory();

            showSuccess('‚úì Survey saved successfully!');
        }

        // Email survey
        function emailSurvey() {
            const email = document.getElementById('clientEmail').value.trim();
            if (!email) {
                alert('Please enter client email address');
                return;
            }

            const results = window.currentSurveyResults;
            const body = `Survey Report
            
Project: ${document.getElementById('projectName').value}
Client: ${document.getElementById('clientName').value}
Location: ${document.getElementById('location').value}

Results:
- Area: ${results.hectares.toFixed(4)} hectares (${results.acres.toFixed(4)} acres)
- Perimeter: ${results.perimeter.toFixed(2)} meters
- Points: ${results.points}
- Verification Code: ${results.verificationCode}

Survey Date: ${new Date().toLocaleDateString('en-NG')}
            `;

            const mailtoLink = `mailto:${email}?subject=Survey Report - ${document.getElementById('projectName').value}&body=${encodeURIComponent(body)}`;
            window.location.href = mailtoLink;
            
            showSuccess('Email client opened!');
        }

        // New survey
        function newSurvey() {
            if (!confirm('Start a new survey? Current data will be cleared if not saved.')) return;
            
            points = [];
            currentPosition = null;
            document.getElementById('pointCount').textContent = '0';
            document.getElementById('results').classList.add('hidden');
            document.getElementById('surveyControls').classList.add('hidden');
            document.getElementById('pointsList').classList.add('hidden');
            document.getElementById('gpsInfo').innerHTML = '<p class="text-gray-600">Click "Enable GPS" to start surveying</p>';
            
            ['clientName', 'clientPhone', 'clientEmail', 'projectName', 'location', 'plotNumber'].forEach(id => {
                document.getElementById(id).value = '';
            });
            
            updatePointsList();
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
        }

        // Advanced Tools Functions
        function convertCoordinates() {
            const lat = parseFloat(document.getElementById('inputLat').value);
            const lon = parseFloat(document.getElementById('inputLon').value);
            
            if (isNaN(lat) || isNaN(lon)) {
                alert('Please enter valid coordinates');
                return;
            }
            
            // Simple UTM conversion (approximation)
            const zone = Math.floor((lon + 180) / 6) + 1;
            const centralMeridian = (zone - 1) * 6 - 180 + 3;
            const k0 = 0.9996;
            
            const latRad = lat * Math.PI / 180;
            const lonRad = lon * Math.PI / 180;
            const cmRad = centralMeridian * Math.PI / 180;
            
            const a = 6378137;
            const e2 = 0.00669438;
            const n = a / Math.sqrt(1 - e2 * Math.sin(latRad) * Math.sin(latRad));
            const t = Math.tan(latRad) * Math.tan(latRad);
            const c = e2 * Math.cos(latRad) * Math.cos(latRad) / (1 - e2);
            const A = (lonRad - cmRad) * Math.cos(latRad);
            
            const M = a * ((1 - e2/4 - 3*e2*e2/64 - 5*e2*e2*e2/256) * latRad);
            
            const easting = k0 * n * (A + (1-t+c)*A*A*A/6 + (5-18*t+t*t+72*c-58*e2/(1-e2))*A*A*A*A*A/120) + 500000;
            const northing = k0 * (M + n*Math.tan(latRad)*(A*A/2 + (5-t+9*c+4*c*c)*A*A*A*A/24));
            
            document.getElementById('conversionResult').classList.remove('hidden');
            document.getElementById('conversionResult').innerHTML = `
                <p class="font-semibold text-purple-700 mb-2">UTM Coordinates:</p>
                <p><strong>Zone:</strong> ${zone}${lat >= 0 ? 'N' : 'S'}</p>
                <p><strong>Easting:</strong> ${easting.toFixed(2)} m</p>
                <p><strong>Northing:</strong> ${northing.toFixed(2)} m</p>
            `;
            
            showSuccess('Coordinates converted!');
        }

        function convertArea() {
            const value = parseFloat(document.getElementById('areaValue').value);
            const fromUnit = document.getElementById('fromUnit').value;
            
            if (isNaN(value) || value <= 0) {
                alert('Please enter a valid area value');
                return;
            }
            
            // Convert everything to square meters first
            let sqm;
            switch(fromUnit) {
                case 'hectares': sqm = value * 10000; break;
                case 'acres': sqm = value * 4046.86; break;
                case 'sqm': sqm = value; break;
                case 'sqft': sqm = value * 0.092903; break;
                case 'plots': sqm = value * 500; break;
            }
            
            const hectares = sqm / 10000;
            const acres = sqm / 4046.86;
            const sqft = sqm / 0.092903;
            const plots = sqm / 500;
            
            document.getElementById('areaResult').classList.remove('hidden');
            document.getElementById('areaResult').innerHTML = `
                <p class="font-semibold text-blue-700 mb-2">Conversions:</p>
                <p><strong>Hectares:</strong> ${hectares.toFixed(4)} ha</p>
                <p><strong>Acres:</strong> ${acres.toFixed(4)} ac</p>
                <p><strong>Square Meters:</strong> ${sqm.toFixed(2)} m¬≤</p>
                <p><strong>Square Feet:</strong> ${sqft.toFixed(2)} ft¬≤</p>
                <p><strong>Plots (Nigerian):</strong> ${plots.toFixed(2)} plots</p>
            `;
            
            showSuccess('Area converted!');
        }

        function calculateDistance() {
            const lat1 = parseFloat(document.getElementById('lat1').value);
            const lon1 = parseFloat(document.getElementById('lon1').value);
            const lat2 = parseFloat(document.getElementById('lat2').value);
            const lon2 = parseFloat(document.getElementById('lon2').value);
            
            if (isNaN(lat1) || isNaN(lon1) || isNaN(lat2) || isNaN(lon2)) {
                alert('Please enter all coordinates');
                return;
            }
            
            // Haversine formula
            const R = 6371000; // Earth's radius in meters
            const œÜ1 = lat1 * Math.PI / 180;
            const œÜ2 = lat2 * Math.PI / 180;
            const ŒîœÜ = (lat2 - lat1) * Math.PI / 180;
            const ŒîŒª = (lon2 - lon1) * Math.PI / 180;
            
            const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) +
                     Math.cos(œÜ1) * Math.cos(œÜ2) *
                     Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            
            document.getElementById('distanceResult').classList.remove('hidden');
            document.getElementById('distanceResult').innerHTML = `
                <p class="font-semibold text-green-700 mb-2">Distance:</p>
                <p><strong>Meters:</strong> ${distance.toFixed(2)} m</p>
                <p><strong>Kilometers:</strong> ${(distance/1000).toFixed(3)} km</p>
                <p><strong>Feet:</strong> ${(distance*3.28084).toFixed(2)} ft</p>
                <p><strong>Miles:</strong> ${(distance/1609.34).toFixed(3)} mi</p>
            `;
            
            showSuccess('Distance calculated!');
        }

        function calculateBearing() {
            const lat1 = parseFloat(document.getElementById('bearLat1').value);
            const lon1 = parseFloat(document.getElementById('bearLon1').value);
            const lat2 = parseFloat(document.getElementById('bearLat2').value);
            const lon2 = parseFloat(document.getElementById('bearLon2').value);
            
            if (isNaN(lat1) || isNaN(lon1) || isNaN(lat2) || isNaN(lon2)) {
                alert('Please enter all coordinates');
                return;
            }
            
            const œÜ1 = lat1 * Math.PI / 180;
            const œÜ2 = lat2 * Math.PI / 180;
            const ŒîŒª = (lon2 - lon1) * Math.PI / 180;
            
            const y = Math.sin(ŒîŒª) * Math.cos(œÜ2);
            const x = Math.cos(œÜ1) * Math.sin(œÜ2) -
                     Math.sin(œÜ1) * Math.cos(œÜ2) * Math.cos(ŒîŒª);
            let bearing = Math.atan2(y, x) * 180 / Math.PI;
            bearing = (bearing + 360) % 360;
            
            // Convert to compass direction
            const directions = ['N', 'NNE', 'NE', 'ENE', 'E', 'ESE', 'SE', 'SSE', 'S', 'SSW', 'SW', 'WSW', 'W', 'WNW', 'NW', 'NNW'];
            const index = Math.round(bearing / 22.5) % 16;
            const direction = directions[index];
            
            document.getElementById('bearingResult').classList.remove('hidden');
            document.getElementById('bearingResult').innerHTML = `
                <p class="font-semibold text-yellow-700 mb-2">Bearing:</p>
                <p><strong>Azimuth:</strong> ${bearing.toFixed(2)}¬∞</p>
                <p><strong>Direction:</strong> ${direction}</p>
                <p><strong>Back Bearing:</strong> ${((bearing + 180) % 360).toFixed(2)}¬∞</p>
            `;
            
            showSuccess('Bearing calculated!');
        }

        // GIS Tools
        function showNDVICalculator() {
            document.getElementById('ndviTool').classList.toggle('hidden');
        }

        function calculateNDVI() {
            const nir = parseFloat(document.getElementById('nirValue').value);
            const red = parseFloat(document.getElementById('redValue').value);
            
            if (isNaN(nir) || isNaN(red) || nir < 0 || nir > 1 || red < 0 || red > 1) {
                alert('Please enter valid values between 0 and 1');
                return;
            }
            
            const ndvi = (nir - red) / (nir + red);
            
            let interpretation = '';
            let color = '';
            if (ndvi < 0) {
                interpretation = 'Water, clouds, snow';
                color = 'text-blue-800';
            } else if (ndvi < 0.2) {
                interpretation = 'Barren rock, sand, urban areas';
                color = 'text-gray-800';
            } else if (ndvi < 0.5) {
                interpretation = 'Shrubs, grassland, sparse vegetation';
                color = 'text-yellow-800';
            } else {
                interpretation = 'Dense vegetation, healthy crops, forests';
                color = 'text-green-800';
            }
            
            document.getElementById('ndviResult').classList.remove('hidden');
            document.getElementById('ndviResult').innerHTML = `
                <div class="bg-white rounded-lg p-4">
                    <p class="text-2xl font-bold ${color} mb-2">NDVI: ${ndvi.toFixed(3)}</p>
                    <p class="text-sm"><strong>Interpretation:</strong> ${interpretation}</p>
                    <div class="mt-3 bg-gray-100 rounded p-2">
                        <p class="text-xs text-gray-600"><strong>Formula:</strong> NDVI = (NIR - RED) / (NIR + RED)</p>
                    </div>
                </div>
            `;
            
            showSuccess('NDVI calculated!');
        }

        // GIS Service Requests
        function requestAgriService() {
            requestGISService('Agricultural Monitoring', 'Crop health analysis, yield prediction, irrigation optimization');
        }

        function requestUrbanService() {
            requestGISService('Urban Planning', 'Land use mapping, infrastructure planning, zoning analysis');
        }

        function requestFloodService() {
            requestGISService('Flood Risk Assessment', 'Hydrological modeling, drainage analysis, risk mapping');
        }

        function requestCadastralService() {
            requestGISService('Cadastral Mapping', 'Property boundaries, title surveys, land registry integration');
        }

        function requestInfraService() {
            requestGISService('Infrastructure Planning', 'Road alignment, pipeline routing, site selection');
        }

        function requestEnvironmentalService() {
            requestGISService('Environmental Impact Assessment', 'EIA studies, deforestation monitoring, conservation planning');
        }

        function requestGISService(serviceName, description) {
            const message = `Hi! I'm interested in ${serviceName} services (${description}). Please send me more information and a quote.`;
            const whatsappURL = `https://wa.me/${CONFIG.businessPhone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappURL, '_blank');
            showSuccess('Opening WhatsApp...');
        }

        // Equipment booking
        function populateEquipment() {
            const html = equipment.map(item => `
                <div class="border-2 border-gray-200 rounded-lg overflow-hidden hover:border-purple-400 transition">
                    <div class="bg-gradient-to-r from-purple-500 to-blue-500 h-32 flex items-center justify-center text-white text-6xl">
                        ${item.image}
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-2">${item.name}</h3>
                        <p class="text-sm text-gray-600 mb-3">${item.description}</p>
                        <p class="text-green-600 font-bold text-xl mb-3">‚Ç¶${item.price.toLocaleString()}/day</p>
                        <button onclick="bookEquipment('${item.id}', '${item.name}', ${item.price})" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition">
                            üìÖ Book Now
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('equipmentList').innerHTML = html;
        }

        function bookEquipment(id, name, price) {
            const userInfo = prompt(`Book ${name} (‚Ç¶${price.toLocaleString()}/day)\n\nEnter your details:\nName | Phone | Date | Days\n\nExample: John Doe | 08012345678 | 2026-03-01 | 3`);
            
            if (!userInfo) return;
            
            const [userName, phone, date, days] = userInfo.split('|').map(s => s.trim());
            
            if (!userName || !phone || !date || !days) {
                alert('Please provide all information in the correct format');
                return;
            }
            
            const total = price * parseInt(days);
            const message = `Equipment Booking Request:
            
Equipment: ${name}
Price: ‚Ç¶${price.toLocaleString()}/day
Days: ${days}
Total: ‚Ç¶${total.toLocaleString()}

Customer Details:
Name: ${userName}
Phone: ${phone}
Date: ${date}

Please confirm availability and payment details.`;
            
            const whatsappURL = `https://wa.me/${CONFIG.businessPhone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappURL, '_blank');
            
            showSuccess('Booking request sent via WhatsApp!');
        }

        // Training with Paystack
        function populateTraining() {
            const html = courses.map(course => `
                <div class="border-2 border-gray-200 rounded-lg overflow-hidden hover:border-purple-400 transition">
                    <div class="bg-gradient-to-r from-green-500 to-teal-500 h-32 flex items-center justify-center text-white text-5xl">
                        üéì
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-2">${course.name}</h3>
                        <p class="text-sm text-gray-600 mb-3">${course.description}</p>
                        <div class="flex justify-between items-center mb-3 text-sm">
                            <span class="text-gray-500">${course.duration} ‚Ä¢ ${course.level}</span>
                            <span class="text-green-600 font-bold text-xl">‚Ç¶${(course.price/100).toLocaleString()}</span>
                        </div>
                        <button onclick="enrollCourse('${course.id}', '${course.name}', ${course.price})" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                            üí≥ Enroll Now
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('trainingList').innerHTML = html;
        }

        function enrollCourse(courseId, courseName, priceInKobo) {
            const email = prompt(`Enroll in ${courseName}\n\nEnter your email for payment and course access:`);
            
            if (!email || !email.includes('@')) {
                alert('Please enter a valid email address');
                return;
            }
            
            // PayStack payment
            const handler = PaystackPop.setup({
                key: CONFIG.paystackPublicKey,
                email: email,
                amount: priceInKobo,
                currency: 'NGN',
                ref: 'TRN-' + Date.now(),
                metadata: {
                    custom_fields: [
                        {
                            display_name: "Course",
                            variable_name: "course",
                            value: courseName
                        }
                    ]
                },
                callback: function(response) {
                    showSuccess(`Payment successful! Reference: ${response.reference}`);
                    
                    // Send confirmation via WhatsApp
                    const message = `Course Enrollment Confirmed!
                    
Course: ${courseName}
Email: ${email}
Payment Reference: ${response.reference}
Amount: ‚Ç¶${(priceInKobo/100).toLocaleString()}

Please send course access details.`;
                    
                    const whatsappURL = `https://wa.me/${CONFIG.businessPhone}?text=${encodeURIComponent(message)}`;
                    setTimeout(() => window.open(whatsappURL, '_blank'), 2000);
                },
                onClose: function() {
                    alert('Payment cancelled');
                }
            });
            
            handler.openIframe();
        }

        // Professional Services
        function requestServiceQuote(serviceType) {
            const services = {
                topographic: 'Topographic Survey',
                cadastral: 'Cadastral Survey',
                engineering: 'Engineering Survey',
                drone: 'Drone Mapping',
                hydrographic: 'Hydrographic Survey',
                gis: 'GIS Mapping'
            };
            
            const serviceName = services[serviceType];
            const message = `Service Quote Request:

Service: ${serviceName}

Please provide:
- Project location
- Area/scope
- Timeline requirements
- Any specific requirements

I would like to receive a detailed quote.`;
            
            const whatsappURL = `https://wa.me/${CONFIG.businessPhone}?text=${encodeURIComponent(message)}`;
            window.open(whatsappURL, '_blank');
            
            showSuccess('Quote request sent!');
        }

        // Data persistence
        function loadData() {
            const saved = localStorage.getItem('surveyorpro_surveys');
            if (saved) {
                surveys = JSON.parse(saved);
            }
        }

        function saveData() {
            localStorage.setItem('surveyorpro_surveys', JSON.stringify(surveys));
        }

        // Update history
        function updateHistory() {
            if (surveys.length === 0) {
                document.getElementById('historyContent').innerHTML = `
                    <div class="text-center py-12">
                        <p class="text-gray-400 text-lg mb-2">üìÇ No saved surveys yet</p>
                        <p class="text-sm text-gray-500">Complete and save surveys to see them here</p>
                    </div>
                `;
                return;
            }

            const html = surveys.map((s, i) => `
                <div class="border-2 border-gray-200 rounded-lg p-4 hover:border-purple-400 transition card-hover">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-bold text-lg text-purple-700">${s.projectName}</h3>
                            <p class="text-sm text-gray-600">${s.location}</p>
                        </div>
                        <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs font-semibold">
                            ${s.verificationCode}
                        </span>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-2 mb-3 text-xs">
                        <div class="bg-blue-50 p-2 rounded text-center">
                            <p class="text-gray-600">Hectares</p>
                            <p class="font-bold text-blue-800">${s.hectares.toFixed(2)}</p>
                        </div>
                        <div class="bg-green-50 p-2 rounded text-center">
                            <p class="text-gray-600">Perimeter</p>
                            <p class="font-bold text-green-800">${s.perimeter.toFixed(0)}m</p>
                        </div>
                        <div class="bg-purple-50 p-2 rounded text-center">
                            <p class="text-gray-600">Points</p>
                            <p class="font-bold text-purple-800">${s.points}</p>
                        </div>
                        <div class="bg-yellow-50 p-2 rounded text-center">
                            <p class="text-gray-600">Plots</p>
                            <p class="font-bold text-yellow-800">${s.plots.toFixed(1)}</p>
                        </div>
                    </div>
                    
                    <div class="text-xs text-gray-500 mb-3">
                        <p><strong>Client:</strong> ${s.clientName} ‚Ä¢ ${s.clientPhone}</p>
                        <p><strong>Date:</strong> ${new Date(s.savedAt).toLocaleDateString('en-NG')}</p>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="viewSurveyDetails(${i})" class="flex-1 bg-purple-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-purple-700">
                            View
                        </button>
                        <button onclick="shareSurvey(${i})" class="flex-1 bg-blue-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-700">
                            Share
                        </button>
                        <button onclick="deleteSurvey(${i})" class="bg-red-600 text-white px-3 py-2 rounded-lg text-sm hover:bg-red-700">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');

            document.getElementById('historyContent').innerHTML = html;
        }

        function viewSurveyDetails(index) {
            const s = surveys[index];
            alert(`Survey Details:

Project: ${s.projectName}
Client: ${s.clientName}
Phone: ${s.clientPhone}
Location: ${s.location}

Results:
- Area: ${s.hectares.toFixed(4)} hectares
- Acres: ${s.acres.toFixed(4)}
- Perimeter: ${s.perimeter.toFixed(2)} meters
- Points: ${s.points}
- Plots: ${s.plots.toFixed(2)}

Verification: ${s.verificationCode}
Date: ${new Date(s.savedAt).toLocaleDateString('en-NG')}`);
        }

        function shareSurvey(index) {
            const s = surveys[index];
            const text = `Survey Report - ${s.projectName}

Location: ${s.location}
Area: ${s.hectares.toFixed(4)} hectares (${s.acres.toFixed(4)} acres)
Perimeter: ${s.perimeter.toFixed(2)} meters
Points: ${s.points}

Verification Code: ${s.verificationCode}
Date: ${new Date(s.savedAt).toLocaleDateString('en-NG')}`;
            
            if (navigator.share) {
                navigator.share({
                    title: `Survey Report - ${s.projectName}`,
                    text: text
                });
            } else {
                navigator.clipboard.writeText(text);
                showSuccess('Survey details copied to clipboard!');
            }
        }

        function deleteSurvey(index) {
            if (confirm('Delete this survey? This cannot be undone.')) {
                surveys.splice(index, 1);
                saveData();
                updateHistory();
                showSuccess('Survey deleted');
            }
        }

        // Verify survey
        function verifySurvey() {
            const code = document.getElementById('verifyCode').value.trim().toUpperCase();
            
            if (!code) {
                alert('Please enter a verification code');
                return;
            }

            const survey = surveys.find(s => s.verificationCode === code);
            
            if (survey) {
                document.getElementById('verifyResult').innerHTML = `
                    <div class="bg-green-50 border-2 border-green-500 rounded-lg p-6">
                        <div class="flex items-center space-x-3 mb-4">
                            <div class="text-4xl">‚úì</div>
                            <h3 class="text-2xl font-bold text-green-800">Survey Verified!</h3>
                        </div>
                        <div class="bg-white rounded-lg p-4 space-y-2 text-sm">
                            <div class="grid grid-cols-2 gap-2">
                                <span class="font-semibold">Survey ID:</span>
                                <span class="font-mono">${survey.verificationCode}</span>
                                
                                <span class="font-semibold">Project:</span>
                                <span>${survey.projectName}</span>
                                
                                <span class="font-semibold">Location:</span>
                                <span>${survey.location}</span>
                                
                                <span class="font-semibold">Client:</span>
                                <span>${survey.clientName}</span>
                                
                                <span class="font-semibold">Area:</span>
                                <span class="text-green-600 font-bold">${survey.hectares.toFixed(4)} ha</span>
                                
                                <span class="font-semibold">Date:</span>
                                <span>${new Date(survey.savedAt).toLocaleDateString('en-NG')}</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                document.getElementById('verifyResult').innerHTML = `
                    <div class="bg-red-50 border-2 border-red-500 rounded-lg p-6">
                        <div class="flex items-center space-x-3 mb-3">
                            <div class="text-4xl">‚ö†Ô∏è</div>
                            <h3 class="text-2xl font-bold text-red-800">Invalid Code</h3>
                        </div>
                        <p class="text-red-700">
                            Verification code not found. Please check and try again.
                        </p>
                    </div>
                `;
            }
        }

        // Dark mode
        function toggleDarkMode() {
            docum
