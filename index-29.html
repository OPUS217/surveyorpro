<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SurveyPro Elite | Professional Surveying Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        * { 
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #7c3aed;
            --primary-dark: #6d28d9;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #1f2937;
            --bg-light: #f9fafb;
            --text-dark: #111827;
            --text-light: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
        }
        
        .gradient-bg { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
        }
        
        .hidden { 
            display: none !important; 
        }
        
        .tab-active { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
        }
        
        canvas { 
            border: 2px solid #667eea; 
            border-radius: 8px; 
            background: #fff;
            cursor: crosshair;
        }
        
        select, input { 
            font-family: 'Inter', monospace; 
        }
        
        .payment-split {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .payment-split-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }
        
        .payment-split-item .percentage {
            font-size: 1.5em;
            font-weight: 700;
        }
        
        .equipment-card {
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            background: white;
        }
        
        .equipment-card:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .price {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--success);
            margin: 10px 0;
        }
        
        .verification-code {
            background: rgba(16, 185, 129, 0.1);
            border: 2px dashed var(--success);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }
        
        .verification-code .code {
            font-size: 2em;
            font-weight: 700;
            color: var(--success);
            font-family: 'Courier New', monospace;
            letter-spacing: 3px;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }
        
        .toast.show {
            display: block;
        }
        
        .learning-card {
            display: flex;
            gap: 20px;
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .learning-card:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div id="toastMessage"></div>
    </div>

    <!-- Header -->
    <header class="gradient-bg text-white shadow-xl">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold">üåç SurveyPro Elite</h1>
                    <p class="text-sm opacity-90 mt-1">Professional Land Surveying Platform | WGS84 | UTM Zones 31-33N | Commercial Licensed</p>
                </div>
                <button onclick="toggleDark()" class="bg-white/20 px-4 py-2 rounded-lg hover:bg-white/30 transition">üåô</button>
            </div>
        </div>
    </header>

    <!-- Main Navigation Tabs -->
    <div class="max-w-7xl mx-auto px-4 py-4">
        <div class="bg-white rounded-xl shadow-lg p-2 flex overflow-x-auto space-x-2">
            <button onclick="showMainTab('coordinates')" id="maintab-coordinates" class="tab-active px-4 py-3 rounded-lg font-semibold whitespace-nowrap">üåç Coordinate Tools</button>
            <button onclick="showMainTab('survey')" id="maintab-survey" class="px-4 py-3 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">üìä Survey Manager</button>
            <button onclick="showMainTab('plot')" id="maintab-plot" class="px-4 py-3 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">üìê Plot & Calculate</button>
            <button onclick="showMainTab('verify')" id="maintab-verify" class="px-4 py-3 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">üîí C of O Verify</button>
            <button onclick="showMainTab('equipment')" id="maintab-equipment" class="px-4 py-3 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">üéØ Equipment</button>
            <button onclick="showMainTab('learning')" id="maintab-learning" class="px-4 py-3 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">üìö Learning Hub</button>
            <button onclick="showMainTab('services')" id="maintab-services" class="px-4 py-3 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">üíº Services</button>
            <button onclick="showMainTab('results')" id="maintab-results" class="px-4 py-3 rounded-lg font-semibold whitespace-nowrap hover:bg-gray-100">‚úÖ Results</button>
        </div>
    </div>

    <main class="max-w-7xl mx-auto px-4 pb-20">
        
        <!-- COORDINATE TOOLS TAB -->
        <div id="content-coordinates" class="main-tab-content">
            
            <!-- Sub-Tab Switcher -->
            <div class="bg-white rounded-xl shadow-lg p-3 mb-6 flex gap-2">
                <button onclick="showConverter('latlon')" id="conv-latlon" class="flex-1 bg-blue-600 text-white px-4 py-3 rounded-lg font-bold">
                    Lat/Lon ‚Üî UTM
                </button>
                <button onclick="showConverter('multi')" id="conv-multi" class="flex-1 bg-gray-200 px-4 py-3 rounded-lg font-bold hover:bg-gray-300">
                    Multi-Format
                </button>
                <button onclick="showConverter('bearing')" id="conv-bearing" class="flex-1 bg-gray-200 px-4 py-3 rounded-lg font-bold hover:bg-gray-300">
                    Bearing & Distance
                </button>
            </div>

            <!-- Lat/Lon ‚Üî UTM Converter -->
            <div id="converter-latlon" class="converter-content">
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <div class="flex items-center justify-between mb-6 pb-4 border-b-2">
                        <h3 class="text-2xl font-bold">üåç Lat/Lon ‚Üî UTM Converter</h3>
                        <div class="text-right text-sm">
                            <p class="font-semibold text-blue-700">Reference Datum</p>
                            <p class="text-xs text-gray-600">WGS 84 / UTM Zone 31N</p>
                        </div>
                    </div>

                    <!-- Lat/Long to UTM -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl">
                        <h4 class="font-bold text-lg mb-4">üìê Lat/Long ‚Üí UTM</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2 text-gray-700">Latitude (¬∞N)</label>
                                <input type="number" id="lat1" step="0.0000001" placeholder="7.75771146" 
                                    class="w-full px-4 py-3 border-2 border-blue-300 rounded-lg text-lg font-mono focus:border-blue-500">
                                <p class="text-xs text-gray-500 mt-1">Decimal degrees</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2 text-gray-700">Longitude (¬∞E)</label>
                                <input type="number" id="lon1" step="0.0000001" placeholder="4.53887695"
                                    class="w-full px-4 py-3 border-2 border-blue-300 rounded-lg text-lg font-mono focus:border-blue-500">
                                <p class="text-xs text-gray-500 mt-1">Decimal degrees</p>
                            </div>
                            <div class="flex items-end">
                                <button onclick="convertLatLonToUTM()" 
                                    class="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transition">
                                    Convert ‚Üí
                                </button>
                            </div>
                        </div>
                        <div id="result-utm" class="hidden mt-4 p-4 bg-white rounded-lg border-2 border-blue-300">
                            <h5 class="font-bold mb-2">UTM Coordinates:</h5>
                            <div class="grid grid-cols-2 gap-4 font-mono">
                                <div><strong>Zone:</strong> <span id="utm-zone"></span></div>
                                <div><strong>Hemisphere:</strong> <span id="utm-hemisphere"></span></div>
                                <div><strong>Easting:</strong> <span id="utm-easting"></span> m</div>
                                <div><strong>Northing:</strong> <span id="utm-northing"></span> m</div>
                            </div>
                        </div>
                    </div>

                    <!-- UTM to Lat/Long -->
                    <div class="p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl">
                        <h4 class="font-bold text-lg mb-4">üìç UTM ‚Üí Lat/Long</h4>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2 text-gray-700">UTM Zone</label>
                                <input type="number" id="utm-zone-input" min="1" max="60" placeholder="31"
                                    class="w-full px-4 py-3 border-2 border-green-300 rounded-lg text-lg font-mono focus:border-green-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2 text-gray-700">Easting (m)</label>
                                <input type="number" id="easting-input" step="0.001" placeholder="707032.831"
                                    class="w-full px-4 py-3 border-2 border-green-300 rounded-lg text-lg font-mono focus:border-green-500">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2 text-gray-700">Northing (m)</label>
                                <input type="number" id="northing-input" step="0.001" placeholder="857881.968"
                                    class="w-full px-4 py-3 border-2 border-green-300 rounded-lg text-lg font-mono focus:border-green-500">
                            </div>
                            <div class="flex items-end">
                                <button onclick="convertUTMToLatLon()" 
                                    class="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-bold text-lg shadow-lg transition">
                                    Convert ‚Üí
                                </button>
                            </div>
                        </div>
                        <div id="result-latlon" class="hidden mt-4 p-4 bg-white rounded-lg border-2 border-green-300">
                            <h5 class="font-bold mb-2">Geographic Coordinates:</h5>
                            <div class="grid grid-cols-2 gap-4 font-mono">
                                <div><strong>Latitude:</strong> <span id="result-lat"></span>¬∞</div>
                                <div><strong>Longitude:</strong> <span id="result-lon"></span>¬∞</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Multi-Format Converter -->
            <div id="converter-multi" class="converter-content hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold mb-6">üîÑ Multi-Format Coordinate Converter</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Input Section -->
                        <div class="p-6 bg-blue-50 rounded-xl">
                            <h4 class="font-bold text-lg mb-4">Input Coordinates</h4>
                            <div class="mb-4">
                                <label class="block text-sm font-semibold mb-2">Format</label>
                                <select id="input-format" class="w-full px-4 py-3 border-2 rounded-lg">
                                    <option value="dd">Decimal Degrees (DD)</option>
                                    <option value="dms">Degrees Minutes Seconds (DMS)</option>
                                    <option value="ddm">Degrees Decimal Minutes (DDM)</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-semibold mb-2">Latitude</label>
                                <input type="text" id="multi-lat" placeholder="7.75771146 or 7¬∞ 45' 27.76''"
                                    class="w-full px-4 py-3 border-2 rounded-lg font-mono">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-semibold mb-2">Longitude</label>
                                <input type="text" id="multi-lon" placeholder="4.53887695 or 4¬∞ 32' 19.96''"
                                    class="w-full px-4 py-3 border-2 rounded-lg font-mono">
                            </div>
                            <button onclick="convertMultiFormat()" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700">
                                Convert All Formats
                            </button>
                        </div>

                        <!-- Output Section -->
                        <div class="p-6 bg-green-50 rounded-xl">
                            <h4 class="font-bold text-lg mb-4">Output (All Formats)</h4>
                            <div id="multi-results" class="space-y-4">
                                <div class="p-4 bg-white rounded-lg">
                                    <p class="text-sm font-semibold text-gray-600">Decimal Degrees (DD)</p>
                                    <p class="font-mono text-lg" id="result-dd">-</p>
                                </div>
                                <div class="p-4 bg-white rounded-lg">
                                    <p class="text-sm font-semibold text-gray-600">Degrees Minutes Seconds (DMS)</p>
                                    <p class="font-mono text-lg" id="result-dms">-</p>
                                </div>
                                <div class="p-4 bg-white rounded-lg">
                                    <p class="text-sm font-semibold text-gray-600">Degrees Decimal Minutes (DDM)</p>
                                    <p class="font-mono text-lg" id="result-ddm">-</p>
                                </div>
                                <div class="p-4 bg-white rounded-lg">
                                    <p class="text-sm font-semibold text-gray-600">UTM</p>
                                    <p class="font-mono text-lg" id="result-multi-utm">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bearing & Distance Calculator -->
            <div id="converter-bearing" class="converter-content hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-2xl font-bold mb-6">üß≠ Bearing & Distance Calculator</h3>
                    
                    <div class="p-6 bg-purple-50 rounded-xl mb-6">
                        <h4 class="font-bold text-lg mb-4">Calculate New Point from Bearing & Distance</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="block text-sm font-semibold mb-2">Starting Northing (m)</label>
                                <input type="number" id="start-northing" step="0.001" placeholder="857881.968"
                                    class="w-full px-4 py-3 border-2 rounded-lg font-mono">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Starting Easting (m)</label>
                                <input type="number" id="start-easting" step="0.001" placeholder="707032.831"
                                    class="w-full px-4 py-3 border-2 rounded-lg font-mono">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Bearing (0-360¬∞)</label>
                                <input type="number" id="bearing-input" step="0.01" min="0" max="360" placeholder="45.50"
                                    class="w-full px-4 py-3 border-2 rounded-lg font-mono">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold mb-2">Distance (meters)</label>
                                <input type="number" id="distance-input" step="0.001" placeholder="100.000"
                                    class="w-full px-4 py-3 border-2 rounded-lg font-mono">
                            </div>
                        </div>
                        <button onclick="calculateBearingDistance()" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700">
                            Calculate New Point
                        </button>
                        
                        <div id="bearing-result" class="hidden mt-6 p-4 bg-white rounded-lg border-2 border-purple-300">
                            <h5 class="font-bold mb-3">Calculated Point:</h5>
                            <div class="grid grid-cols-2 gap-4 font-mono text-lg">
                                <div><strong>Northing:</strong> <span id="calc-northing"></span> m</div>
                                <div><strong>Easting:</strong> <span id="calc-easting"></span> m</div>
                            </div>
                            <button onclick="addToPlot()" class="mt-4 w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                ‚ûï Add to Plot
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SURVEY MANAGER TAB -->
        <div id="content-survey" class="main-tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h3 class="text-2xl font-bold mb-6">üìä Create New Survey</h3>
                
                <div class="p-4 bg-blue-50 rounded-lg mb-6">
                    <p class="font-semibold">Professional Survey Standards:</p>
                    <p class="text-sm text-gray-600">All surveys follow WGS 84 / UTM coordinate system standards. Verification codes are generated for each completed survey.</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-semibold mb-2">Survey Type</label>
                        <select id="survey-type" class="w-full px-4 py-3 border-2 rounded-lg">
                            <option value="boundary">Boundary Survey</option>
                            <option value="topographic">Topographic Survey</option>
                            <option value="construction">Construction Survey</option>
                            <option value="cadastral">Cadastral Survey</option>
                            <option value="hydrographic">Hydrographic Survey</option>
                            <option value="engineering">Engineering Survey</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Coordinate System</label>
                        <select id="coord-system" class="w-full px-4 py-3 border-2 rounded-lg">
                            <option value="WGS84-UTM31N">WGS 84 / UTM Zone 31N</option>
                            <option value="WGS84-UTM32N">WGS 84 / UTM Zone 32N</option>
                            <option value="WGS84-UTM33N">WGS 84 / UTM Zone 33N</option>
                            <option value="NAD83">NAD 83</option>
                            <option value="OSGB36">OSGB 36 (British National Grid)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Client Name</label>
                        <input type="text" id="client-name" placeholder="Enter client name"
                            class="w-full px-4 py-3 border-2 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Project Name</label>
                        <input type="text" id="project-name" placeholder="Enter project name"
                            class="w-full px-4 py-3 border-2 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Survey Date</label>
                        <input type="date" id="survey-date" class="w-full px-4 py-3 border-2 rounded-lg">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">Location</label>
                        <input type="text" id="survey-location" placeholder="Enter location"
                            class="w-full px-4 py-3 border-2 rounded-lg">
                    </div>
                </div>

                <button onclick="startSurvey()" class="w-full bg-blue-600 text-white px-6 py-4 rounded-lg font-bold text-lg hover:bg-blue-700">
                    üöÄ Start Survey
                </button>
            </div>

            <!-- Active Survey Section -->
            <div id="active-survey" class="hidden">
                <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h3 class="text-2xl font-bold mb-6">üìç Active Survey</h3>
                    
                    <!-- Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="p-6 bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl text-center">
                            <div class="text-4xl font-bold" id="point-count">0</div>
                            <div class="text-sm opacity-90">Points Recorded</div>
                        </div>
                        <div class="p-6 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl text-center">
                            <div class="text-4xl font-bold" id="area-hectares">0.0000</div>
                            <div class="text-sm opacity-90">Hectares</div>
                        </div>
                        <div class="p-6 bg-gradient-to-br from-orange-500 to-orange-600 text-white rounded-xl text-center">
                            <div class="text-4xl font-bold" id="area-acres">0.0000</div>
                            <div class="text-sm opacity-90">Acres</div>
                        </div>
                    </div>

                    <!-- Add Point Form -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Northing (m)</label>
                            <input type="number" id="point-northing" step="0.001" placeholder="Enter northing"
                                class="w-full px-4 py-3 border-2 rounded-lg font-mono">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Easting (m)</label>
                            <input type="number" id="point-easting" step="0.001" placeholder="Enter easting"
                                class="w-full px-4 py-3 border-2 rounded-lg font-mono">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Elevation (m)</label>
                            <input type="number" id="point-elevation" step="0.001" placeholder="Enter elevation"
                                class="w-full px-4 py-3 border-2 rounded-lg font-mono">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-semibold mb-2">Point Description</label>
                        <input type="text" id="point-description" placeholder="E.g., Corner stake, Property pin, etc."
                            class="w-full px-4 py-3 border-2 rounded-lg">
                    </div>

                    <button onclick="addSurveyPoint()" class="w-full bg-green-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-green-700 mb-4">
                        ‚ûï Add Point
                    </button>

                    <!-- Points List -->
                    <div id="points-list" class="mb-4"></div>

                    <button onclick="completeSurvey()" class="w-full bg-purple-600 text-white px-6 py-4 rounded-lg font-bold text-lg hover:bg-purple-700">
                        ‚úÖ Complete Survey
                    </button>
                </div>
            </div>
        </div>

        <!-- PLOT & CALCULATE TAB -->
        <div id="content-plot" class="main-tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-bold mb-6">üìê Professional Survey Plotting</h3>
                
                <div class="mb-6 flex gap-2 flex-wrap">
                    <button onclick="clearPlot()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">üóëÔ∏è Clear Plot</button>
                    <button onclick="exportPlot()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">üíæ Export Plot</button>
                    <button onclick="calculatePlotArea()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">üìä Calculate Area</button>
                </div>

                <canvas id="plot-canvas" width="900" height="600" class="w-full mb-6"></canvas>

                <div id="plot-points-list" class="mb-4"></div>

                <div id="area-result" class="hidden p-6 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl">
                    <h4 class="font-bold text-lg mb-4">üìê Area Calculations</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="p-4 bg-white rounded-lg">
                            <p class="text-sm text-gray-600">Square Meters</p>
                            <p class="text-2xl font-bold text-green-600" id="area-sqm">-</p>
                        </div>
                        <div class="p-4 bg-white rounded-lg">
                            <p class="text-sm text-gray-600">Hectares</p>
                            <p class="text-2xl font-bold text-green-600" id="area-ha">-</p>
                        </div>
                        <div class="p-4 bg-white rounded-lg">
                            <p class="text-sm text-gray-600">Acres</p>
                            <p class="text-2xl font-bold text-green-600" id="area-ac">-</p>
                        </div>
                        <div class="p-4 bg-white rounded-lg">
                            <p class="text-sm text-gray-600">Perimeter (m)</p>
                            <p class="text-2xl font-bold text-green-600" id="perimeter">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- C of O VERIFICATION TAB -->
        <div id="content-verify" class="main-tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-bold mb-6">üîí Certificate of Occupancy Verification</h3>
                
                <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg mb-6">
                    <p class="font-semibold">Important Notice:</p>
                    <p class="text-sm text-gray-700">This verification system checks survey codes against our database. For official C of O verification, please contact the relevant government land registry.</p>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-semibold mb-2">Enter Verification Code</label>
                    <input type="text" id="verify-code" placeholder="Enter code (e.g., NGS-MLP6LZZD)"
                        class="w-full px-4 py-3 border-2 rounded-lg font-mono text-lg">
                </div>

                <button onclick="verifyCode()" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 mb-6">
                    üîç Verify Code
                </button>

                <div id="verify-result" class="hidden"></div>
            </div>
        </div>

        <!-- EQUIPMENT RENTAL TAB -->
        <div id="content-equipment" class="main-tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-bold mb-6">üéØ Professional Survey Equipment Rental</h3>
                
                <div class="payment-split mb-6">
                    <h4 class="text-xl font-bold mb-4">üí∞ Revenue Sharing Model</h4>
                    <div class="payment-split-item">
                        <span>Platform Commission (You)</span>
                        <span class="percentage">45%</span>
                    </div>
                    <div class="payment-split-item">
                        <span>Equipment Rental Partner</span>
                        <span class="percentage">55%</span>
                    </div>
                    <p class="mt-4 opacity-90 text-sm">
                        All transactions are securely processed. Equipment providers receive 55% of rental fees.
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Equipment Cards -->
                    <div class="equipment-card">
                        <h4 class="text-xl font-bold text-purple-600 mb-2">üéØ Total Station</h4>
                        <p class="text-gray-600 mb-3">Leica TS16 with automatic target recognition and remote positioning</p>
                        <p class="price">‚Ç¶20,000 <span class="text-sm font-normal">/day</span></p>
                        <ul class="text-sm text-gray-600 mb-4 space-y-1">
                            <li>‚úÖ Accuracy: 1" angular, 1mm + 1.5ppm distance</li>
                            <li>‚úÖ Bluetooth & WiFi connectivity</li>
                            <li>‚úÖ Automated measurements</li>
                        </ul>
                        <button onclick="rentEquipment('Total Station', 20000)" class="w-full bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 font-bold">
                            üõí Rent Now
                        </button>
                    </div>

                    <div class="equipment-card">
                        <h4 class="text-xl font-bold text-purple-600 mb-2">üì° RTK GPS Receiver</h4>
                        <p class="text-gray-600 mb-3">Trimble R12i GNSS System with real-time kinematic positioning</p>
                        <p class="price">‚Ç¶15,000 <span class="text-sm font-normal">/day</span></p>
                        <ul class="text-sm text-gray-600 mb-4 space-y-1">
                            <li>‚úÖ RTK accuracy: 8mm + 1ppm horizontal</li>
                            <li>‚úÖ Multi-constellation support</li>
                            <li>‚úÖ Integrated UHF radio</li>
                        </ul>
                        <button onclick="rentEquipment('RTK GPS Receiver', 15000)" class="w-full bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 font-bold">
                            üõí Rent Now
                        </button>
                    </div>

                    <div class="equipment-card">
                        <h4 class="text-xl font-bold text-purple-600 mb-2">üìè Digital Level</h4>
                        <p class="text-gray-600 mb-3">Leica DNA03 Digital Level for precise elevation measurements</p>
                        <p class="price">‚Ç¶8,000 <span class="text-sm font-normal">/day</span></p>
                        <ul class="text-sm text-gray-600 mb-4 space-y-1">
                            <li>‚úÖ Accuracy: 0.3mm per km</li>
                            <li>‚úÖ Automatic readings</li>
                            <li>‚úÖ Data storage & transfer</li>
                        </ul>
                        <button onclick="rentEquipment('Digital Level', 8000)" class="w-full bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 font-bold">
                            üõí Rent Now
                        </button>
                    </div>

                    <div class="equipment-card">
                        <h4 class="text-xl font-bold text-purple-600 mb-2">üöÅ Survey Drone</h4>
                        <p class="text-gray-600 mb-3">DJI Phantom 4 RTK with high-precision positioning</p>
                        <p class="price">‚Ç¶25,000 <span class="text-sm font-normal">/day</span></p>
                        <ul class="text-sm text-gray-600 mb-4 space-y-1">
                            <li>‚úÖ Centimeter-level positioning</li>
                            <li>‚úÖ 20MP camera sensor</li>
                            <li>‚úÖ Photogrammetry software included</li>
                        </ul>
                        <button onclick="rentEquipment('Survey Drone', 25000)" class="w-full bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 font-bold">
                            üõí Rent Now
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- LEARNING HUB TAB -->
        <div id="content-learning" class="main-tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-bold mb-6">üìö Professional Surveying Learning Hub</h3>
                
                <div class="payment-split mb-6">
                    <h4 class="text-xl font-bold mb-4">üí° Revenue Sharing for Education</h4>
                    <div class="payment-split-item">
                        <span>Platform Commission (You)</span>
                        <span class="percentage">45%</span>
                    </div>
                    <div class="payment-split-item">
                        <span>Education Provider</span>
                        <span class="percentage">55%</span>
                    </div>
                    <p class="mt-4 opacity-90 text-sm">
                        Learn from industry experts. Course providers receive 55% of enrollment fees.
                    </p>
                </div>

                <h4 class="text-xl font-bold mb-4">üìñ Recommended Books & Resources</h4>

                <div class="learning-card">
                    <div class="flex-1">
                        <h5 class="text-lg font-bold text-purple-600 mb-2">üìò Elementary Surveying: An Introduction to Geomatics</h5>
                        <p class="text-sm text-gray-600 mb-2">By Charles D. Ghilani & Paul R. Wolf</p>
                        <p class="text-sm mb-3">Comprehensive introduction to modern surveying techniques, coordinate systems, and geospatial technology.</p>
                        <p class="text-sm"><strong>Topics:</strong> Theodolites, Total Stations, GPS/GNSS, Traversing, Leveling</p>
                        <button onclick="redirectToLearning('https://www.amazon.com/Elementary-Surveying-Introduction-Geomatics-15th/dp/0134604652')" 
                            class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-bold">
                            üìö View on Amazon
                        </button>
                    </div>
                </div>

                <div class="learning-card">
                    <div class="flex-1">
                        <h5 class="text-lg font-bold text-purple-600 mb-2">üìó Surveying with Construction Applications</h5>
                        <p class="text-sm text-gray-600 mb-2">By Barry Kavanagh</p>
                        <p class="text-sm mb-3">Practical guide focusing on construction surveying, site layout, and modern instrumentation.</p>
                        <p class="text-sm"><strong>Topics:</strong> Construction Layout, Site Planning, Machine Control, 3D Modeling</p>
                        <button onclick="redirectToLearning('https://www.amazon.com/Surveying-Construction-Applications-Barry-Kavanagh/dp/0134414454')" 
                            class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-bold">
                            üìö View on Amazon
                        </button>
                    </div>
                </div>

                <h4 class="text-xl font-bold mb-4 mt-8">üéì Online Courses & Certifications</h4>

                <div class="learning-card">
                    <div class="flex-1">
                        <h5 class="text-lg font-bold text-purple-600 mb-2">üåê Coursera: GIS Specialization</h5>
                        <p class="text-sm text-gray-600 mb-2">University of California, Davis</p>
                        <p class="text-sm mb-3">Master GIS fundamentals, spatial analysis, and geospatial data visualization.</p>
                        <p class="text-sm"><strong>Duration:</strong> 5 months | <strong>Level:</strong> Beginner to Intermediate</p>
                        <button onclick="redirectToLearning('https://www.coursera.org/specializations/gis')" 
                            class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-bold">
                            üéì Enroll Now
                        </button>
                    </div>
                </div>

                <div class="learning-card">
                    <div class="flex-1">
                        <h5 class="text-lg font-bold text-purple-600 mb-2">üåê Udemy: Complete Land Surveying Course</h5>
                        <p class="text-sm text-gray-600 mb-2">Professional Surveying Training</p>
                        <p class="text-sm mb-3">Learn total station operation, GPS surveying, coordinate calculations, and field procedures.</p>
                        <p class="text-sm"><strong>Duration:</strong> 12 hours | <strong>Level:</strong> All Levels</p>
                        <button onclick="redirectToLearning('https://www.udemy.com/topic/land-surveying/')" 
                            class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 font-bold">
                            üéì View Courses
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SERVICES TAB -->
        <div id="content-services" class="main-tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-bold mb-6">üíº Professional Surveying Services</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-6 border-2 border-purple-200 rounded-xl hover:border-purple-500 transition">
                        <h4 class="text-xl font-bold text-purple-600 mb-3">üèóÔ∏è Boundary Survey</h4>
                        <p class="text-gray-600 mb-4">Precise property line determination and monumentation for legal documentation.</p>
                        <ul class="text-sm text-gray-600 space-y-2 mb-4">
                            <li>‚úÖ Property line determination</li>
                            <li>‚úÖ Corner monumentation</li>
                            <li>‚úÖ Legal description preparation</li>
                            <li>‚úÖ Encroachment identification</li>
                        </ul>
                        <p class="text-2xl font-bold text-green-600">‚Ç¶150,000+</p>
                    </div>

                    <div class="p-6 border-2 border-purple-200 rounded-xl hover:border-purple-500 transition">
                        <h4 class="text-xl font-bold text-purple-600 mb-3">üó∫Ô∏è Topographic Survey</h4>
                        <p class="text-gray-600 mb-4">Detailed terrain mapping showing elevations, contours, and natural features.</p>
                        <ul class="text-sm text-gray-600 space-y-2 mb-4">
                            <li>‚úÖ Elevation data collection</li>
                            <li>‚úÖ Contour mapping</li>
                            <li>‚úÖ Feature identification</li>
                            <li>‚úÖ CAD deliverables</li>
                        </ul>
                        <p class="text-2xl font-bold text-green-600">‚Ç¶200,000+</p>
                    </div>

                    <div class="p-6 border-2 border-purple-200 rounded-xl hover:border-purple-500 transition">
                        <h4 class="text-xl font-bold text-purple-600 mb-3">üèòÔ∏è Construction Survey</h4>
                        <p class="text-gray-600 mb-4">Site layout and construction staking for building projects.</p>
                        <ul class="text-sm text-gray-600 space-y-2 mb-4">
                            <li>‚úÖ Building layout</li>
                            <li>‚úÖ Grade staking</li>
                            <li>‚úÖ As-built surveys</li>
                            <li>‚úÖ Quality control</li>
                        </ul>
                        <p class="text-2xl font-bold text-green-600">‚Ç¶180,000+</p>
                    </div>

                    <div class="p-6 border-2 border-purple-200 rounded-xl hover:border-purple-500 transition">
                        <h4 class="text-xl font-bold text-purple-600 mb-3">üöÅ Aerial Survey</h4>
                        <p class="text-gray-600 mb-4">Drone-based photogrammetry and mapping for large areas.</p>
                        <ul class="text-sm text-gray-600 space-y-2 mb-4">
                            <li>‚úÖ Aerial photography</li>
                            <li>‚úÖ 3D modeling</li>
                            <li>‚úÖ Orthophoto generation</li>
                            <li>‚úÖ Volume calculations</li>
                        </ul>
                        <p class="text-2xl font-bold text-green-600">‚Ç¶300,000+</p>
                    </div>
                </div>

                <div class="mt-8 p-6 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl">
                    <h4 class="text-xl font-bold mb-4">üìû Request a Quote</h4>
                    <p class="text-gray-600 mb-4">Contact our professional survey team for a customized quote for your project.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input type="text" placeholder="Your Name" class="px-4 py-3 border-2 rounded-lg">
                        <input type="email" placeholder="Your Email" class="px-4 py-3 border-2 rounded-lg">
                        <input type="tel" placeholder="Phone Number" class="px-4 py-3 border-2 rounded-lg">
                        <select class="px-4 py-3 border-2 rounded-lg">
                            <option>Select Service Type</option>
                            <option>Boundary Survey</option>
                            <option>Topographic Survey</option>
                            <option>Construction Survey</option>
                            <option>Aerial Survey</option>
                        </select>
                    </div>
                    <textarea placeholder="Project Details" rows="4" class="w-full px-4 py-3 border-2 rounded-lg mb-4"></textarea>
                    <button class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700">
                        üì® Submit Request
                    </button>
                </div>
            </div>
        </div>

        <!-- RESULTS TAB -->
        <div id="content-results" class="main-tab-content hidden">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-2xl font-bold mb-6">‚úÖ Survey Results & History</h3>
                
                <div id="survey-results">
                    <p class="text-center text-gray-500 py-10">No completed surveys yet. Start a new survey to see results here.</p>
                </div>
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="gradient-bg text-white mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="font-semibold">SurveyPro Elite - Professional Land Surveying Platform</p>
            <p class="text-sm opacity-75 mt-2">WGS 84 | UTM Coordinate Systems | Commercial Licensed</p>
            <p class="text-xs opacity-60 mt-2">¬© 2026 All Rights Reserved</p>
        </div>
    </footer>

    <script>
        // Global variables
        let currentSurvey = null;
        let surveyPoints = [];
        let plotPoints = [];
        let completedSurveys = [];
        let canvas, ctx;
        let calculatedPoint = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            canvas = document.getElementById('plot-canvas');
            if (canvas) {
                ctx = canvas.getContext('2d');
                initializePlot();
            }
            loadSurveyHistory();
            
            // Set today's date
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('survey-date');
            if (dateInput) dateInput.value = today;
        });

        // Tab Management
        function showMainTab(tabName) {
            // Hide all content
            document.querySelectorAll('.main-tab-content').forEach(el => el.classList.add('hidden'));
            
            // Remove active from all tabs
            document.querySelectorAll('[id^="maintab-"]').forEach(el => {
                el.classList.remove('tab-active');
                el.classList.add('hover:bg-gray-100');
            });
            
            // Show selected content
            document.getElementById('content-' + tabName).classList.remove('hidden');
            
            // Add active to clicked tab
            const activeTab = document.getElementById('maintab-' + tabName);
            activeTab.classList.add('tab-active');
            activeTab.classList.remove('hover:bg-gray-100');
        }

        // Converter Management
        function showConverter(converterName) {
            // Hide all converters
            document.querySelectorAll('.converter-content').forEach(el => el.classList.add('hidden'));
            
            // Remove active from all converter buttons
            document.querySelectorAll('[id^="conv-"]').forEach(el => {
                el.classList.remove('bg-blue-600', 'text-white');
                el.classList.add('bg-gray-200');
            });
            
            // Show selected converter
            document.getElementById('converter-' + converterName).classList.remove('hidden');
            
            // Add active to clicked button
            const activeButton = document.getElementById('conv-' + converterName);
            activeButton.classList.add('bg-blue-600', 'text-white');
            activeButton.classList.remove('bg-gray-200');
        }

        // UTM Conversion Functions
        function convertLatLonToUTM() {
            const lat = parseFloat(document.getElementById('lat1').value);
            const lon = parseFloat(document.getElementById('lon1').value);
            
            if (isNaN(lat) || isNaN(lon)) {
                showToast('Please enter valid latitude and longitude', 'warning');
                return;
            }

            // Simplified UTM conversion (for demonstration)
            const zone = Math.floor((lon + 180) / 6) + 1;
            const lonOrigin = (zone - 1) * 6 - 180 + 3;
            
            const k0 = 0.9996;
            const a = 6378137.0; // WGS84 equatorial radius
            const e = 0.081819191;
            const e2 = e * e;
            
            const latRad = lat * Math.PI / 180;
            const lonRad = (lon - lonOrigin) * Math.PI / 180;
            
            const N = a / Math.sqrt(1 - e2 * Math.sin(latRad) * Math.sin(latRad));
            const T = Math.tan(latRad) * Math.tan(latRad);
            const C = (e2 / (1 - e2)) * Math.cos(latRad) * Math.cos(latRad);
            const A = (lon - lonOrigin) * Math.PI / 180 * Math.cos(latRad);
            
            const M = a * ((1 - e2/4 - 3*e2*e2/64 - 5*e2*e2*e2/256) * latRad
                - (3*e2/8 + 3*e2*e2/32 + 45*e2*e2*e2/1024) * Math.sin(2*latRad)
                + (15*e2*e2/256 + 45*e2*e2*e2/1024) * Math.sin(4*latRad)
                - (35*e2*e2*e2/3072) * Math.sin(6*latRad));
            
            const easting = k0 * N * (A + (1-T+C)*A*A*A/6 + (5-18*T+T*T+72*C-58*(e2/(1-e2)))*A*A*A*A*A/120) + 500000.0;
            const northing = k0 * (M + N*Math.tan(latRad)*(A*A/2 + (5-T+9*C+4*C*C)*A*A*A*A/24 + (61-58*T+T*T+600*C-330*(e2/(1-e2)))*A*A*A*A*A*A/720));
            
            document.getElementById('utm-zone').textContent = zone + 'N';
            document.getElementById('utm-hemisphere').textContent = 'Northern';
            document.getElementById('utm-easting').textContent = easting.toFixed(3);
            document.getElementById('utm-northing').textContent = northing.toFixed(3);
            document.getElementById('result-utm').classList.remove('hidden');
            
            showToast('Conversion successful!', 'success');
        }

        function convertUTMToLatLon() {
            const zone = parseFloat(document.getElementById('utm-zone-input').value);
            const easting = parseFloat(document.getElementById('easting-input').value);
            const northing = parseFloat(document.getElementById('northing-input').value);
            
            if (isNaN(zone) || isNaN(easting) || isNaN(northing)) {
                showToast('Please enter all UTM values', 'warning');
                return;
            }

            // Simplified reverse UTM conversion
            const k0 = 0.9996;
            const a = 6378137.0;
            const e = 0.081819191;
            const e1 = (1 - Math.sqrt(1 - e*e)) / (1 + Math.sqrt(1 - e*e));
            
            const x = easting - 500000.0;
            const y = northing;
            
            const M = y / k0;
            const mu = M / (a * (1 - e*e/4 - 3*e*e*e*e/64 - 5*e*e*e*e*e*e/256));
            
            const phi1 = mu + (3*e1/2 - 27*e1*e1*e1/32) * Math.sin(2*mu)
                + (21*e1*e1/16 - 55*e1*e1*e1*e1/32) * Math.sin(4*mu)
                + (151*e1*e1*e1/96) * Math.sin(6*mu);
            
            const lat = phi1 * 180 / Math.PI;
            const lonOrigin = (zone - 1) * 6 - 180 + 3;
            const lon = lonOrigin + (x / (k0 * a / Math.sqrt(1 - e*e * Math.sin(phi1)*Math.sin(phi1)))) * 180 / Math.PI / Math.cos(phi1);
            
            document.getElementById('result-lat').textContent = lat.toFixed(7);
            document.getElementById('result-lon').textContent = lon.toFixed(7);
            document.getElementById('result-latlon').classList.remove('hidden');
            
            showToast('Conversion successful!', 'success');
        }

        // Multi-Format Conversion
        function convertMultiFormat() {
            const format = document.getElementById('input-format').value;
            const latInput = document.getElementById('multi-lat').value;
            const lonInput = document.getElementById('multi-lon').value;
            
            if (!latInput || !lonInput) {
                showToast('Please enter coordinates', 'warning');
                return;
            }

            // Parse input based on format
            let lat, lon;
            if (format === 'dd') {
                lat = parseFloat(latInput);
                lon = parseFloat(lonInput);
            } else {
                // For demo, assume DD input
                lat = parseFloat(latInput);
                lon = parseFloat(lonInput);
            }

            // Convert to all formats
            const dd = `${lat.toFixed(7)}¬∞, ${lon.toFixed(7)}¬∞`;
            
            const latDeg = Math.floor(Math.abs(lat));
            const latMin = Math.floor((Math.abs(lat) - latDeg) * 60);
            const latSec = ((Math.abs(lat) - latDeg - latMin/60) * 3600).toFixed(2);
            const lonDeg = Math.floor(Math.abs(lon));
            const lonMin = Math.floor((Math.abs(lon) - lonDeg) * 60);
            const lonSec = ((Math.abs(lon) - lonDeg - lonMin/60) * 3600).toFixed(2);
            const dms = `${latDeg}¬∞ ${latMin}' ${latSec}" N, ${lonDeg}¬∞ ${lonMin}' ${lonSec}" E`;
            
            const latDecMin = ((Math.abs(lat) - latDeg) * 60).toFixed(5);
            const lonDecMin = ((Math.abs(lon) - lonDeg) * 60).toFixed(5);
            const ddm = `${latDeg}¬∞ ${latDecMin}' N, ${lonDeg}¬∞ ${lonDecMin}' E`;
            
            // Simple UTM calculation
            const zone = Math.floor((lon + 180) / 6) + 1;
            const utm = `Zone ${zone}N, E: ~${(500000 + lon * 111000).toFixed(0)}m, N: ~${(lat * 111000).toFixed(0)}m`;
            
            document.getElementById('result-dd').textContent = dd;
            document.getElementById('result-dms').textContent = dms;
            document.getElementById('result-ddm').textContent = ddm;
            document.getElementById('result-multi-utm').textContent = utm;
            
            showToast('Multi-format conversion complete!', 'success');
        }

        // Bearing & Distance Calculation
        function calculateBearingDistance() {
            const northing = parseFloat(document.getElementById('start-northing').value);
            const easting = parseFloat(document.getElementById('start-easting').value);
            const bearing = parseFloat(document.getElementById('bearing-input').value);
            const distance = parseFloat(document.getElementById('distance-input').value);
            
            if (isNaN(northing) || isNaN(easting) || isNaN(bearing) || isNaN(distance)) {
                showToast('Please enter all values', 'warning');
                return;
            }

            // Convert bearing to radians
            const bearingRad = bearing * Math.PI / 180;
            
            // Calculate new coordinates
            const newNorthing = northing + (distance * Math.cos(bearingRad));
            const newEasting = easting + (distance * Math.sin(bearingRad));
            
            document.getElementById('calc-northing').textContent = newNorthing.toFixed(3);
            document.getElementById('calc-easting').textContent = newEasting.toFixed(3);
            document.getElementById('bearing-result').classList.remove('hidden');
            
            calculatedPoint = { northing: newNorthing, easting: newEasting };
            
            showToast('Point calculated successfully!', 'success');
        }

        // Add calculated point to plot
        function addToPlot() {
            if (calculatedPoint) {
                plotPoints.push({
                    id: plotPoints.length + 1,
                    northing: calculatedPoint.northing,
                    easting: calculatedPoint.easting,
                    description: `Calculated Point ${plotPoints.length + 1}`
                });
                
                updatePlot();
                displayPlotPoints();
                showToast('Point added to plot!', 'success');
            }
        }

        // Survey Management
        function startSurvey() {
            const clientName = document.getElementById('client-name').value;
            const projectName = document.getElementById('project-name').value;
            
            if (!clientName || !projectName) {
                showToast('Please enter client and project name', 'warning');
                return;
            }

            currentSurvey = {
                id: generateId(),
                type: document.getElementById('survey-type').value,
                client: clientName,
                project: projectName,
                coordSystem: document.getElementById('coord-system').value,
                date: document.getElementById('survey-date').value,
                location: document.getElementById('survey-location').value,
                points: [],
                startTime: new Date().toISOString()
            };

            surveyPoints = [];
            document.getElementById('active-survey').classList.remove('hidden');
            updateSurveyStats();
            showToast('Survey started successfully!', 'success');
        }

        function addSurveyPoint() {
            const northing = parseFloat(document.getElementById('point-northing').value);
            const easting = parseFloat(document.getElementById('point-easting').value);
            const elevation = parseFloat(document.getElementById('point-elevation').value);
            const description = document.getElementById('point-description').value;

            if (isNaN(northing) || isNaN(easting)) {
                showToast('Please enter valid coordinates', 'warning');
                return;
            }

            const point = {
                id: surveyPoints.length + 1,
                northing: northing,
                easting: easting,
                elevation: elevation || 0,
                description: description || `Point ${surveyPoints.length + 1}`,
                timestamp: new Date().toISOString()
            };

            surveyPoints.push(point);
            currentSurvey.points = surveyPoints;

            // Clear inputs
            document.getElementById('point-northing').value = '';
            document.getElementById('point-easting').value = '';
            document.getElementById('point-elevation').value = '';
            document.getElementById('point-description').value = '';

            updateSurveyStats();
            displaySurveyPoints();
            showToast('Point added!', 'success');
        }

        function updateSurveyStats() {
            document.getElementById('point-count').textContent = surveyPoints.length;
            
            if (surveyPoints.length >= 3) {
                const area = calculatePolygonArea(surveyPoints);
                const hectares = area / 10000;
                const acres = hectares * 2.47105;
                
                document.getElementById('area-hectares').textContent = hectares.toFixed(4);
                document.getElementById('area-acres').textContent = acres.toFixed(4);
            }
        }

        function displaySurveyPoints() {
            const list = document.getElementById('points-list');
            list.innerHTML = '<h4 class="font-bold mb-3">Recorded Points</h4>';
            
            surveyPoints.forEach(point => {
                const div = document.createElement('div');
                div.className = 'p-3 bg-gray-50 rounded-lg mb-2 font-mono text-sm';
                div.innerHTML = `
                    <strong>Point ${point.id}:</strong> N: ${point.northing.toFixed(3)}, E: ${point.easting.toFixed(3)}, Elev: ${point.elevation.toFixed(3)}
                    ${point.description ? `<br><span class="text-gray-600">${point.description}</span>` : ''}
                `;
                list.appendChild(div);
            });
        }

        function completeSurvey() {
            if (surveyPoints.length < 3) {
                showToast('Need at least 3 points to complete survey', 'warning');
                return;
            }

            const area = calculatePolygonArea(surveyPoints);
            const hectares = area / 10000;
            const acres = hectares * 2.47105;

            currentSurvey.endTime = new Date().toISOString();
            currentSurvey.area = {
                sqMeters: area,
                hectares: hectares,
                acres: acres
            };
            currentSurvey.verificationCode = generateVerificationCode();

            completedSurveys.push(currentSurvey);
            saveSurveyHistory();
            
            showSurveyComplete(currentSurvey);
            
            // Reset
            surveyPoints = [];
            currentSurvey = null;
            document.getElementById('active-survey').classList.add('hidden');
        }

        function showSurveyComplete(survey) {
            const modal = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999;" onclick="this.remove()">
                    <div class="bg-white p-8 rounded-xl max-w-2xl" onclick="event.stopPropagation()">
                        <div class="text-6xl text-center mb-4">‚úÖ</div>
                        <h2 class="text-3xl font-bold text-green-600 text-center mb-6">Survey Complete!</h2>
                        
                        <div class="verification-code">
                            <div class="text-sm mb-2 text-gray-600">Verification Code</div>
                            <div class="code">${survey.verificationCode}</div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 my-6">
                            <div class="p-4 bg-purple-100 rounded-lg text-center">
                                <div class="text-sm text-gray-600">Hectares</div>
                                <div class="text-2xl font-bold text-purple-600">${survey.area.hectares.toFixed(4)}</div>
                            </div>
                            <div class="p-4 bg-green-100 rounded-lg text-center">
                                <div class="text-sm text-gray-600">Acres</div>
                                <div class="text-2xl font-bold text-green-600">${survey.area.acres.toFixed(4)}</div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gray-50 rounded-lg mb-6 text-sm">
                            <strong>Survey Details:</strong><br>
                            Project: ${survey.project}<br>
                            Client: ${survey.client}<br>
                            Points: ${survey.points.length}<br>
                            System: ${survey.coordSystem}
                        </div>
                        
                        <button onclick="this.closest('[onclick]').remove(); showMainTab('results')" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700">
                            View Results
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        // Plot Functions
        function initializePlot() {
            if (!ctx) return;
            
            ctx.fillStyle = '#f9fafb';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= canvas.width; i += 50) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            
            for (let i = 0; i <= canvas.height; i += 50) {
                ctx.beginPath();
                ctx.moveTo(0, i);
                ctx.lineTo(canvas.width, i);
                ctx.stroke();
            }
        }

        function updatePlot() {
            initializePlot();
            
            if (plotPoints.length === 0) return;

            const northings = plotPoints.map(p => p.northing);
            const eastings = plotPoints.map(p => p.easting);
            
            const minN = Math.min(...northings);
            const maxN = Math.max(...northings);
            const minE = Math.min(...eastings);
            const maxE = Math.max(...eastings);
            
            const rangeN = maxN - minN || 1;
            const rangeE = maxE - minE || 1;
            
            const margin = 50;
            const plotWidth = canvas.width - 2 * margin;
            const plotHeight = canvas.height - 2 * margin;
            
            // Draw polygon
            if (plotPoints.length > 1) {
                ctx.strokeStyle = '#7c3aed';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                plotPoints.forEach((point, i) => {
                    const x = margin + ((point.easting - minE) / rangeE) * plotWidth;
                    const y = canvas.height - margin - ((point.northing - minN) / rangeN) * plotHeight;
                    
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                
                ctx.closePath();
                ctx.stroke();
                
                ctx.fillStyle = 'rgba(124, 58, 237, 0.1)';
                ctx.fill();
            }
            
            // Draw points
            plotPoints.forEach((point, i) => {
                const x = margin + ((point.easting - minE) / rangeE) * plotWidth;
                const y = canvas.height - margin - ((point.northing - minN) / rangeN) * plotHeight;
                
                ctx.fillStyle = '#10b981';
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, 2 * Math.PI);
                ctx.fill();
                
                ctx.fillStyle = '#111827';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`P${point.id}`, x + 10, y - 10);
            });
        }

        function displayPlotPoints() {
            const list = document.getElementById('plot-points-list');
            list.innerHTML = '<h4 class="font-bold mb-3">Plot Points</h4>';
            
            plotPoints.forEach(point => {
                const div = document.createElement('div');
                div.className = 'p-3 bg-gray-50 rounded-lg mb-2 font-mono text-sm';
                div.innerHTML = `
                    <strong>Point ${point.id}:</strong> N: ${point.northing.toFixed(3)}, E: ${point.easting.toFixed(3)}
                `;
                list.appendChild(div);
            });
        }

        function calculatePlotArea() {
            if (plotPoints.length < 3) {
                showToast('Need at least 3 points', 'warning');
                return;
            }

            const area = calculatePolygonArea(plotPoints);
            const hectares = area / 10000;
            const acres = hectares * 2.47105;
            
            let perimeter = 0;
            for (let i = 0; i < plotPoints.length; i++) {
                const p1 = plotPoints[i];
                const p2 = plotPoints[(i + 1) % plotPoints.length];
                const dist = Math.sqrt(Math.pow(p2.northing - p1.northing, 2) + Math.pow(p2.easting - p1.easting, 2));
                perimeter += dist;
            }

            document.getElementById('area-sqm').textContent = area.toFixed(2);
            document.getElementById('area-ha').textContent = hectares.toFixed(4);
            document.getElementById('area-ac').textContent = acres.toFixed(4);
            document.getElementById('perimeter').textContent = perimeter.toFixed(2);
            
            document.getElementById('area-result').classList.remove('hidden');
            showToast('Area calculated!', 'success');
        }

        function calculatePolygonArea(points) {
            let area = 0;
            for (let i = 0; i < points.length; i++) {
                const j = (i + 1) % points.length;
                area += points[i].easting * points[j].northing;
                area -= points[j].easting * points[i].northing;
            }
            return Math.abs(area / 2);
        }

        function clearPlot() {
            if (confirm('Clear all plot points?')) {
                plotPoints = [];
                initializePlot();
                document.getElementById('plot-points-list').innerHTML = '';
                document.getElementById('area-result').classList.add('hidden');
                showToast('Plot cleared', 'success');
            }
        }

        function exportPlot() {
            const link = document.createElement('a');
            link.download = `survey-plot-${new Date().toISOString().split('T')[0]}.png`;
            link.href = canvas.toDataURL();
            link.click();
            showToast('Plot exported!', 'success');
        }

        // Verification
        function verifyCode() {
            const code = document.getElementById('verify-code').value.toUpperCase();
            
            if (!code) {
                showToast('Please enter a verification code', 'warning');
                return;
            }

            const survey = completedSurveys.find(s => s.verificationCode === code);
            const resultDiv = document.getElementById('verify-result');
            
            if (survey) {
                resultDiv.innerHTML = `
                    <div class="p-6 bg-green-50 border-2 border-green-500 rounded-xl">
                        <div class="text-center mb-4">
                            <div class="text-5xl mb-2">‚úÖ</div>
                            <h4 class="text-xl font-bold text-green-600">Valid Verification Code</h4>
                        </div>
                        <div class="space-y-2 text-sm">
                            <div><strong>Project:</strong> ${survey.project}</div>
                            <div><strong>Client:</strong> ${survey.client}</div>
                            <div><strong>Date:</strong> ${survey.date}</div>
                            <div><strong>Location:</strong> ${survey.location}</div>
                            <div><strong>Points:</strong> ${survey.points.length}</div>
                            <div><strong>Area:</strong> ${survey.area.hectares.toFixed(4)} ha / ${survey.area.acres.toFixed(4)} acres</div>
                        </div>
                    </div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <div class="p-6 bg-red-50 border-2 border-red-500 rounded-xl text-center">
                        <div class="text-5xl mb-2">‚ùå</div>
                        <h4 class="text-xl font-bold text-red-600">Invalid Verification Code</h4>
                        <p class="text-sm text-gray-600 mt-2">Code not found in database</p>
                    </div>
                `;
            }
            
            resultDiv.classList.remove('hidden');
        }

        // Equipment Rental
        function rentEquipment(equipment, price) {
            const yourCommission = price * 0.45;
            const partnerFee = price * 0.55;
            
            const message = `
                <div class="text-center">
                    <h3 class="text-2xl font-bold mb-4">üéØ Equipment Rental</h3>
                    <p class="text-lg mb-4"><strong>${equipment}</strong></p>
                    <div class="p-6 bg-gray-50 rounded-xl mb-4">
                        <div class="mb-3 text-lg"><strong>Total Price:</strong> ‚Ç¶${price.toLocaleString()}/day</div>
                        <div class="mb-3 text-green-600"><strong>Your Commission (45%):</strong> ‚Ç¶${yourCommission.toLocaleString()}</div>
                        <div class="text-purple-600"><strong>Partner Fee (55%):</strong> ‚Ç¶${partnerFee.toLocaleString()}</div>
                    </div>
                    <p class="text-sm text-gray-600 mb-4">
                        This rental will be processed through our partner network.
                    </p>
                    <button onclick="processRental('${equipment}', ${price})" class="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-purple-700">
                        Confirm Booking
                    </button>
                </div>
            `;
            
            showModal(message);
        }

        function processRental(equipment, price) {
            showToast(`Booking request sent for ${equipment}. You'll receive confirmation shortly.`, 'success');
            closeModal();
            
            setTimeout(() => {
                window.open('https://www.nationalequipment.com/equipment-rental/', '_blank');
            }, 1000);
        }

        // Learning Resources
        function redirectToLearning(url) {
            window.open(url, '_blank');
            showToast('Opening learning resource...', 'success');
        }

        // Utility Functions
        function generateId() {
            return 'SRV-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        }

        function generateVerificationCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = 'NGS-';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            let icon = 'üìã';
            if (type === 'success') icon = '‚úÖ';
            if (type === 'warning') icon = '‚ö†Ô∏è';
            if (type === 'error') icon = '‚ùå';
            
            toastMessage.innerHTML = `<strong>${icon} ${message}</strong>`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function showModal(content) {
            const modal = `
                <div id="customModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 9999;">
                    <div class="bg-white p-8 rounded-xl max-w-2xl max-h-screen overflow-y-auto">
                        ${content}
                        <button onclick="closeModal()" class="w-full bg-gray-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-gray-700 mt-4">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modal);
        }

        function closeModal() {
            const modal = document.getElementById('customModal');
            if (modal) modal.remove();
        }

        function toggleDark() {
            showToast('Dark mode coming soon!', 'info');
        }

        function saveSurveyHistory() {
            localStorage.setItem('surveyHistory', JSON.stringify(completedSurveys));
            displaySurveyHistory();
        }

        function loadSurveyHistory() {
            const saved = localStorage.getItem('surveyHistory');
            if (saved) {
                completedSurveys = JSON.parse(saved);
                displaySurveyHistory();
            }
        }

        function displaySurveyHistory() {
            const container = document.getElementById('survey-results');
            
            if (completedSurveys.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 py-10">No completed surveys yet.</p>';
                return;
            }

            let html = '<div class="overflow-x-auto"><table class="w-full"><thead class="bg-gray-100"><tr><th class="p-3 text-left">Project</th><th class="p-3 text-left">Client</th><th class="p-3 text-left">Date</th><th class="p-3 text-left">Points</th><th class="p-3 text-left">Area (Ha)</th><th class="p-3 text-left">Code</th></tr></thead><tbody>';
            
            completedSurveys.slice().reverse().forEach(survey => {
                html += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3"><strong>${survey.project}</strong></td>
                        <td class="p-3">${survey.client}</td>
                        <td class="p-3">${survey.date}</td>
                        <td class="p-3">${survey.points.length}</td>
                        <td class="p-3">${survey.area.hectares.toFixed(4)}</td>
                        <td class="p-3"><span class="px-2 py-1 bg-green-100 text-green-800 rounded font-mono text-sm">${survey.verificationCode}</span></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }
    </script>
</body>
</html>
